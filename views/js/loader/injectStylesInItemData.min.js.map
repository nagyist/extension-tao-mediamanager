{"version":3,"sources":["../../loader/bootstrap.js","../richPassage/helpers.js","../richPassage/injectStylesInItemData.js","module-create.js"],"names":[],"mappings":"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","sourcesContent":["/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2016-2018 (original work) Open Assessment Technologies SA ;\n */\n\n/**\n * Bootstrap the app, start the entry controller\n * @author Bertrand Chevrier <bertrand@taotesting.com>\n */\n(function(){\n    'use strict';\n\n\n\n    var loaderScript = document.getElementById('amd-loader');\n    var configUrl = loaderScript.getAttribute('data-config');\n    var bundle  = loaderScript.getAttribute('data-bundle');\n\n    var loadController = function loadController(){\n        var controllerOptions = {};\n        var controllerPath = loaderScript.getAttribute('data-controller');\n        var params = loaderScript.getAttribute('data-params');\n        try{\n            controllerOptions = JSON.parse(params);\n        } catch(err){\n            controllerOptions = {};\n        }\n        window.require([controllerPath], function(controller) {\n            var startController = function startController(){\n                if(!window.started){\n                    window.started = true;\n                    controller.start(controllerOptions);\n                }\n            };\n            document.addEventListener('readystatechange', startController, false);\n            if (document.readyState === 'complete') {\n                startController();\n            }\n        });\n    };\n\n    //always start to load the config\n    window.require([configUrl], function() {\n\n        //define the global loading mechanism\n        if(!window.loadBundles){\n            //keep tracl of loaded bundles, even if require does it,\n            //this prevent some unecessary cycles\n            window.loaded = {};\n\n            /**\n             * Loading entry point for inter bundle dependency,\n             * always take the bundles from the params and window.bundles\n             * @param {String[]} [bundles] - an optional list of bundle to load\n             */\n            window.loadBundles = function loadBundles(bundles){\n                bundles = bundles || [];\n                bundles = bundles.concat(window.bundles)\n                bundles = bundles.filter( function(item, index){\n                    return item && bundles.indexOf(item) === index && window.loaded[item] !== true;\n                });\n                require(bundles, function(){\n                    bundles.forEach( function( item ) {\n                        window.loaded[item] = true;\n                    });\n                    loadController();\n                });\n            }\n        }\n\n        if(bundle || (window.bundles && window.bundles.length)) {\n            window.loadBundles([bundle]);\n        } else {\n            loadController();\n        }\n    });\n})();\n\ndefine(\"loader/bootstrap\", function(){});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2021 (original work) Open Assessment Technologies SA;\n */\n\ndefine('taoMediaManager/richPassage/helpers',['lodash', 'uri', 'util/url', 'core/dataProvider/request'], function (_, uri, urlUtil, request) {\n    'use strict';\n\n    /**\n     * Get all passage elements qtiClass: 'include' presents in Element\n     * @param {Object} element\n     * @returns {Array} array of include elements\n     */\n    function getPassagesFromElement(element = {}) {\n        let includes = {};\n        _.forEach(['elements', 'choices'], elementCollection => {\n            if (elementCollection === 'choices' && _.isArray(element[elementCollection])) {\n                // in MatchInterection choices is Array of match sets\n                _.forEach(element[elementCollection], choiceMatch => {\n                    _.forEach(choiceMatch, choice => {\n                        includes = _.extend(includes, getPassagesFromElement(choice));\n                    });\n                });\n            } else {\n                _.forEach(element[elementCollection], childElement => {\n                    if (childElement.qtiClass === 'include') {\n                        includes[childElement.serial] = childElement;\n                    } else {\n                        includes = _.extend(includes, getPassagesFromElement(childElement));\n                    }\n                });\n            }\n        });\n        if (element.body) {\n            includes = _.extend(includes, getPassagesFromElement(element.body));\n        }\n        if (element.prompt) {\n            includes = _.extend(includes, getPassagesFromElement(element.prompt));\n        }\n        return includes;\n    }\n\n    /**\n     * Get all passage elements qtiClass: 'include' presents in item\n     * @param {Object} itemData\n     * @returns {Array} array of include elements\n     */\n    function getPassagesFromItemData(itemData = {}) {\n        let includes = {};\n        if (itemData.content && itemData.content.data && itemData.content.data.body) {\n            includes = _.extend(includes, getPassagesFromElement(itemData.content.data.body));\n        }\n        return includes;\n    }\n\n    /**\n     * Check all passage elements and inject passage styles in itemData with absolute href\n     * @param {Object | Array} elements\n     * @param {Object} itemData\n     * @returns {Promise}\n     */\n    function injectPassagesStylesInItemData(elements = {}, itemData = {}) {\n        const requests = [];\n        const passageUris = [];\n        _.forEach(elements, (elem, id) => {\n            const passageHref = elem.attributes.href;\n            if (/taomedia:\\/\\/mediamanager\\//.test(passageHref)) {\n                // only rich passages from Assets\n                const passageUri = uri.decode(passageHref.replace('taomedia://mediamanager/', ''));\n                if (!passageUris.includes(passageUri)) {\n                    passageUris.push(passageUri);\n                    requests.push(\n                        request(urlUtil.route('getStylesheets', 'SharedStimulusStyling', 'taoMediaManager'), {\n                            uri: passageUri\n                        })\n                            .then(response => {\n                                response.forEach((element, index) => {\n                                    const serial = `stylesheet_${id}_${index}`;\n                                    itemData.content.data.stylesheets[serial] = {\n                                        qtiClass: 'stylesheet',\n                                        attributes: {\n                                            href: urlUtil.route(\n                                                'loadStylesheet',\n                                                'SharedStimulusStyling',\n                                                'taoMediaManager',\n                                                {\n                                                    uri: passageUri,\n                                                    stylesheet: element\n                                                }\n                                            ),\n                                            media: 'all',\n                                            title: '',\n                                            type: 'text/css'\n                                        },\n                                        serial\n                                    };\n                                });\n                            })\n                            .catch()\n                    );\n                }\n            }\n        });\n        return Promise.all(requests).then(() => itemData);\n    }\n\n    /**\n     * Check all passage elements and inject rich passage styles in itemData\n     * @param {Object} itemData\n     * @returns {Promise}\n     */\n    function checkAndInjectStylesInItemData(itemData = {}) {\n        const itemDataString = JSON.stringify(itemData);\n        if (/\"qtiClass\":\"include\"/.test(itemDataString)) {\n            const elements = getPassagesFromItemData(itemData);\n            return injectPassagesStylesInItemData(elements, itemData);\n        }\n        return Promise.resolve(itemData);\n    }\n\n    return {\n        getPassagesFromElement,\n        getPassagesFromItemData,\n        injectPassagesStylesInItemData,\n        checkAndInjectStylesInItemData\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2021 (original work) Open Assessment Technologies SA;\n */\n\ndefine('taoMediaManager/richPassage/injectStylesInItemData',['taoMediaManager/richPassage/helpers'], function (helpers) {\n    'use strict';\n    return helpers.checkAndInjectStylesInItemData;\n});\n\n","\ndefine(\"taoMediaManager/loader/injectStylesInItemData.bundle\", function(){});\n"]}