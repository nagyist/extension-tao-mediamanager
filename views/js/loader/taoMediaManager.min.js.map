{"version":3,"mappings":"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","names":["define","buffer","escapeExpression","helpers","data","helper","stack1","_","$","__","binder","uri","section","request","router","loggerFactory","feedback","confirmDialog","alertDialog","urlUtil","relatedItemsPopupTpl","relatedItemsClassPopupTpl","forbiddenClassActionTpl","message","url","method","dataType","then","response","actionContext","id","resolve","reject","classUri","label","parent","cssClass","type","catch","logger","updateContentBlock","create","name","content","visible","show","$panel","mediaRelationsData","noToken","haveItemReferences","inUsageMessage","confirmationMessage","items","number","callConfirmModal","callAlertModal","_generateIdentifier","newItem","itemData","attributes","qtiClass","responseRules","serial","sharedStimulusData","qtiSchemaLocation","languagesUrl","loadSharedStimulus","config","callback","languagesList","assetData","Promise","loader","namespaces","loadedItem","assetManager","locations","_container","_tooltip","assessmentItem","figure","img","figcaption","math","object","table","commonRenderConfig","options","creatorRenderer","get","$bodyEltForm","reset","lang","shuffleChoices","itemOptionForm","bodyElementOptionForm","textOptionForm","mediaManager","appendContainer","browseUrl","uploadUrl","deleteUrl","downloadUrl","fileExistsUrl","path","root","qtiCreatorContext","getCreatorContext","setOption","setOptions","load","rest","done","qtiClasses","itemConfig","globalConfig","currentItem","_getUri","_basename","hashClassSelector","hashClass","style","customStylesheet","$styleElem","styleElem","common","title","deleteTxt","editLabelTxt","downloadTxt","preparingMessageHtml","failMessageHtml","isInValidLocalTxt","erase","mProp","css","dontAppend","apply","selector","value","verifyInit","save","cssJson","stylesheetUri","download","successCallback","httpMethod","addStylesheet","tplData","listEntry","isInvalidLocal","setTimeout","isInit","isLocal","stylesheet","fileName","link","_href","_sep","_link","parser","loadStylesheet","addItemStylesheets","currentStylesheet","removeOrphanedStylesheets","getItem","init","href","getStyle","getHashClass","replaceHashClass","setHashClass","generateHashClass","clearCache","$doc","styleSheetToggler","_createInfoBox","closeTrigger","$messageBox","uploader","customCssToggler","getContext","trigger","stylesheetObj","input","labelBox","li","isCustomCss","isDisabled","cssUri","params","filters","pathParam","select","styleEditor","deleteStylesheet","attr","cssLinks","context","initLabelEditor","downloadStylesheet","saveLabel","handleAvailability","attrTo","attrFrom","cssToggler","className","$selector","target","normalize","clean","resetButton","toLabel","font","format","state","applyToStylesEditor","styles","selectedFontFamily","normalizeFont","option","text","fontFamily","optGroup","formatResult","formatSelection","width","toHexPair","color","additionalStyles","widgetObj","colorPicker","widget","widgetBox","titleElement","resetButtons","colorTriggers","colorTriggerLabels","currentProperty","setTitle","setTriggerColor","$trigger","Object","add","off","on","$tmpTrigger","$colorTrigger","additional","needToRemove","$fontSizeChanger","itemSelector","figcaptionSelector","$resetBtn","$input","itemFontSize","find","e","resizeFont","panel","fontSelector","colorSelector","fontSizeChanger","handle","_xmlRenderer","render","element","xml","tagTitles","inlineInteractions","interactions","icon","description","short","tags","group","interactionsToolbar","eventifier","qtiCreatorContextFactory","sharedStimulusLoader","commonRenderer","propertiesPanel","eventHelper","xmlRenderer","xmlNsHandler","interactionPanel","Element","item","sharedStimulusCreator","plugins","pluginRun","execStack","contentType","silent","self","$itemContainer","areaBroker","destroy","getSharedStimulusId","getConfig","componentFactory","pluginLoaderFactory","sharedStimulusCreatorFactory","areaBrokerFactory","componentTpl","module","bundle","category","pluginLoader","sharedStimulusAuthoring","getAreaBroker","setTemplate","plugin","menu","menuLeft","menuRight","contentCreatorPanel","editorBar","toolbar","propertyPanel","itemPanel","itemPropertyPanel","itemStylePanel","modalContainer","elementPropertyPanel","spread","start","assetDataUrl","assetId","previewEnabled","sharedStimulusAuthoringFactory","properties","fileUploadUrl","fileDeleteUrl","fileDownloadUrl","getFilesUrl","baseUrl","loadCssUrl","saveCssUrl","testRunnerConfig","testDefinition","serviceCallId","providers","runner","proxy","communicator","view","readOnly","fullPage","hideActionBars","proxyProvider","$previewer","file","isPreviewEnabled","isPassage","loadingBar","qtiItemPreviewerFactory","defaultPlugins","sharedStimulusId","serviceExtension","install","media","getComposingElements","createElements","containerHelper","$widget","$placeholder","bind","changeInnerWidgetState","outerWidget","innerWidget","container","$modalFeedbacksArea","outerContainer","getContentCreatorPanelArea","_widget","checkIfWidgetShouldSleep","contentHelper","$container","composingElts","_defaults","qtiImage","qtiMedia","qtiInclude","underline","mathJax","removePlugins","CKEditor","features","ckConfigurator","deletingHelper","featureFlag","languages","$toolbarArea","$editable","languagePluginEnabled","dtdMode","autoParagraph","enterMode","floatSpaceDockedOffsetY","language_list","sharedSpaces","top","taoQtiItem","insert","$newImgPlaceholder","_htmlEncode","createdElement","createdWidget","_activateInnerWidget","instanceReady","widgets","editor","_detectWidgetDeletion","leading","managePlaceholder","restoreState","_shieldInnerContent","_focus","menuShow","$languages","$languageMenu","isLanguage","blur","focus","configLoaded","ckConfig","toolbarType","afterPaste","togglePlaceholder","removePlaceholder","$editableContainer","$collection","currentState","ready","widgetInner","deleted","undoCmd","w","_rebuildWidgets","class","addShield","listenToWidgetCreation","event","containerWidget","targetWidget","range","editorFactory","placeholder","shieldInnerContent","passthroughInnerContent","autofocus","hasEditor","_find","buildEditor","getList","editorOptions","buildTasks","_buildEditor","destroyEditor","destructTasks","getData","setData","stateFactory","Active","htmlEditor","formElement","formTpl","TextActive","changeCallback","change","$block","blockCls","textBlockCssClass","regex","$form","TextWidget","Widget","append","$tlb","creator","elt","$widgetElem","widgetElem","$colParent","$textBlock","$wrap","$colRow","$editorPanel","_insertElement","_endInsertion","$adder","_initInsertion","_appendButton","qtiElement","_done","ns","changeState","$found","ret","markup","markupSelector","html","htmls","containerEditors","renderer","buildContainer","highlight","blockAdder","SharedStimulusCreator","previewerFactory","sharedStimulusConfig","testId","enable","removeProp","removeClass","disable","prop","addClass","hider","hide","window","FigureWidget","inlineHelper","alignmentHelper","$img","CreatorFigure","Figure","ImgWidget","height","CreatorImg","states","devTools","ItemWidget","$saveBtn","$itemBody","$itemEditorPanel","eltwWdget","$eltWidget","containerElements","$originalContainer","i","subContainers","$row","isTextBlock","$col","$subElement","$subWidget","$clonedContainer","textBlockId","$subContainer","subContainerElements","subContainerBody","$originalTextBlock","body","elements","$original","itemBody","containerData","$pre","CreatorItem","_normalizeItemBody","$child","Math","mediaEditor","$panelObjectSize","$panelMediaSize","_config","renderingThrottle","fileFilters","ObjectStateActive","refreshRendering","obj","previewOptions","mime","setMediaSizeEditor","qtiObject","mediaplayer","scaleHeight","originalSize","scaleWidth","scale","$node","responsive","mediaDimension","active","showResponsiveToggle","onChange","hideShowPanels","_initUpload","$uploadTrigger","$src","_openResourceMgr","mediaSourcesUrl","files","open","close","src","alt","qtiObjectAlt","align","ObjectWidget","CreatorObject","Renderer","ckEditor","tableModelFactory","tableActionsFactory","$pseudoContainer","newBody","$currentCol","tableModel","rowActions","colActions","displayTableActions","hideTableActions","x","y","tabletools","deleteColRow","insertRowAfter","insertColAfter","hAlignCenter","hAlignRight","TableStateActive","hAlignOptions","selected","hAlign","t","$itemPanel","$tablePropTrigger","insertCol","deleteTitle","updateTable","addClassOnCurrentCol","clearCellClasses","insertRow","addClassOnCurrentRow","currentSelection","$toolbars","TableWidget","CreatorTable","template","schemaLocations","xsi","empty","defaultData"],"sources":["../qtiCreator/tpl/relatedItemsPopup!tpl","../qtiCreator/tpl/relatedItemsClassPopup!tpl","../qtiCreator/tpl/forbiddenClassAction!tpl","../../taoMediaManagerCss/media!css","../controller/actions.js","../qtiCreator/helper/createDummyItemData.js","../qtiCreator/helper/sharedStimulusLoader.js","../qtiCreator/renderers/config.js","../qtiCreator/renderers/Renderer.js","../qtiCreator/helper/creatorRenderer.js","../qtiCreator/tpl/toolbars/cssToggler!tpl","../qtiCreator/editor/styleEditor/styleEditor.js","../qtiCreator/editor/styleEditor/styleSheetToggler.js","../qtiCreator/editor/styleEditor/fontSelector.js","../qtiCreator/editor/styleEditor/colorSelector.js","../qtiCreator/editor/styleEditor/fontSizeChanger.js","../qtiCreator/editor/propertiesPanel.js","../qtiXmlRenderer/renderers/config.js","../qtiXmlRenderer/renderers/Renderer.js","../qtiCreator/helper/xmlRenderer.js","../qtiCreator/editor/interactionsPanel.js","../qtiCreator/sharedStimulusCreator.js","../qtiCreator/component/tpl/sharedStimulusAuthoring!tpl","../qtiCreator/component/sharedStimulusAuthoring.js","../controller/authoring.js","../previewer/component/qtiSharedStimulusItem.js","../controller/editInstance.js","../controller/routes.js","../previewer/adapter/item/qtiSharedStimulusItem.js","../previewer/proxy/qtiSharedStimulusItem.js","../qtiCreator/widgets/helpers/content.js","../qtiCreator/widgets/states/Active.js","../qtiCreator/widgets/static/states/Active.js","../qtiCreator/helper/ckConfigurator.js","../qtiCreator/editor/ckEditor/htmlEditor.js","../qtiCreator/tpl/forms/static/text!tpl","../qtiCreator/widgets/static/text/states/Active.js","../qtiCreator/widgets/static/text/states/states.js","../qtiCreator/widgets/static/text/Widget.js","../qtiCreator/editor/blockAdder/blockAdder.js","../qtiCreator/editor/containerEditor.js","../qtiCreator/plugins/content/blockAdder.js","../qtiCreator/plugins/menu/preview.js","../qtiCreator/plugins/menu/save.js","../qtiCreator/plugins/navigation/back.js","../qtiCreator/renderers/Figcaption.js","../qtiCreator/widgets/static/figure/states/Active.js","../qtiCreator/widgets/static/figure/states/states.js","../qtiCreator/widgets/static/figure/Widget.js","../qtiCreator/renderers/Figure.js","../qtiCreator/widgets/static/img/states/Active.js","../qtiCreator/widgets/static/img/states/states.js","../qtiCreator/widgets/static/img/Widget.js","../qtiCreator/renderers/Img.js","../qtiCreator/tpl/forms/item!tpl","../qtiCreator/widgets/item/states/Active.js","../qtiCreator/widgets/item/states/states.js","../qtiCreator/widgets/item/Widget.js","../qtiCreator/renderers/tpl/wrap!tpl","../qtiCreator/renderers/Item.js","../qtiCreator/widgets/static/object/states/Active.js","../qtiCreator/widgets/static/object/states/states.js","../qtiCreator/widgets/static/object/Widget.js","../qtiCreator/renderers/Object.js","../qtiCreator/widgets/static/table/states/Active.js","../qtiCreator/widgets/static/table/states/states.js","../qtiCreator/widgets/static/table/Widget.js","../qtiCreator/renderers/Table.js","../qtiXmlRenderer/tpl/item!tpl","../qtiXmlRenderer/renderers/Item.js","onLayerEnd0.js","module-create.js","/Users/yuriy/Projects/cg/tao-community/tao/views/build/config-wrap-end-default.js"],"sourcesContent":["\ndefine('tpl!taoMediaManager/qtiCreator/tpl/relatedItemsPopup', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, functionType=\"function\", escapeExpression=this.escapeExpression, self=this;\n\nfunction program1(depth0,data) {\n  \n  var buffer = \"\", stack1;\n  buffer += \"<li>\"\n    + escapeExpression(((stack1 = (depth0 && depth0.label)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1))\n    + \"</li>\";\n  return buffer;\n  }\n\n  if (helper = helpers.inUsageMessage) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.inUsageMessage); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\n<ul>\\n\";\n  stack1 = helpers.each.call(depth0, (depth0 && depth0.items), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n</ul>\\n\";\n  if (helper = helpers.confirmationMessage) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.confirmationMessage); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1);\n  return buffer;\n  });\n});\n\n","\ndefine('tpl!taoMediaManager/qtiCreator/tpl/relatedItemsClassPopup', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, functionType=\"function\";\n\n\n  buffer += \"<b>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Warning\", options) : helperMissing.call(depth0, \"__\", \"Warning\", options)))\n    + \"</b><br><br>\\n\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"You are about to delete the class\", options) : helperMissing.call(depth0, \"__\", \"You are about to delete the class\", options)))\n    + \" <b>\";\n  if (helper = helpers.name) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.name); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</b>, \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"which contains assets that are in use elsewhere.\", options) : helperMissing.call(depth0, \"__\", \"which contains assets that are in use elsewhere.\", options)))\n    + \"\\n\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Deleting this class will break the items and the tests that are currently using them.\", options) : helperMissing.call(depth0, \"__\", \"Deleting this class will break the items and the tests that are currently using them.\", options)))\n    + \"<br><br>\\n\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Are you sure you want to delete this class and all of its content?\", options) : helperMissing.call(depth0, \"__\", \"Are you sure you want to delete this class and all of its content?\", options)));\n  return buffer;\n  });\n});\n\n","\ndefine('tpl!taoMediaManager/qtiCreator/tpl/forbiddenClassAction', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, functionType=\"function\";\n\n\n  buffer += \"<b>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Forbidden action\", options) : helperMissing.call(depth0, \"__\", \"Forbidden action\", options)))\n    + \"</b><br><br>\\n\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"The class\", options) : helperMissing.call(depth0, \"__\", \"The class\", options)))\n    + \" <b>\";\n  if (helper = helpers.name) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.name); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</b> \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"you are trying to delete is too large and contains too many subclasses.\", options) : helperMissing.call(depth0, \"__\", \"you are trying to delete is too large and contains too many subclasses.\", options)))\n    + \"<br>\\n\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Please delete the subclasses before.\", options) : helperMissing.call(depth0, \"__\", \"Please delete the subclasses before.\", options)));\n  return buffer;\n  });\n});\n\n","\ndefine('css!taoMediaManagerCss/media',[],function(){});\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 (original work) Open Assessment Technologies SA ;\n */\n\n/**\n * @author Juan Luis Gutierrez Dos Santos <juanluis.gutierrezdossantos@taotesting.com>\n */\n\ndefine('taoMediaManager/controller/actions',[\n    'lodash',\n    'jquery',\n    'i18n',\n    'layout/actions/binder',\n    'uri',\n    'layout/section',\n    'core/request',\n    'core/router',\n    'core/logger',\n    'ui/feedback',\n    'ui/dialog/confirm',\n    'ui/dialog/alert',\n    'util/url',\n    'tpl!taoMediaManager/qtiCreator/tpl/relatedItemsPopup',\n    'tpl!taoMediaManager/qtiCreator/tpl/relatedItemsClassPopup',\n    'tpl!taoMediaManager/qtiCreator/tpl/forbiddenClassAction',\n    'css!taoMediaManagerCss/media.css'\n], function (\n    _,\n    $,\n    __,\n    binder,\n    uri,\n    section,\n    request,\n    router,\n    loggerFactory,\n    feedback,\n    confirmDialog,\n    alertDialog,\n    urlUtil,\n    relatedItemsPopupTpl,\n    relatedItemsClassPopupTpl,\n    forbiddenClassActionTpl\n) {\n    'use strict';\n\n    const logger = loggerFactory('taoMediaManager/manageMedia');\n\n    binder.register('newSharedStimulus', function instanciate(actionContext) {\n        const self = this;\n        const classUri = uri.decode(actionContext.classUri);\n\n        return request({\n            url: self.url,\n            data: JSON.stringify({ classUri: classUri }),\n            method: 'POST'\n        })\n            .then(function (response) {\n                //backward compat format for jstree\n                if (actionContext.tree) {\n                    $(actionContext.tree).trigger('addnode.taotree', [\n                        {\n                            uri: uri.decode(response.data.id),\n                            label: response.data.name,\n                            parent: uri.decode(actionContext.classUri),\n                            cssClass: 'node-instance'\n                        }\n                    ]);\n                }\n\n                //return format (resourceSelector)\n                return {\n                    uri: uri.decode(response.data.id),\n                    label: response.data.name,\n                    classUri: uri.decode(actionContext.classUri),\n                    type: 'instance'\n                };\n            })\n            .catch(err => {\n                if (!_.isUndefined(err.message)) {\n                    feedback().error(err.message);\n                }\n                logger.error(err);\n            });\n    });\n    binder.register('sharedStimulusAuthoring', function sharedStimulusAuthoring(actionContext) {\n        section\n            .updateContentBlock('')\n            .create({\n                id: 'authoring',\n                name: __('Authoring'),\n                url: this.url,\n                content: ' ',\n                visible: false\n            })\n            .show();\n        const $panel = $('#panel-authoring');\n        $panel.attr('data-id', actionContext.id);\n        $panel.attr('data-uri', actionContext.uri);\n        // duplicate behaviour of $doc.ajaxComplete in tao/views/js/controller/backoffice.js\n        // as in old way - request html from server\n        router.dispatch(`${this.url}?id=${actionContext.id}`);\n    });\n    binder.register('deleteSharedStimulus', function remove(actionContext) {\n        const self = this;\n        let data = {};\n        let mediaRelationsData = {type: 'media'};\n\n        if (actionContext.context[0] === 'instance') {\n            mediaRelationsData.sourceId = actionContext.id\n        } else {\n            mediaRelationsData.classId = actionContext.id\n        }\n        data.uri        = uri.decode(actionContext.uri);\n        data.classUri   = uri.decode(actionContext.classUri);\n        data.id         = actionContext.id;\n        data.signature  = actionContext.signature;\n        return new Promise(function (resolve, reject) {\n            request({\n                url: urlUtil.route('index', 'ResourceRelations', 'tao'),\n                data: mediaRelationsData,\n                method: 'GET',\n                noToken: true\n            }).then(function (responseRelated) {\n                let message;\n                const haveItemReferences = responseRelated.data.relations;\n                const name = $('a.clicked', actionContext.tree).text().trim();\n                if (actionContext.context[0] === 'instance') {\n                    if (haveItemReferences.length === 0) {\n                        message = `${__('Are you sure you want to delete this')} <b>${name}</b>?`;\n                    } else {\n                        message = relatedItemsPopupTpl({\n                            name,\n                            inUsageMessage:  __('This \"%s\" is currently used in %d item(s)', name, haveItemReferences.length),\n                            confirmationMessage: __('Are you sure you want to delete this \"%s\"?', name),\n                            items: haveItemReferences\n                        });\n                    }\n                } else if (actionContext.context[0] !== 'instance') {\n                    if (haveItemReferences.length === 0) {\n                        message = `${__('Are you sure you want to delete this class and all of its content?')}`;\n                    } else if (haveItemReferences.length !== 0) {\n                        message = relatedItemsClassPopupTpl({\n                            name,\n                            number: haveItemReferences.length,\n                            items: haveItemReferences\n                        });\n                    }\n                }\n                callConfirmModal(actionContext, message, self.url, data, resolve, reject)\n            }).catch(errorObject => {\n                let message;\n                if (actionContext.context[0] === 'class' && errorObject.response.code === 999) {\n                    message = forbiddenClassActionTpl();\n                }\n                callAlertModal(actionContext, message, reject)\n            });\n        });\n    });\n\n    function callConfirmModal(actionContext, message, url, data, resolve, reject) {\n        confirmDialog(\n            message,\n            () => accept(actionContext, url, data, resolve, reject),\n            () => cancel(reject)\n        );\n    }\n\n    function callAlertModal(actionContext, message, reject) {\n        alertDialog(\n            message,\n            () => cancel(reject)\n        );\n    }\n\n    function accept(actionContext, url, data, resolve, reject) {\n        return request({\n            url: url,\n            method: 'POST',\n            data: data,\n            dataType: 'json'\n        }).then(function (response) {\n            if (response.success && response.deleted) {\n                feedback().success(response.message || __('Resource deleted'));\n\n                if (actionContext.tree) {\n                    $(actionContext.tree).trigger('removenode.taotree', [\n                        {\n                            id: actionContext.uri || actionContext.classUri\n                        }\n                    ]);\n                }\n                return resolve({\n                    uri: actionContext.uri || actionContext.classUri\n                });\n            } else {\n                if (response.success && !response.deleted) {\n                    $(actionContext.tree).trigger('refresh.taotree');\n                    reject(response.msg\n                           || response.message\n                           || __('Unable to delete the selected resource because you do not have the required rights to delete part of its content.'));\n                }\n\n                reject(response.msg\n                       || response.message\n                       || __('Unable to delete the selected resource'));\n            }\n        });\n    }\n\n    function cancel(reject) {\n        reject({ cancel: true });\n    }\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 (original work) Open Assessment Technologies SA ;\n */\n\ndefine('taoMediaManager/qtiCreator/helper/createDummyItemData',[\n    'taoQtiItem/qtiCreator/model/Item'\n], function(Item) {\n    'use strict';\n\n    const _generateIdentifier = function _generateIdentifier(uri) {\n        const pos = uri.lastIndexOf('#');\n        return uri.substr(pos + 1);\n    };\n\n    const creatorDummyItemData = function(sharedStimulusData) {\n        const newItem = new Item().id(_generateIdentifier(sharedStimulusData.id)).attr('title', sharedStimulusData.name);\n        newItem.data('new', true);\n        newItem.data('dummy', true);\n\n        const itemData = Object.assign({}, newItem);\n        delete itemData.bdy;\n        delete itemData.rootElement;\n\n        itemData.body = sharedStimulusData.body.body;\n        itemData.qtiClass = 'assessmentItem';\n        itemData.responseProcessing = {\n            attributes: {},\n            qtiClass: \"responseProcessing\",\n            responseRules: [],\n            serial: `response_${sharedStimulusData.body.serial}`\n        };\n        itemData.response = {};\n        if (sharedStimulusData.body.attributes['xml:lang']) {\n            itemData.attributes['xml:lang'] = sharedStimulusData.body.attributes['xml:lang'];\n        }\n        if (sharedStimulusData.body.attributes.class) {\n            itemData.attributes.class = sharedStimulusData.body.attributes.class;\n        }\n\n        return itemData;\n    };\n    return creatorDummyItemData;\n});\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 (original work) Open Assessment Technologies SA ;\n */\n\ndefine('taoMediaManager/qtiCreator/helper/sharedStimulusLoader',[\n    'jquery',\n    'taoQtiItem/qtiItem/core/Loader',\n    'taoQtiItem/qtiCreator/model/qtiClasses',\n    'taoMediaManager/qtiCreator/helper/createDummyItemData',\n    'core/dataProvider/request',\n    'util/url'\n], function($, Loader, qtiClasses, creatorDummyItemData, request, urlUtil) {\n    'use strict';\n\n    const qtiNamespace = 'http://www.imsglobal.org/xsd/imsqti_v2p2';\n\n    const qtiSchemaLocation = {\n        'http://www.imsglobal.org/xsd/imsqti_v2p2' : 'http://www.imsglobal.org/xsd/qti/qtiv2p2/imsqti_v2p2.xsd'\n    };\n\n    const languagesUrl = urlUtil.route('index', 'Languages', 'tao');\n\n    const creatorLoader = {\n        loadSharedStimulus(config, callback) {\n\n            if (config.id) {\n                const languagesList = request(languagesUrl);\n                const assetData = request(config.assetDataUrl, { id : config.id });\n                Promise.all([languagesList, assetData]).then((values) => {\n                    let loader, itemData;\n\n                    itemData = creatorDummyItemData(values[1]);\n\n                    loader = new Loader().setClassesLocation(qtiClasses);\n                    loader.loadItemData(itemData, function(loadedItem) {\n                        let namespaces;\n\n                        // convert item to current QTI version\n                        namespaces = loadedItem.getNamespaces();\n                        namespaces[''] = qtiNamespace;\n                        loadedItem.setNamespaces(namespaces);\n                        loadedItem.setSchemaLocations(qtiSchemaLocation);\n\n                        //add languages list to the item\n                        if (languagesList) {\n                            loadedItem.data('languagesList', values[0]);\n                        }\n\n                        callback(loadedItem, this.getLoadedClasses());\n                    });\n                });\n            }\n        }\n    };\n\n    return creatorLoader;\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 (original work) Open Assessment Technologies SA;\n */\n\ndefine('taoMediaManager/qtiCreator/renderers/config',[\n    'lodash',\n    'taoQtiItem/qtiCommonRenderer/renderers/config',\n    'taoItems/assets/manager',\n    'taoItems/assets/strategies'\n], function (_, commonRenderConfig, assetManagerFactory, assetStrategies) {\n    'use strict';\n\n    //asset manager using base url\n    const assetManager = assetManagerFactory(\n        [assetStrategies.taomedia, assetStrategies.external, assetStrategies.base64, assetStrategies.baseUrl],\n        { baseUrl: '' }\n    );\n\n    const locations = _.defaults(\n        {\n            _container: 'taoQtiItem/qtiCreator/renderers/Container',\n            _tooltip: 'taoQtiItem/qtiCreator/renderers/Tooltip',\n            assessmentItem: 'taoMediaManager/qtiCreator/renderers/Item',\n            figure: 'taoMediaManager/qtiCreator/renderers/Figure',\n            img: 'taoMediaManager/qtiCreator/renderers/Img',\n            figcaption: 'taoMediaManager/qtiCreator/renderers/Figcaption',\n            math: 'taoQtiItem/qtiCreator/renderers/Math',\n            object: 'taoMediaManager/qtiCreator/renderers/Object',\n            table: 'taoMediaManager/qtiCreator/renderers/Table'\n        },\n        commonRenderConfig.locations\n    );\n\n    return {\n        name: 'creatorRenderer',\n        locations: locations,\n        options: {\n            assetManager: assetManager\n        }\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 (original work) Open Assessment Technologies SA;\n */\n\n/**\n * Define the Qti Item Creator Renderer\n */\ndefine('taoMediaManager/qtiCreator/renderers/Renderer',[\n    'taoQtiItem/qtiRunner/core/Renderer',\n    'taoMediaManager/qtiCreator/renderers/config'\n], function(Renderer, config){\n    'use strict';\n\n    return Renderer.build(config.locations, config.name, config.options);\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n */\n\ndefine('taoMediaManager/qtiCreator/helper/creatorRenderer',[\n    'jquery',\n    'lodash',\n    'taoMediaManager/qtiCreator/renderers/Renderer',\n    'taoItems/assets/manager',\n    'taoItems/assets/strategies',\n    'util/dom'\n], function ($, _, Renderer, assetManagerFactory, assetStrategies, dom) {\n    'use strict';\n\n    //configure and instanciate once only:\n    let creatorRenderer = null;\n\n    /**\n     * Get a preconfigured renderer singleton\n     *\n     * @param {Boolean} reset\n     * @param {Object} config\n     * @param {Object} areaBroker - the QtiCreator area broker\n     * @returns {Object} - a configured instance of creatorRenderer\n     */\n    const get = function (reset, config, areaBroker) {\n        let $bodyEltForm;\n\n        config = config || {};\n        config.properties = config.properties || {};\n\n        if (!creatorRenderer || reset) {\n            $bodyEltForm = creatorRenderer ? creatorRenderer.getOption('bodyElementOptionForm') : null;\n            if (reset || !$bodyEltForm || !$bodyEltForm.length || !dom.contains($bodyEltForm)) {\n                // Renderer with binded locations from taoMediaManager/qtiCreator/renderers/config.js\n                creatorRenderer = new Renderer({\n                    lang: '',\n                    uri: '',\n                    shuffleChoices: false,\n                    itemOptionForm: $('#item-editor-item-property-bar #sidebar-right-passage-properties .panel'),\n                    bodyElementOptionForm: areaBroker.getElementPropertyPanelArea(),\n                    textOptionForm: $('#item-editor-text-property-bar #sidebar-right-text-block-properties .panel'),\n                    mediaManager: {\n                        appendContainer: '#mediaManager',\n                        browseUrl: config.properties.getFilesUrl,\n                        uploadUrl: config.properties.fileUploadUrl,\n                        deleteUrl: config.properties.fileDeleteUrl,\n                        downloadUrl: config.properties.fileDownloadUrl,\n                        fileExistsUrl: config.properties.fileExistsUrl,\n                        path: config.properties.path,\n                        root: config.properties.root\n                    },\n                    qtiCreatorContext: config.qtiCreatorContext,\n                    locations: config.properties.locations\n                });\n\n                //update the resolver baseUrl\n                creatorRenderer.getAssetManager().setData({ baseUrl: config.properties.baseUrl || '' });\n\n                creatorRenderer.setAreaBroker(areaBroker);\n\n                // extend creator renderer to give access to the creator context\n                _.assign(creatorRenderer, {\n                    getCreatorContext: function getCreatorContext() {\n                        return this.getOption('qtiCreatorContext');\n                    }\n                });\n            }\n        }\n\n        return creatorRenderer;\n    };\n\n    return {\n        get: get,\n\n        setOption: function (name, value) {\n            return get().setOption(name, value);\n        },\n        setOptions: function (options) {\n            return get().setOptions(options);\n        },\n        load: function (qtiClasses, done) {\n            return get().load(function (...rest) {\n                if (_.isFunction(done)) {\n                    done.apply(this, rest);\n                }\n            }, qtiClasses);\n        }\n    };\n});\n\n","\ndefine('tpl!taoMediaManager/qtiCreator/tpl/toolbars/cssToggler', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, functionType=\"function\", escapeExpression=this.escapeExpression;\n\n\n  buffer += \"<li data-css-res=\\\"\";\n  if (helper = helpers.path) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.path); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\">\\n    <span class=\\\"icon-preview style-sheet-toggler\\\" title=\\\"\";\n  if (helper = helpers.title) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.title); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\"></span>\\n    <span class=\\\"file-label truncate\\\" title=\\\"\";\n  if (helper = helpers.editLabelTxt) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.editLabelTxt); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\">\";\n  if (helper = helpers.label) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.label); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</span>\\n    <input type=\\\"text\\\" class=\\\"style-sheet-label-editor\\\" value=\\\"\";\n  if (helper = helpers.label) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.label); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\">\\n    <span class=\\\"icon-bin\\\" title=\\\"\";\n  if (helper = helpers.deleteTxt) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.deleteTxt); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" data-role=\\\"css-delete\\\"></span>\\n    <span class=\\\"icon-download\\\" title=\\\"\";\n  if (helper = helpers.downloadTxt) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.downloadTxt); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" data-role=\\\"css-download\\\"></span>\\n</li>\";\n  return buffer;\n  });\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2021 (original work) Open Assessment Technologies SA ;\n *\n */\n\n/**\n * @author dieter <dieter@taotesting.com>\n * @author Hanna Dzmitryieva <hanna@taotesting.com>\n */\n\ndefine('taoMediaManager/qtiCreator/editor/styleEditor/styleEditor',[\n    'jquery',\n    'lodash',\n    'i18n',\n    'util/urlParser',\n    'core/dataProvider/request',\n    'tpl!taoMediaManager/qtiCreator/tpl/toolbars/cssToggler',\n    'jquery.fileDownload'\n], function ($, _, __, UrlParser, request, cssTpl) {\n    'use strict';\n\n    let itemConfig;\n\n    /**\n     * qtiItemCreator config provided from QtiCreator\n     * used for generation of the ajax uri\n     */\n    let globalConfig;\n\n    /**\n     * generate Ajax URI\n     * @param {String} action\n     * @returns {*}\n     */\n    const _getUri = function (action) {\n        return globalConfig[`${action}CssUrl`];\n    };\n\n    /**\n     * Extract the file name from a path\n     * @param {String} path\n     * @returns {*}\n     * @private\n     */\n    const _basename = function (path) {\n        return path.substring(path.lastIndexOf('/') + 1);\n    };\n\n    // hash class for shared stimulus styles\n    const hashClassSelector = 'hashClass';\n    const taoHashClassPrefix = 'tao-';\n    let hashClass = '';\n\n    // stylesheet as object\n    let style = {},\n        currentItem,\n        customStylesheet = '';\n    // DOM element to hold the style\n    const $styleElem = (function () {\n            let styleElem = $('#item-editor-user-styles');\n            if (!styleElem.length) {\n                styleElem = $('<style>', { id: 'item-editor-user-styles' });\n                $('head').append(styleElem);\n            } else {\n                styleElem.empty();\n            }\n            return styleElem;\n        })(),\n        common = {\n            title: __('Disable this stylesheet temporarily'),\n            deleteTxt: __('Remove this stylesheet'),\n            editLabelTxt: __('Edit stylesheet label'),\n            downloadTxt: __('Download this stylesheet'),\n            preparingMessageHtml: __('Preparing CSS, please wait…'),\n            failMessageHtml: __('There was a problem downloading your CSS, please try again.'),\n            isInValidLocalTxt: __(\n                'This stylesheet has not been found on the server. you may want to delete this reference'\n            )\n        };\n    /**\n     * Delete all custom styles\n     * @returns {Boolean}\n     */\n    const erase = function () {\n        style = {};\n        $styleElem.text('');\n        return false;\n    };\n\n    /**\n     * Create CSS and add it to DOM\n     *\n     * @param {Boolean} dontAppend whether or not to append the stylesheet to the DOM. This is used by the iframe preview\n     * @returns {Boolean}\n     */\n    const create = function (dontAppend) {\n        let mSelector, // selector inside a media query\n            mProp, // property inside a media query\n            css = '';\n\n        if (_.isEmpty(style)) {\n            return erase();\n        }\n\n        // rebuild CSS\n        _.forEach(style, (value1, key1) => {\n            // first level key, could be selector or media query\n            css += `${key1}{`;\n            _.forEach(value1, (value2, key2) => {\n                // second level key, could be css property or selector\n                // in the case of a surrounding media query\n                if (_.isPlainObject(value2)) {\n                    for (mSelector in value2) {\n                        css += `${key2}{`;\n                        for (mProp in value2) {\n                            css += `${mProp}:${value2[mSelector]};`;\n                        }\n                        css += '}';\n                    }\n                } else {\n                    // regular selectors\n                    css += `${key2}:${value2};`;\n                }\n            });\n            css += '}\\n';\n        });\n\n        if (!dontAppend) {\n            $styleElem.text(css);\n        }\n        return css;\n    };\n\n    /**\n     * Apply rule to CSS\n     *\n     * @param {{string}} selector\n     * @param {{string}} property\n     * @param {{string}} value\n     */\n    const apply = function (selector, property, value) {\n        selector = selector.replace(hashClassSelector, hashClass);\n        style[selector] = style[selector] || {};\n\n        // delete this rule\n        if (!value) {\n            delete style[selector][property];\n            if (_.size(style[selector]) === 0) {\n                delete style[selector];\n            }\n        } else {\n            // add this rule\n            style[selector][property] = value;\n        }\n\n        // apply rule\n        create();\n\n        /**\n         * Fires a change notification on the item style\n         * @event taoQtiItem/qtiCreator/editor/styleEditor/styleEditor#stylechange.qti-creator\n         * @property {Object} [detail] An object providing some additional detail on the event\n         * @property {Boolean} [detail.initializing] Tells if the stylechange occurs at init time\n         */\n        $(document).trigger('stylechange.qti-creator');\n    };\n\n    /**\n     * Has the class been initialized\n     *\n     * @returns {Boolean}\n     */\n    const verifyInit = function verifyInit() {\n        if (!itemConfig) {\n            throw new Error('Missing itemConfig, did you call styleEditor.init()?');\n        }\n        return true;\n    };\n\n    /**\n     * Save the resulting CSS to a file\n     * @returns {Promise}\n     */\n    const save = function save() {\n        verifyInit();\n        return request(\n            _getUri('save'),\n            _.extend({}, itemConfig, {\n                cssJson: JSON.stringify(style),\n                stylesheetUri: customStylesheet.attr('href')\n            }),\n            'POST'\n        );\n    };\n\n    /**\n     * Download CSS as file\n     * @param {String} uri\n     */\n    const download = function (uri) {\n        verifyInit();\n        $.fileDownload(_getUri('download'), {\n            preparingMessageHtml: common.preparingMessageHtml,\n            failMessageHtml: common.failMessageHtml,\n            successCallback: function () {},\n            httpMethod: 'POST',\n            data: _.extend({}, itemConfig, { stylesheetUri: uri })\n        });\n    };\n\n    /**\n     * Add a single stylesheet, the custom stylesheet will be loaded as object\n     *\n     * @param {Object} stylesheet\n     */\n    const addStylesheet = function (stylesheet) {\n        let fileName, link, listEntry, parser;\n        function loadStylesheet(linkElement, stylesheetObject, isLocal, isValid) {\n            // in the given scenario we cannot test whether a remote stylesheet really exists\n            // this would require to pipe all remote css via php curl\n            const isInvalidLocal = isLocal && !isValid,\n                tplData = {\n                    path: stylesheetObject.attr('href'),\n                    label: stylesheetObject.attr('title') || fileName,\n                    title: common.title,\n                    deleteTxt: common.deleteTxt,\n                    downloadTxt: common.downloadTxt,\n                    editLabelTxt: isInvalidLocal ? common.isInValidLocalTxt : common.editLabelTxt\n                };\n\n            // create list entry\n            listEntry = $(cssTpl(tplData));\n\n            listEntry.data('stylesheetObj', stylesheetObject);\n\n            // initialize download button\n            $('#style-sheet-toggler').append(listEntry);\n\n            if (isInvalidLocal) {\n                listEntry.addClass('not-available');\n                listEntry.find('[data-role=\"css-download\"], .style-sheet-toggler').css('visibility', 'hidden');\n                return;\n            }\n\n            $styleElem.before(linkElement);\n\n            // time difference between loading the css file and applying the styles\n            setTimeout(\n                function () {\n                    let isInit = false;\n\n                    $(document).trigger('customcssloaded.styleeditor', [style]);\n                    $(window).trigger('resize');\n                    if (currentItem.pendingStylesheetsInit) {\n                        isInit = true;\n                        currentItem.pendingStylesheetsInit--;\n                    }\n\n                    /**\n                     * Fires a change notification on the item style\n                     * @event taoQtiItem/qtiCreator/editor/styleEditor/styleEditor#stylechange.qti-creator\n                     * @property {Object} [detail] An object providing some additional detail on the event\n                     * @property {Boolean} [detail.initializing] Tells if the stylechange occurs at init time\n                     */\n                    $(document).trigger('stylechange.qti-creator', [{ initializing: isInit }]);\n                },\n                isLocal ? 500 : 3500\n            );\n        }\n\n        // argument is uri\n        if (_.isString(stylesheet)) {\n            stylesheet = currentItem.createStyleSheet(stylesheet);\n        }\n\n        fileName = _basename(stylesheet.attr('href'));\n        // link with cache buster\n        link = (function () {\n            const _link = $(stylesheet.render()),\n                _href = _link.attr('href'),\n                _sep = _href.indexOf('?') > -1 ? '&' : '?';\n            _link.attr('href', _href + _sep + new Date().getTime().toString());\n            return _link;\n        })();\n\n        // cache css before applying allows for a pretty good guess\n        // when the stylesheet is loaded and the buttons in the style editor\n        // can be changed\n        parser = new UrlParser(link.attr('href'));\n        if (parser.checkCORS()) {\n            $.when($.ajax(link.attr('href'))).then(\n                function () {\n                    loadStylesheet(link, stylesheet, true, true);\n                },\n                // add file to list even on failure to be able to remove it from the item\n                function () {\n                    loadStylesheet(link, stylesheet, true, false);\n                }\n            );\n        } else {\n            // otherwise load it with a big timeout and hope for the best\n            // unfortunately this dirty way is the only possibility in cross domain environments\n            loadStylesheet(link, stylesheet, false);\n        }\n    };\n\n    /**\n     * Add style sheets to toggler\n     */\n    const addItemStylesheets = function () {\n        let currentStylesheet;\n        currentItem.pendingStylesheetsInit = _.size(currentItem.stylesheets);\n\n        _.forEach(currentItem.stylesheets, value => {\n            currentStylesheet = value;\n\n            if ('tao-user-styles.css' === _basename(currentStylesheet.attr('href'))) {\n                customStylesheet = currentStylesheet;\n            } else {\n                // add those that are loaded synchronously\n                addStylesheet(value);\n            }\n        });\n\n        // if no custom css had been found, add empty stylesheet anyway\n        if (!customStylesheet) {\n            customStylesheet = currentItem.createStyleSheet('css/tao-user-styles.css');\n        }\n    };\n\n    /**\n     * Remove orphaned stylesheets. These would be present if previously another item has been edited\n     */\n    const removeOrphanedStylesheets = function () {\n        $('link[data-serial]').remove();\n        customStylesheet = null;\n        erase();\n    };\n\n    /**\n     * retrieve the current item\n     *\n     * @returns {*}\n     */\n    const getItem = function () {\n        return currentItem;\n    };\n\n    /**\n     * Initialize class\n     * @param {Object} item\n     * @param {Object} config\n     */\n    const init = function (item, config) {\n        let href;\n\n        globalConfig = config;\n        // promise\n        currentItem = item;\n\n        //prepare config object\n        itemConfig = {\n            uri: config.id,\n            lang: config.lang\n        };\n\n        removeOrphanedStylesheets();\n\n        // this creates at the same time customStylesheet in case it doesn't exist yet\n        addItemStylesheets();\n\n        href = customStylesheet.attr('href');\n\n        currentItem.data('responsive', true);\n\n        request(_getUri('load'), _.extend({}, itemConfig, { stylesheetUri: href })).then(function (_style) {\n            // copy style to global style\n            style = _style;\n\n            // apply rules\n            create();\n\n            // inform editors about custom sheet\n            $(document).trigger('customcssloaded.styleeditor', [style]);\n        });\n    };\n\n    const getStyle = function () {\n        return style;\n    };\n\n    const getHashClass = function () {\n        return hashClass;\n    };\n\n    const setHashClass = function (cssClass) {\n        hashClass = cssClass;\n    };\n\n    const generateHashClass = function () {\n        return (hashClass = `${taoHashClassPrefix}${Math.random().toString(36).substr(2, 9)}`);\n    };\n\n    const replaceHashClass = function (selector) {\n        return selector.replace(hashClassSelector, hashClass);\n    };\n\n    const clearCache = function() {\n        removeOrphanedStylesheets();\n        $(document).off('customcssloaded.styleeditor');\n    };\n\n    return {\n        apply: apply,\n        save: save,\n        download: download,\n        erase: erase,\n        init: init,\n        create: create,\n        getItem: getItem,\n        getStyle: getStyle,\n        addStylesheet: addStylesheet,\n        getHashClass: getHashClass,\n        setHashClass: setHashClass,\n        generateHashClass: generateHashClass,\n        replaceHashClass: replaceHashClass,\n        clearCache: clearCache\n    };\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA ;\n *\n */\ndefine('taoMediaManager/qtiCreator/editor/styleEditor/styleSheetToggler',[\n    'jquery',\n    'taoMediaManager/qtiCreator/editor/styleEditor/styleEditor',\n    'i18n',\n    'lodash',\n    'taoQtiItem/qtiCreator/model/Stylesheet',\n    'tpl!taoQtiItem/qtiCreator/tpl/notifications/genericFeedbackPopup',\n    'ui/resourcemgr'\n], function ($, styleEditor, __, _, Stylesheet, genericFeedbackPopup) {\n    'use strict';\n\n    var $doc = $(document);\n\n    var styleSheetToggler = (function () {\n\n        var init = function (itemConfig) {\n\n            var cssToggler = $('#style-sheet-toggler'),\n                uploader = $('#stylesheet-uploader'),\n                customCssToggler = $('[data-custom-css]'),\n                getContext = function (trigger) {\n                    trigger = $(trigger);\n                    var li = trigger.closest('li'),\n                        stylesheetObj = li.data('stylesheetObj') || new Stylesheet({href : li.data('css-res')}),\n                        input = li.find('.style-sheet-label-editor'),\n                        labelBox = input.prev('.file-label'),\n                        label = input.val();\n\n                    return {\n                        li: li,\n                        input: input,\n                        label: label,\n                        labelBox: labelBox,\n                        isCustomCss: !!li.data('custom-css'),\n                        isDisabled: li.find('.icon-preview').hasClass('disabled'),\n                        stylesheetObj: stylesheetObj,\n                        cssUri: stylesheetObj.attr('href')\n                    };\n                };\n\n\n\n            /**\n             * Upload custom stylesheets\n             */\n            uploader.on('click', function () {\n\n                uploader.resourcemgr({\n                    appendContainer: '#mediaManager',\n                    path: '/',\n                    root: 'local',\n                    browseUrl: itemConfig.getFilesUrl,\n                    uploadUrl: itemConfig.fileUploadUrl,\n                    deleteUrl: itemConfig.fileDeleteUrl,\n                    downloadUrl: itemConfig.fileDownloadUrl,\n                    fileExistsUrl : itemConfig.fileExistsUrl,\n                    params: {\n                        uri: itemConfig.uri,\n                        lang: itemConfig.lang,\n                        filters: 'text/css'\n                    },\n                    pathParam: 'path',\n                    select: function (e, files) {\n                        var i, l = files.length;\n                        for (i = 0; i < l; i++) {\n                            styleEditor.addStylesheet(files[i].file);\n                        }\n                    }\n                });\n            });\n\n\n            /**\n             * Confirm to save the item\n             */\n            var deleteStylesheet = function(trigger) {\n                var context = getContext(trigger),\n                    attr = context.isDisabled ? 'disabled-href' : 'href',\n                    cssLinks = $('head link');\n\n\n                styleEditor.getItem().removeStyleSheet(context.stylesheetObj);\n\n                cssLinks.filter('[' + attr + '*=\"' + context.cssUri + '\"]').remove();\n                context.li.remove();\n\n                $('.feedback-info').hide();\n                _createInfoBox({\n                    message: __('Style Sheet <b>%s</b> removed<br> Click <i>Add Style Sheet</i> to re-apply.').replace('%s', context.label),\n                    type: 'info'\n                });\n\n                $doc.trigger('customcssloaded.styleeditor', [styleEditor.getStyle()]);\n            };\n\n\n            /**\n             * Modify stylesheet title (enable)\n             */\n            var initLabelEditor = function (trigger) {\n                var context = getContext(trigger);\n                context.labelBox.hide();\n                context.input.show();\n            };\n\n            /**\n             * Download current stylesheet\n             *\n             * @param trigger\n             */\n            var downloadStylesheet = function(trigger) {\n                styleEditor.download(getContext(trigger).cssUri);\n            };\n\n            /**\n             * Modify stylesheet title (save modification)\n             */\n            var saveLabel = function (trigger) {\n                var context = getContext(trigger),\n                    title = $.trim(context.input.val());\n\n                if (!title) {\n                    context.stylesheetObj.attr('title', '');\n                    return false;\n                }\n\n                context.stylesheetObj.attr('title', title);\n                context.input.hide();\n                context.labelBox.html(title).show();\n            };\n\n            /**\n             * Dis/enable style sheets\n             */\n            var handleAvailability = function (trigger) {\n                var context = getContext(trigger),\n                    link,\n                    attrTo = 'disabled-href',\n                    attrFrom = 'href';\n\n                // custom styles are handled in a style element, not in a link\n                if (context.isCustomCss) {\n                    if (context.isDisabled) {\n                        styleEditor.create();\n                        customCssToggler.removeClass('not-available');\n                    }\n                    else {\n                        styleEditor.erase();\n                        customCssToggler.addClass('not-available');\n                    }\n                }\n                // all other styles are handled via their link element\n                else {\n                    if (context.isDisabled) {\n                        attrTo = 'href';\n                        attrFrom = 'disabled-href';\n                    }\n\n                    link = $('link[' + attrFrom + '$=\"' + context.cssUri + '\"]');\n                    link.attr(attrTo, link.attr(attrFrom)).removeAttr(attrFrom);\n                }\n\n                // add some visual feed back to the triggers\n                $(trigger).toggleClass('disabled');\n            };\n\n            /**\n             * Distribute click events\n             */\n            cssToggler.on('click', function (e) {\n                var target = e.target,\n                    className = target.className;\n\n                // distribute click actions\n                if (className.indexOf('icon-bin') > -1) {\n                    deleteStylesheet(e.target);\n                }\n                else if (className.indexOf('file-label') > -1) {\n                    initLabelEditor(e.target);\n                }\n                else if (className.indexOf('icon-preview') > -1) {\n                    handleAvailability(e.target);\n                }\n                else if(className.indexOf('icon-download') > -1) {\n                    downloadStylesheet(e.target);\n                }\n            });\n\n\n            /**\n             * Handle renaming on enter\n             */\n            cssToggler.on('keydown', 'input', function (e) {\n                if (e.keyCode === 13) {\n                    $(e.target).trigger('blur');\n                }\n            });\n\n            /**\n             * Handle renaming on blur\n             */\n            cssToggler.on('blur', 'input', function (e) {\n                saveLabel(e.target);\n            });\n\n\n        };\n\n\n        var _createInfoBox = function(data){\n            var $messageBox = $(genericFeedbackPopup(data)),\n                closeTrigger = $messageBox.find('.close-trigger');\n\n            $('body').append($messageBox);\n\n            closeTrigger.on('click', function(){\n                $messageBox.fadeOut(function(){\n                    $(this).remove();\n                });\n            });\n\n            setTimeout(function() {\n                closeTrigger.trigger('click');\n            }, 4523);\n\n            return $messageBox;\n        };\n\n        return {\n            init: init\n        };\n\n    })();\n\n    return styleSheetToggler;\n});\n\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2021 (original work) Open Assessment Technologies SA;\n *\n */\n\ndefine('taoMediaManager/qtiCreator/editor/styleEditor/fontSelector',[\n    'jquery',\n    'lodash',\n    'json!taoQtiItem/qtiCreator/editor/resources/font-stacks.json',\n    'taoMediaManager/qtiCreator/editor/styleEditor/styleEditor',\n    'i18n',\n    'select2'\n], function ($, _, fontStacks, styleEditor, __) {\n    'use strict';\n\n    /**\n     * Populate a select box with a list of fonts to select from.\n     * On change apply the selected font to the specified target.\n     *\n     * @example\n     * The expected mark-up must be like this:\n     * <select\n     *   data-target=\"selector-of-targeted-element\"\n     *   data-not-selected=\"Select a font\n     *   data-selected=\"Reset to default\">\n     * <option value=\"\"></option>\n     *\n     * The function is called like this:\n     * fontSelector();\n     *\n     * @param {JQuery} $container\n     */\n    const fontSelector = function ($container) {\n        const selector = 'select#item-editor-font-selector',\n            $selector = $container.find(selector),\n            target = styleEditor.replaceHashClass($selector.data('target')),\n            normalize = function (font) {\n                return font.replace(/\"/g, \"'\").replace(/, /g, ',');\n            },\n            clean = function (font) {\n                return font.substring(0, font.indexOf(',')).replace(/'/g, '').replace(/\"/g, '');\n            },\n            resetButton = $selector.parent().find('[data-role=\"font-selector-reset\"]'),\n            toLabel = function (font) {\n                font = font.replace(/-/g, ' ');\n                return font.replace(/^([a-z\\u00E0-\\u00FC])|\\s+([a-z\\u00E0-\\u00FC])/g, function ($1) {\n                    return $1.toUpperCase();\n                });\n            },\n            format = function (state) {\n                const originalOption = state.element;\n                if (!state.id) {\n                    return state.text;\n                }\n                return `<span style=\"font-size: 12px;${$(originalOption).attr('style')}\">${state.text}</span>`;\n            },\n            reset = function () {\n                styleEditor.apply(target, 'font-family');\n                $selector.select2('val', '');\n            };\n        let applyToStylesEditor = true;\n\n        $selector.empty();\n        $selector.append(`<option value=\"\">${__('Default')}</option>`);\n\n        // initiate font family for Block\n        const styles = styleEditor.getStyle() || {};\n        const selectedFontFamily = styles[target] && styles[target]['font-family'] && clean(styles[target]['font-family']);\n\n        _.forEach(fontStacks, (value, key) => {\n            const optGroup = $('<optgroup>', { label: toLabel(key) });\n            _.forEach(value, font => {\n                const normalizeFont = normalize(font);\n                const option = $('<option>', {\n                    value: normalizeFont,\n                    text: clean(normalizeFont)\n                }).css({\n                    fontFamily: normalizeFont\n                });\n                if (clean(normalizeFont) === selectedFontFamily) {\n                    option.attr('selected', true);\n                }\n                optGroup.append(option);\n            });\n            $selector.append(optGroup);\n        });\n\n        resetButton.off('click').on('click', reset);\n\n        $selector.select2({\n            formatResult: format,\n            formatSelection: format,\n            width: 'resolve'\n        });\n\n        $selector.off('change').on('change', function () {\n            if (applyToStylesEditor) {\n                styleEditor.apply(target, 'font-family', $(this).val());\n            } else {\n                applyToStylesEditor = true;\n            }\n        });\n\n        /**\n         * style loaded from style sheet\n         */\n        $(document).on('customcssloaded.styleeditor', function (e, style) {\n            if (style[target] && style[target]['font-family']) {\n                $selector.select2('val', style[target]['font-family']);\n                $(`${selector} option:selected`).first().attr('selected', 'selected');\n            }\n            applyToStylesEditor = false;\n            $selector.trigger('change');\n        });\n    };\n\n    return fontSelector;\n});\n\n","define('taoMediaManager/qtiCreator/editor/styleEditor/colorSelector',[\n    'jquery',\n    'lodash',\n    'i18n',\n    'taoMediaManager/qtiCreator/editor/styleEditor/styleEditor',\n    'taoQtiItem/qtiCreator/helper/popup',\n    'lib/farbtastic/farbtastic'\n], function ($, _, __, styleEditor) {\n    'use strict';\n\n    // based on http://stackoverflow.com/a/14238466\n    // this conversion is required to communicate with farbtastic\n    function rgbToHex(color) {\n        function toHexPair(inp) {\n            return `0${parseInt(inp, 10).toString(16)}`.slice(-2);\n        }\n\n        // undefined can happen when no color is defined for a particular element\n        // isString on top of that should cover all sorts of weird input\n        if (!_.isString(color)) {\n            return color;\n        }\n\n        const rgbArr = /rgb\\s*\\(\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3})\\s*\\)/i.exec(color);\n\n        // color is not rgb\n        if (!_.isArray(rgbArr) || rgbArr.length !== 4) {\n            return color;\n        }\n\n        return `#${toHexPair(rgbArr[1])}${toHexPair(rgbArr[2])}${toHexPair(rgbArr[3])}`;\n    }\n\n    function additionalStylesToObject(additional = '') {\n        const styles = {};\n        const additionalStyles = additional.split(';');\n        additionalStyles.forEach(element => {\n            const keyValue = element.split(':');\n            styles[keyValue[0]] = keyValue[1];\n        });\n        return styles;\n    }\n\n    const colorSelector = function ($container) {\n        const colorPicker = $container.find('.item-editor-color-picker'),\n            widget = colorPicker.find('.color-picker'),\n            widgetBox = colorPicker.find('.color-picker-container'),\n            titleElement = colorPicker.find('.color-picker-title'),\n            input = colorPicker.find('.color-picker-input'),\n            resetButtons = colorPicker.find('.reset-button'),\n            colorTriggers = colorPicker.find('.color-trigger'),\n            colorTriggerLabels = colorPicker.find('label'),\n            $doc = $(document),\n            additionalStyles = {};\n        let currentProperty = 'color',\n            widgetObj;\n\n        /**\n         * Widget title\n         *\n         * @param {Object} property\n         * @param {JQueryElement} trigger\n         */\n        const setTitle = function (property, trigger) {\n            titleElement.text(trigger.parent().find('label').text());\n        };\n\n        /**\n         * Trigger button background\n         */\n        const setTriggerColor = function () {\n            colorTriggers.each(function () {\n                const $trigger = $(this),\n                    target = styleEditor.replaceHashClass($trigger.data('target')),\n                    style = styleEditor.getStyle() || {};\n                let value;\n                // elements have a color from usage of style editor\n                if (style[target] && style[target][$trigger.data('value')]) {\n                    value = style[target][$trigger.data('value')];\n                    $trigger.css('background-color', value);\n                    $trigger.attr('title', rgbToHex(value));\n                } else {\n                    // elements have no color at all\n                    $trigger.css('background-color', '');\n                    $trigger.attr('title', __('No value set'));\n                }\n            });\n        };\n\n        /**\n         * Trigger button background\n         */\n        const collectCommonAdditionalStyles = function () {\n            colorTriggers.each(function () {\n                const $trigger = $(this);\n                const target = styleEditor.replaceHashClass($trigger.data('target'));\n                const value = $trigger.data('value');\n                const styles = additionalStylesToObject($trigger.data('additional'));\n                Object.keys(styles).forEach(key => {\n                    if (!additionalStyles[key]) {\n                        additionalStyles[key] = [{ target, value }];\n                    } else {\n                        additionalStyles[key].push({ target, value });\n                    }\n                });\n            });\n        };\n\n        widgetObj = $.farbtastic(widget).linkTo(input);\n\n        // open color picker\n        setTriggerColor();\n        collectCommonAdditionalStyles();\n        colorTriggers\n            .add(colorTriggerLabels)\n            .off('click')\n            .on('click', function () {\n                const $tmpTrigger = $(this),\n                    $trigger =\n                        this.nodeName.toLowerCase() === 'label'\n                            ? $tmpTrigger.parent().find('.color-trigger')\n                            : $tmpTrigger;\n\n                widget.prop('target', $trigger.data('target'));\n                widget.prop('additional', $trigger.data('additional') || '');\n                widgetBox.hide();\n                currentProperty = $trigger.data('value');\n                setTitle(currentProperty, $trigger);\n                widgetObj.setColor(rgbToHex($trigger.css('background-color')));\n                widgetBox.show();\n\n                // event received from modified farbtastic\n                widget.on('colorchange.farbtastic', function (e, color) {\n                    styleEditor.apply(widget.prop('target'), currentProperty, color);\n                    if (widget.prop('additional')) {\n                        const styles = additionalStylesToObject(widget.prop('additional'));\n                        Object.keys(styles).forEach(key => {\n                            styleEditor.apply(widget.prop('target'), key, styles[key]);\n                        });\n                    }\n                    setTriggerColor();\n                });\n\n                // close color picker, when clicking somewhere outside or on the x\n                $doc.on('mouseup.colorselector', function (e) {\n                    if ($(e.target).hasClass('closer')) {\n                        widgetBox.hide();\n                        widget.off('colorchange.farbtastic');\n                        $doc.off('colorselector');\n                        return false;\n                    }\n\n                    if (!widgetBox.is(e.target) && widgetBox.has(e.target).length === 0) {\n                        widgetBox.hide();\n                        widget.off('colorchange.farbtastic');\n                        $doc.off('colorselector');\n                        return false;\n                    }\n                });\n\n                // close color picker on escape\n                $doc.on('keyup.colorselector', function (e) {\n                    if (e.keyCode === 27) {\n                        widgetBox.hide();\n                        widget.off('colorchange.farbtastic');\n                        $doc.off('colorselector');\n                        return false;\n                    }\n                });\n            });\n\n        // reset to default\n        resetButtons.off('click').on('click', function () {\n            const $this = $(this),\n                $colorTrigger = $this.parent().find('.color-trigger'),\n                target = styleEditor.replaceHashClass($colorTrigger.data('target')),\n                value = $colorTrigger.data('value'),\n                additional = $colorTrigger.data('additional');\n            styleEditor.apply(target, value);\n            if (additional) {\n                const styles = additionalStylesToObject(additional);\n                Object.keys(styles).forEach(key => {\n                    if (additionalStyles[key].length === 1) {\n                        styleEditor.apply(target, key);\n                    } else {\n                        // check other target: value pairs\n                        const style = styleEditor.getStyle() || {};\n                        let needToRemove = true;\n                        additionalStyles[key].forEach(element => {\n                            if (\n                                (target !== element.target || value !== element.value) &&\n                                style[target] &&\n                                style[element.target][element.value]\n                            ) {\n                                needToRemove = false;\n                            }\n                        });\n                        if (needToRemove) {\n                            styleEditor.apply(target, key);\n                        }\n                    }\n                });\n            }\n            setTriggerColor();\n        });\n\n        $doc.on('customcssloaded.styleeditor', setTriggerColor);\n    };\n\n    return colorSelector;\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2021-2022 (original work) Open Assessment Technologies SA ;\n *\n */\n\n/**\n *\n * @author dieter <dieter@taotesting.com>\n * @author Hanna Dzmitryieva <hanna@taotesting.com>\n */\ndefine('taoMediaManager/qtiCreator/editor/styleEditor/fontSizeChanger',['jquery', 'lodash', 'taoMediaManager/qtiCreator/editor/styleEditor/styleEditor'], function ($, _, styleEditor) {\n    'use strict';\n\n    /**\n     * Changes the font size in the Style Editor\n     * @param {JQuery} $container\n     */\n    const fontSizeChanger = function ($container) {\n        const $fontSizeChanger = $container.find('#item-editor-font-size-changer'),\n            itemSelector = styleEditor.replaceHashClass($fontSizeChanger.data('target')),\n            figcaptionSelector = `${itemSelector} figure figcaption`,\n            $resetBtn = $fontSizeChanger.parents('.reset-group').find('[data-role=\"font-size-reset\"]'),\n            $input = $container.find('.item-editor-font-size-text');\n        let itemFontSize = parseInt($(itemSelector).css('font-size'), 10);\n\n        // initiate font-size for Block\n        const styles = styleEditor.getStyle() || {};\n        if (styles[itemSelector] && styles[itemSelector]['font-size']) {\n            itemFontSize = parseInt(styles[itemSelector]['font-size'], 10);\n            $input.val(itemFontSize);\n        } else {\n            $input.val('');\n        }\n        /**\n         * Writes new font size to virtual style sheet\n         */\n        const resizeFont = function () {\n            styleEditor.apply(itemSelector, 'font-size', `${itemFontSize.toString()}px`);\n            const figcaptionSize = itemFontSize > 14 ? (itemFontSize -2).toString() : Math.min(itemFontSize, 12).toString()\n            styleEditor.apply(figcaptionSelector, 'font-size', `${figcaptionSize}px`);\n        };\n\n        /**\n         * Handle input field\n         */\n        $fontSizeChanger\n            .find('button')\n            .off('click')\n            .on('click', function (e) {\n                e.preventDefault();\n                if ($(this).data('action') === 'reduce') {\n                    if (itemFontSize <= 10) {\n                        return;\n                    }\n                    itemFontSize--;\n                } else {\n                    itemFontSize++;\n                }\n                resizeFont();\n                $input.val(itemFontSize);\n                $(this).parent().blur();\n            });\n\n        /**\n         * Apply font size on blur\n         */\n        $input.off('blur').on('blur', function () {\n            if (this.value) {\n                itemFontSize = parseInt(this.value, 10);\n                resizeFont();\n            } else {\n                styleEditor.apply(itemSelector, 'font-size');\n                styleEditor.apply(figcaptionSelector, 'font-size');\n            }\n        });\n\n        /**\n         * Apply font size on enter\n         * Disallows invalid characters\n         */\n        $input.off('keydown').on('keydown', function (e) {\n            var c = e.keyCode;\n            if (c === 13) {\n                $input.trigger('blur');\n            }\n            return _.contains([8, 37, 39, 46], c) || (c >= 48 && c <= 57) || (c >= 96 && c <= 105);\n        });\n\n        /**\n         * Remove font size from virtual style sheet\n         */\n        $resetBtn.off('click').on('click', function () {\n            styleEditor.apply(itemSelector, 'font-size');\n            styleEditor.apply(figcaptionSelector, 'font-size');\n            $input.val('');\n            itemFontSize = parseInt($(itemSelector).css('font-size'), 10);\n        });\n\n        /**\n         * style loaded from style sheet\n         */\n        $(document).on('customcssloaded.styleeditor', function (e, style) {\n            if (style[itemSelector] && style[itemSelector]['font-size']) {\n                itemFontSize = parseInt(style[itemSelector]['font-size'], 10);\n                $input.val(itemFontSize);\n            } else {\n                $input.val('');\n            }\n        });\n    };\n\n    return fontSizeChanger;\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020-2021 (original work) Open Assessment Technologies SA;\n *\n */\n\ndefine('taoMediaManager/qtiCreator/editor/propertiesPanel',[\n    'jquery',\n    'taoQtiItem/qtiCreator/helper/panel',\n    'taoMediaManager/qtiCreator/editor/styleEditor/styleEditor',\n    'taoMediaManager/qtiCreator/editor/styleEditor/styleSheetToggler',\n    'taoMediaManager/qtiCreator/editor/styleEditor/fontSelector',\n    'taoMediaManager/qtiCreator/editor/styleEditor/colorSelector',\n    'taoMediaManager/qtiCreator/editor/styleEditor/fontSizeChanger'\n], function ($, panel, styleEditor, styleSheetToggler, fontSelector, colorSelector, fontSizeChanger) {\n    'use strict';\n\n    /**\n     * Set up the properties panel, including the style editor\n     * @param {jQueryElement} $container - the panel container\n     * @param {Object} widget - item Widget\n     * @param {Object} config - sharedStimulusCreator config\n     */\n    return function setUpInteractionPanel($container, widget, config) {\n        panel.initSidebarAccordion($container);\n        panel.initFormVisibilityListener();\n\n        styleEditor.init(widget.element, config);\n        styleSheetToggler.init(config);\n\n        const $passageEditor = $('#item-editor-item-property-bar');\n        fontSelector($passageEditor);\n        colorSelector($passageEditor);\n        fontSizeChanger($passageEditor);\n    };\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 (original work) Open Assessment Technlogies SA;\n *\n */\n\n/**\n * Config of the QTI XML renderer\n *\n * @author Hanna Dzmitryieva <hanna@taotesting.com>\n */\ndefine('taoMediaManager/qtiXmlRenderer/renderers/config',[\n    'taoItems/assets/manager'\n], function(assetManagerFactory){\n    'use strict';\n\n    //all assets are normalized (relative)\n    const assetManager = assetManagerFactory([{\n        name : 'nomalize',\n        handle: function normalizeStrategy(url){\n            if(url){\n                return url.toString().replace(/^\\.?\\//, '');\n            }\n        }\n    }]);\n\n    /**\n     * The XML Renderer config\n     */\n    return {\n        name : 'xmlRenderer',\n        locations : {\n            '_container' : 'taoQtiItem/qtiXmlRenderer/renderers/Container',\n            'assessmentItem' : 'taoMediaManager/qtiXmlRenderer/renderers/Item',\n            '_tooltip' : 'taoQtiItem/qtiXmlRenderer/renderers/Tooltip',\n            'math' : 'taoQtiItem/qtiXmlRenderer/renderers/Math',\n            'figure' : 'taoQtiItem/qtiXmlRenderer/renderers/Figure',\n            'img' : 'taoQtiItem/qtiXmlRenderer/renderers/Img',\n            'figcaption' : 'taoQtiItem/qtiXmlRenderer/renderers/Figcaption',\n            'object' : 'taoQtiItem/qtiXmlRenderer/renderers/Object',\n            'table' : 'taoQtiItem/qtiXmlRenderer/renderers/Table',\n        },\n        options : {\n            assetManager : assetManager\n        }\n    };\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 (original work) Open Assessment Technologies SA;\n *\n */\n\ndefine('taoMediaManager/qtiXmlRenderer/renderers/Renderer',['taoQtiItem/qtiRunner/core/Renderer', 'taoMediaManager/qtiXmlRenderer/renderers/config'], function(Renderer, config){\n    'use strict';\n\n    return Renderer.build(config.locations, config.name, config.options);\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 (original work) Open Assessment Technologies SA ;\n */\ndefine('taoMediaManager/qtiCreator/helper/xmlRenderer',[\n    'core/logger',\n    'taoMediaManager/qtiXmlRenderer/renderers/Renderer',\n    'taoQtiItem/qtiItem/core/Element'\n], function(loggerFactory, XmlRenderer, Element){\n    'use strict';\n\n    const logger = loggerFactory('taoMediaManager/qtiCreator/helper/xmlRenderer');\n\n    const _xmlRenderer = new XmlRenderer().load();\n\n    const _render = function(element){\n        let xml = '';\n        try{\n            if(element instanceof Element) {\n                xml = element.render(_xmlRenderer);\n            }\n        }catch(e){\n            logger.error(e);\n        }\n        return xml;\n    };\n\n    return {\n        render : _render,\n        get : function(){\n            return _xmlRenderer;\n        }\n    };\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2021 (original work) Open Assessment Technologies SA ;\n *\n */\n\n/**\n * This module let's you set up the interaction panel\n *\n * @author Hanna Dzmitryieva <hanna@taotesting.com>\n */\ndefine('taoMediaManager/qtiCreator/editor/interactionsPanel',[\n    'lodash',\n    'i18n',\n    'taoQtiItem/qtiCreator/editor/interactionsToolbar',\n    'taoQtiItem/qtiCreator/helper/panel'\n], function (_, __, interactionsToolbar, panel) {\n    'use strict';\n\n    /**\n     * Set up the interaction selection panel\n     * @param {jQueryElement} $container - the panel container\n     */\n    return function setUpInteractionPanel($container) {\n        const tagTitles = {\n            inlineInteractions: __('Inline Interactions')\n        };\n        const interactions = {\n            _container: {\n                label: __('Text Block'),\n                icon: 'icon-font',\n                description: __(\n                    'Block contains the content (stimulus) of the item such as text or image. It is also required for Inline Interactions.'\n                ),\n                short: __('Block'),\n                qtiClass: '_container',\n                tags: [tagTitles.inlineInteractions, 'text'],\n                group:  __('inline-interactions')\n            }\n        };\n\n        // create toolbar\n        interactionsToolbar.create($container, interactions);\n\n        // init accordions\n        panel.initSidebarAccordion($container);\n        // init special subgroup\n        panel.toggleInlineInteractionGroup();\n    };\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 (original work) Open Assessment Technologies SA ;\n *\n */\n\n/**\n * The Shared Stimulus creator factory let's you create Shared Stimulus\n * The Shared Stimulus is wrapped in Item that allow reuse taoQtiItem modules\n *\n * @author Bertrand Chevrier <bertrand@taotesting.com>\n * @author Hanna Dzmitryieva <hanna@taotesting.com>\n */\ndefine('taoMediaManager/qtiCreator/sharedStimulusCreator',[\n    'jquery',\n    'lodash',\n    'i18n',\n    'core/eventifier',\n    'taoQtiItem/qtiCreator/context/qtiCreatorContext',\n    'taoMediaManager/qtiCreator/helper/sharedStimulusLoader',\n    'taoMediaManager/qtiCreator/helper/creatorRenderer',\n    'taoQtiItem/qtiCreator/helper/commonRenderer', //for read-only element : preview + xinclude\n    'taoMediaManager/qtiCreator/editor/propertiesPanel',\n    'taoQtiItem/qtiCreator/model/helper/event',\n    'taoMediaManager/qtiCreator/helper/xmlRenderer',\n    'taoQtiItem/qtiItem/helper/xmlNsHandler',\n    'core/request',\n    'util/url',\n    'taoMediaManager/qtiCreator/editor/interactionsPanel',\n    'taoMediaManager/qtiCreator/editor/styleEditor/styleEditor',\n    'taoQtiItem/qtiItem/core/Element'\n], function (\n    $,\n    _,\n    __,\n    eventifier,\n    qtiCreatorContextFactory,\n    sharedStimulusLoader,\n    creatorRenderer,\n    commonRenderer,\n    propertiesPanel,\n    eventHelper,\n    xmlRenderer,\n    xmlNsHandler,\n    request,\n    urlUtil,\n    interactionPanel,\n    styleEditor,\n    Element\n) {\n    'use strict';\n\n    /**\n     * Load an Shared Stimulus\n     * @param {String} id - the Shared Stimulus ID\n     * @param {String} uri - the Shared Stimulus URI\n     * @param {String} assetDataUrl - the data url\n     *\n     * @returns {Promise} that resolve with the loaded item model\n     */\n    const loadSharedStimulus = function loadSharedStimulus(id, uri, assetDataUrl) {\n        return new Promise(function (resolve, reject) {\n            sharedStimulusLoader.loadSharedStimulus({ id, uri, assetDataUrl }, function (item) {\n                if (!item) {\n                    reject(new Error('Unable to load the Shared Stimulus'));\n                }\n\n                //set useful data :\n                item.data('uri', uri);\n                resolve(item);\n            });\n        });\n    };\n\n    /**\n     * Build a new Shared Stimulus Creator\n     * @param {Object} config - the creator's configuration\n     * @param {String} config.properties.uri - the URI of the Shared Stimulus to load (properties structure is kept as legacy)\n     * @param {String} config.properties.label - the label of the Shared Stimulus to load (properties structure is kept as legacy)\n     * @param {String} config.properties.baseUrl - the base URL used to resolve assets\n     * @param {String[]} [config.interactions] - the list of additional interactions to load (PCI)\n     * @param {String[]} [config.infoControls] - the list of info controls to load (PIC)\n     * @param {areaBroker} areaBroker - a mapped areaBroker\n     * @param {Function[]} pluginFactories - the plugin's factory, ready to be instantiated\n     * @returns {sharedStimulusCreator} an event emitter object, with the usual lifecycle\n     * @throws {TypeError}\n     */\n    const sharedStimulusCreatorFactory = function sharedStimulusCreatorFactory(config, areaBroker, pluginFactories) {\n        let sharedStimulusCreator;\n        const qtiCreatorContext = qtiCreatorContextFactory();\n        const plugins = {};\n\n        /**\n         * Run a method in all plugins\n         *\n         * @param {String} method - the method to run\n         * @returns {Promise} once that resolve when all plugins are done\n         */\n        const pluginRun = function pluginRun(method) {\n            const execStack = [];\n\n            _.forEach(plugins, function (plugin) {\n                if (_.isFunction(plugin[method])) {\n                    execStack.push(plugin[method]());\n                }\n            });\n\n            return Promise.all(execStack);\n        };\n\n        //validate parameters\n        if (!_.isPlainObject(config)) {\n            throw new TypeError('The shared stimulus creator configuration is required');\n        }\n        if (!config.properties || _.isEmpty(config.properties.uri) || _.isEmpty(config.properties.baseUrl)) {\n            throw new TypeError(\n                'The creator configuration must contains the required properties triples: uri, label and baseUrl'\n            );\n        }\n        if (!areaBroker) {\n            throw new TypeError('Without an areaBroker there are no chance to see something you know');\n        }\n\n        //factor the new sharedStimulusCreator\n        sharedStimulusCreator = eventifier({\n            //lifecycle\n\n            /**\n             * Initialize the Shared Stimulus creator:\n             *  - set up the registries for portable elements\n             *  - load the Shared Stimulus\n             *  - instantiate and initialize the plugins\n             *\n             * @returns {sharedStimulusCreator} chains\n             * @fires sharedStimulusCreator#init - once initialized\n             * @fires sharedStimulusCreator#error - if something went wrong\n             */\n            init() {\n                //instantiate the plugins first\n                _.forEach(pluginFactories, pluginFactory => {\n                    const plugin = pluginFactory(this, areaBroker);\n                    plugins[plugin.getName()] = plugin;\n                });\n\n                // quick-fix: clear all ghost events listeners\n                // prevent ghosting of Shared Stimulus states and other properties\n                $(document).off('.qti-widget');\n\n                /**\n                 * Save the Shared Stimulus on \"save\" event\n                 * @event sharedStimulusCreator#save\n                 * @param {Boolean} [silent] - true to not trigger the success feedback\n                 * @fires sharedStimulusCreator#saved once the save is done\n                 * @fires sharedStimulusCreator#error\n                 */\n                this.on('save', silent => {\n                    const item = this.getItem();\n                    const styles = styleEditor.getStyle();\n                    if (_.size(styles) && !item.attributes.class) {\n                        item.attributes.class = this.hashClass;\n                    }\n\n                    const xml = xmlNsHandler.restoreNs(xmlRenderer.render(item), item.getNamespaces());\n\n                    //do the save\n                    Promise.all([\n                        request({\n                            url: urlUtil.route('patch', 'SharedStimulus', 'taoMediaManager', {\n                                id: config.properties.id\n                            }),\n                            type: 'POST',\n                            contentType: 'application/json',\n                            dataType: 'json',\n                            data: JSON.stringify({ body: xml }),\n                            method: 'PATCH',\n                            noToken: true\n                        }),\n                        styleEditor.save()\n                    ])\n                        .then(() => {\n                            if (!silent) {\n                                this.trigger('success');\n                            }\n\n                            this.trigger('saved');\n                        })\n                        .catch(err => {\n                            this.trigger('error', err);\n                        });\n                });\n\n                this.on('exit', function () {\n                    $('.item-editor-item', areaBroker.getItemPanelArea()).empty();\n                    this.destroy();\n                });\n\n                loadSharedStimulus(config.properties.id, config.properties.uri, config.properties.assetDataUrl)\n                    .then(item => {\n                        if (!_.isObject(item)) {\n                            this.trigger('error', new Error(`Unable to load the item ${config.properties.label}`));\n                            return;\n                        }\n\n                        this.item = item;\n                    })\n                    .then(() => pluginRun('init'))\n                    .then(() => {\n                        /**\n                         * @event sharedStimulusCreator#init the initialization is done\n                         * @param {Object} item - the loaded item\n                         */\n                        this.trigger('init', this.item);\n                    })\n                    .then(() => {\n                        // forward context error\n                        qtiCreatorContext.on('error', err => {\n                            this.trigger('error', err);\n                        });\n                        return qtiCreatorContext.init();\n                    })\n                    .catch(err => {\n                        this.trigger('error', err);\n                    });\n\n                return this;\n            },\n\n            /**\n             * Renders the creator\n             * Because of the actual structure, it also intialize some components (panels, toolbars, etc.).\n             *\n             * @returns {sharedStimulusCreator} chains\n             * @fires sharedStimulusCreator#render - once everything is in place\n             * @fires sharedStimulusCreator#ready - once the creator's components' are ready (not yet reliable)\n             * @fires sharedStimulusCreator#error - if something went wrong\n             */\n            render() {\n                const self = this;\n                const item = this.getItem();\n\n                if (!item || !_.isFunction(item.getUsedClasses)) {\n                    return this.trigger('error', new Error('We need an item to render.'));\n                }\n\n                //configure commonRenderer for the preview and initial qti element rendering\n                commonRenderer.setContext(areaBroker.getItemPanelArea());\n                commonRenderer.get(true, config).setOption('baseUrl', config.properties.baseUrl);\n\n                interactionPanel(areaBroker.getInteractionPanelArea());\n\n                //the renderers' widgets do not handle async yet, so we rely on this event\n                //TODO ready should be triggered once every renderer's widget is done (ie. promisify everything)\n                $(document).on('ready.qti-widget', (e, elt) => {\n                    if (elt.element.qtiClass === 'assessmentItem') {\n                        this.trigger('ready');\n                    }\n                });\n                // highlite passage creator container when it's in focus\n                $(document).on('afterStateInit.qti-widget', function (e, element, state) {\n                    if (element.getRootElement().data('widget')) {\n                        const $itemContainer = element.getRootElement().data('widget').$container;\n                        switch (state.name) {\n                            case 'active':\n                                if (!Element.isA(element, 'assessmentItem')) {\n                                    $itemContainer.removeClass('focus-border');\n                                }\n                                break;\n\n                            case 'sleep':\n                                if (!$itemContainer.find('.widget-box.edit-active').length) {\n                                    $itemContainer.addClass('focus-border');\n                                    styleEditor.setHashClass(sharedStimulusCreator.hashClass);\n                                }\n                                break;\n                        }\n                    }\n                });\n\n                // pass an context reference to the renderer\n                config.qtiCreatorContext = qtiCreatorContext;\n\n                creatorRenderer\n                    .get(true, config, areaBroker)\n                    .setOptions(config.properties)\n                    .load(function () {\n                        let widget;\n\n                        //set renderer\n                        item.setRenderer(this);\n\n                        //render item (body only) into the \"drop-area\"\n                        areaBroker.getItemPanelArea().append(item.render());\n\n                        //\"post-render it\" to initialize the widget\n                        Promise.all(item.postRender(_.clone(config.properties)))\n                            .then(function () {\n                                //set reference to item widget object\n                                areaBroker.getContainer().data('widget', item);\n\n                                widget = item.data('widget');\n\n                                item.attributes.class\n                                    ? styleEditor.setHashClass(item.attributes.class)\n                                    : styleEditor.generateHashClass();\n                                sharedStimulusCreator.hashClass = styleEditor.getHashClass();\n                                // set class on container for style editor\n                                widget.$container.find('.qti-itemBody').addClass(sharedStimulusCreator.hashClass);\n\n                                propertiesPanel(areaBroker.getPropertyPanelArea(), widget, config.properties);\n\n                                //init event listeners:\n                                eventHelper.initElementToWidgetListeners();\n\n                                return pluginRun('render').then(function () {\n                                    self.trigger('render');\n                                });\n                            })\n                            .catch(function (err) {\n                                self.trigger('error', err);\n                            });\n                    }, item.getUsedClasses());\n\n                return this;\n            },\n\n            /**\n             * Clean up everything and destroy the sharedStimulusCreator\n             *\n             * @returns {sharedStimulusCreator} chains\n             */\n            destroy() {\n                $(document).off('.qti-widget');\n\n                styleEditor.clearCache();\n\n                pluginRun('destroy')\n                    .then(() => qtiCreatorContext.destroy())\n                    .then(() => {\n                        this.trigger('destroy');\n                    })\n                    .catch(err => {\n                        this.trigger('error', err);\n                    });\n                return this;\n            },\n\n            //accessors\n\n            /**\n             * Give an access to the loaded item\n             * @returns {Object} the item\n             */\n            getItem() {\n                return this.item;\n            },\n\n            getSharedStimulusId() {\n                return config.properties.id;\n            },\n\n            /**\n             * Give an access to the config\n             * @returns {Object} the config\n             */\n            getConfig() {\n                return config;\n            }\n        });\n\n        return sharedStimulusCreator;\n    };\n\n    return sharedStimulusCreatorFactory;\n});\n\n","\ndefine('tpl!taoMediaManager/qtiCreator/component/tpl/sharedStimulusAuthoring', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", helper, options, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;\n\n\n  buffer += \"<div id=\\\"item-editor-scope\\\" data-content-target=\\\"wide\\\">\\n\\n    <nav class=\\\"action-bar plain content-action-bar horizontal-action-bar\\\">\\n        <ul class=\\\"menu-left action-group plain item-editor-menu\\\"></ul>\\n\\n        <ul class=\\\"menu action-group plain item-editor-menu\\\"></ul>\\n\\n        <ul class=\\\"menu-right action-group plain item-editor-menu\\\">\\n        </ul>\\n    </nav>\\n    <div class=\\\"wrapper clearfix content sidebar-popup-parent\\\" id=\\\"item-editor-wrapper\\\">\\n\\n        <!-- interaction panel -->\\n        <div class=\\\"item-editor-sidebar-wrapper left-bar\\\">\\n            <form class=\\\"item-editor-sidebar\\\" id=\\\"item-editor-interaction-bar\\\" autocomplete=\\\"off\\\"></form>\\n        </div>\\n\\n        <!-- item panel -->\\n        <main id=\\\"item-editor-panel\\\" class=\\\"clearfix\\\">\\n\\n            <div class=\\\"item-editor-bar\\\">\\n                <h1 class=\\\"truncate\\\"></h1>\\n                <div id=\\\"toolbar-top\\\"></div>\\n            </div>\\n\\n            <div id=\\\"item-editor-scoll-container\\\">\\n                <div id=\\\"item-editor-scroll-outer\\\">\\n                    <div id=\\\"item-editor-scroll-inner\\\">\\n                        <!-- item goes here -->\\n                    </div>\\n                </div>\\n            </div>\\n\\n        </main>\\n\\n        <!-- properties panel -->\\n        <div class=\\\"item-editor-sidebar-wrapper right-bar sidebar-popup-parent\\\">\\n            <div class=\\\"item-editor-sidebar\\\" id=\\\"item-editor-item-widget-bar\\\">\\n                <div class=\\\"item-editor-item-related sidebar-right-section-box\\\" id=\\\"item-editor-item-property-bar\\\">\\n                    <section class=\\\"tool-group clearfix\\\" id=\\\"sidebar-right-passage-properties\\\">\\n                        <h2>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Passage Properties\", options) : helperMissing.call(depth0, \"__\", \"Passage Properties\", options)))\n    + \"</h2>\\n                        <div class=\\\"panel\\\"></div>\\n                    </section>\\n                    <section class=\\\"tool-group clearfix\\\" id=\\\"sidebar-right-style-editor\\\">\\n\\n                        <h2>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Passage Style\", options) : helperMissing.call(depth0, \"__\", \"Passage Style\", options)))\n    + \"</h2>\\n\\n                        <div class=\\\"panel color-picker-panel\\\">\\n                            <div class=\\\"item-editor-color-picker sidebar-popup-container-box\\\">\\n                                <div class=\\\"color-picker-container sidebar-popup\\\">\\n                                    <div class=\\\"sidebar-popup-title\\\">\\n                                        <h3 class=\\\"color-picker-title\\\"></h3>\\n                                        <a class=\\\"closer\\\" href=\\\"#\\\" data-close=\\\"#color-picker-container\\\"></a>\\n                                    </div>\\n                                    <div class=\\\"sidebar-popup-content\\\">\\n                                        <div class=\\\"color-picker\\\"></div>\\n                                        <input class=\\\"color-picker-input\\\" type=\\\"text\\\" value=\\\"#000000\\\">\\n                                    </div>\\n                                </div>\\n                                <div class=\\\"reset-group\\\">\\n                                    <div class=\\\"clearfix\\\">\\n                                        <label for=\\\"initial-bg\\\" class=\\\"truncate\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Background color\", options) : helperMissing.call(depth0, \"__\", \"Background color\", options)))\n    + \"</label>\\n                                        <button class=\\\"icon-eraser reset-button\\\" data-value=\\\"background-color\\\"\\n                                            aria-label=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Remove custom background color\", options) : helperMissing.call(depth0, \"__\", \"Remove custom background color\", options)))\n    + \"\\\"></button>\\n                                        <button class=\\\"color-trigger\\\" id=\\\"initial-bg\\\" data-value=\\\"background-color\\\"\\n                                            data-target=\\\"body div.qti-item .hashClass\\\" data-additional=\\\"padding:20px\\\"></button>\\n                                    </div>\\n                                    <div class=\\\"clearfix\\\">\\n                                        <label for=\\\"initial-color\\\" class=\\\"truncate\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Text color\", options) : helperMissing.call(depth0, \"__\", \"Text color\", options)))\n    + \"</label>\\n                                        <button class=\\\"icon-eraser reset-button\\\" data-value=\\\"color\\\"\\n                                              aria-label=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Remove custom text color\", options) : helperMissing.call(depth0, \"__\", \"Remove custom text color\", options)))\n    + \"\\\"></button>\\n                                        <button class=\\\"color-trigger\\\" id=\\\"initial-color\\\" data-value=\\\"color\\\"\\n                                              data-target=\\\"body div.qti-item .hashClass\\\"></button>\\n                                    </div>\\n                                    <div class=\\\"clearfix\\\">\\n                                        <label for=\\\"initial-color\\\" class=\\\"truncate\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Border color\", options) : helperMissing.call(depth0, \"__\", \"Border color\", options)))\n    + \"</label>\\n                                        <button class=\\\"icon-eraser reset-button\\\" data-value=\\\"color\\\"\\n                                              aria-label=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Remove custom border color\", options) : helperMissing.call(depth0, \"__\", \"Remove custom border color\", options)))\n    + \"\\\"></button>\\n                                        <button class=\\\"color-trigger\\\" id=\\\"initial-color\\\" data-value=\\\"border-color\\\"\\n                                              data-target=\\\"body div.qti-item .hashClass\\\" data-additional=\\\"border-width:4px;border-style:solid;padding:20px\\\"></button>\\n                                    </div>\\n                                    <div class=\\\"clearfix\\\">\\n                                        <label for=\\\"initial-color\\\" class=\\\"truncate\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Table headings\", options) : helperMissing.call(depth0, \"__\", \"Table headings\", options)))\n    + \"</label>\\n                                        <button class=\\\"icon-eraser reset-button\\\" data-value=\\\"color\\\"\\n                                              aria-label=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Remove custom background color\", options) : helperMissing.call(depth0, \"__\", \"Remove custom background color\", options)))\n    + \"\\\"></button>\\n                                        <button class=\\\"color-trigger\\\" id=\\\"initial-color\\\" data-value=\\\"background-color\\\"\\n                                              data-target=\\\"body div.qti-item .hashClass table th\\\"></button>\\n                                    </div>\\n                                </div>\\n                            </div>\\n                        </div>\\n                        <hr>\\n                        <div class=\\\"panel\\\">\\n\\n                            <div>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Font family\", options) : helperMissing.call(depth0, \"__\", \"Font family\", options)))\n    + \"</div>\\n\\n                            <div class=\\\"reset-group\\\">\\n                                <select\\n                                    data-target=\\\"body div.qti-item .hashClass\\\"\\n                                    id=\\\"item-editor-font-selector\\\"\\n                                    data-has-search=\\\"false\\\"\\n                                    data-placeholder=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Default\", options) : helperMissing.call(depth0, \"__\", \"Default\", options)))\n    + \"\\\"\\n                                    class=\\\"select2 has-icon\\\"\\n                                    data-role=\\\"font-selector\\\"></select>\\n                                <button class=\\\"icon-eraser reset-button\\\" data-role=\\\"font-selector-reset\\\"\\n                                      aria-label=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Remove custom font family\", options) : helperMissing.call(depth0, \"__\", \"Remove custom font family\", options)))\n    + \"\\\"></button>\\n                            </div>\\n\\n                        </div>\\n                        <div class=\\\"panel\\\">\\n                            <div>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Font size\", options) : helperMissing.call(depth0, \"__\", \"Font size\", options)))\n    + \"</div>\\n                            <div class=\\\"reset-group\\\">\\n                                        <span id=\\\"item-editor-font-size-changer\\\" data-target=\\\"body div.qti-item .hashClass\\\">\\n                                            <button data-action=\\\"reduce\\\" aria-label=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Reduce font size\", options) : helperMissing.call(depth0, \"__\", \"Reduce font size\", options)))\n    + \"\\\"\\n                                               class=\\\"icon-smaller\\\"></button>\\n                                            <button data-action=\\\"enlarge\\\" aria-label=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Enlarge font size\", options) : helperMissing.call(depth0, \"__\", \"Enlarge font size\", options)))\n    + \"\\\"\\n                                               class=\\\"icon-larger\\\"></button>\\n                                        </span>\\n\\n                                <span id=\\\"item-editor-font-size-manual-input\\\" class=\\\"item-editor-unit-input-box\\\">\\n                                            <input type=\\\"text\\\" class=\\\"item-editor-font-size-text has-icon\\\"\\n                                                   placeholder=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"e.g. 13\", options) : helperMissing.call(depth0, \"__\", \"e.g. 13\", options)))\n    + \"\\\">\\n                                                <span class=\\\"unit-indicator\\\">px</span>\\n                                        </span>\\n                                <button class=\\\"icon-eraser reset-button\\\" data-role=\\\"font-size-reset\\\"\\n                                      aria-label=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Remove custom font size\", options) : helperMissing.call(depth0, \"__\", \"Remove custom font size\", options)))\n    + \"\\\"></button>\\n                            </div>\\n\\n                        </div>\\n\\n                    </section>\\n                </div>\\n                <div class=\\\"item-editor-item-related sidebar-right-section-box\\\" id=\\\"item-editor-text-property-bar\\\">\\n                    <section class=\\\"tool-group clearfix\\\" id=\\\"sidebar-right-style-editor\\\">\\n\\n                        <h2>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Text Block Style\", options) : helperMissing.call(depth0, \"__\", \"Text Block Style\", options)))\n    + \"</h2>\\n\\n                        <div class=\\\"panel color-picker-panel\\\">\\n                            <div class=\\\"item-editor-color-picker sidebar-popup-container-box\\\">\\n                                <div class=\\\"color-picker-container sidebar-popup\\\">\\n                                    <div class=\\\"sidebar-popup-title\\\">\\n                                        <h3 id=\\\"color-picker-title\\\"></h3>\\n                                        <a class=\\\"closer\\\" href=\\\"#\\\" data-close=\\\"#color-picker-container\\\"></a>\\n                                    </div>\\n                                    <div class=\\\"sidebar-popup-content\\\">\\n                                        <div class=\\\"color-picker\\\"></div>\\n                                        <input class=\\\"color-picker-input\\\" type=\\\"text\\\" value=\\\"#000000\\\">\\n                                    </div>\\n                                </div>\\n                                <div class=\\\"reset-group\\\">\\n                                    <div class=\\\"clearfix\\\">\\n                                        <label for=\\\"initial-bg\\\" class=\\\"truncate\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Background color\", options) : helperMissing.call(depth0, \"__\", \"Background color\", options)))\n    + \"</label>\\n                                        <button class=\\\"icon-eraser reset-button\\\" data-value=\\\"background-color\\\"\\n                                              aria-label=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Remove custom background color\", options) : helperMissing.call(depth0, \"__\", \"Remove custom background color\", options)))\n    + \"\\\"></button>\\n                                        <button class=\\\"color-trigger\\\" id=\\\"initial-bg\\\" data-value=\\\"background-color\\\"\\n                                              data-target=\\\"body div.qti-item .custom-text-box.hashClass\\\" data-additional=\\\"padding:20px\\\"></button>\\n                                    </div>\\n                                    <div class=\\\"clearfix\\\">\\n                                        <label for=\\\"initial-color\\\" class=\\\"truncate\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Text color\", options) : helperMissing.call(depth0, \"__\", \"Text color\", options)))\n    + \"</label>\\n                                        <button class=\\\"icon-eraser reset-button\\\" data-value=\\\"color\\\"\\n                                              aria-label=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Remove custom text color\", options) : helperMissing.call(depth0, \"__\", \"Remove custom text color\", options)))\n    + \"\\\"></button>\\n                                        <button class=\\\"color-trigger\\\" id=\\\"initial-color\\\" data-value=\\\"color\\\"\\n                                              data-target=\\\"body div.qti-item .custom-text-box.hashClass\\\"></button>\\n                                    </div>\\n                                    <div class=\\\"clearfix\\\">\\n                                        <label for=\\\"initial-color\\\" class=\\\"truncate\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Border color\", options) : helperMissing.call(depth0, \"__\", \"Border color\", options)))\n    + \"</label>\\n                                        <button class=\\\"icon-eraser reset-button\\\" data-value=\\\"color\\\"\\n                                              aria-label=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Remove custom border color\", options) : helperMissing.call(depth0, \"__\", \"Remove custom border color\", options)))\n    + \"\\\"></button>\\n                                        <button class=\\\"color-trigger\\\" id=\\\"initial-color\\\" data-value=\\\"border-color\\\"\\n                                              data-target=\\\"body div.qti-item .custom-text-box.hashClass\\\" data-additional=\\\"border-width:4px;border-style:solid;padding:20px\\\"></button>\\n                                    </div>\\n                                    <div class=\\\"clearfix\\\">\\n                                        <label for=\\\"initial-color\\\" class=\\\"truncate\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Table headings\", options) : helperMissing.call(depth0, \"__\", \"Table headings\", options)))\n    + \"</label>\\n                                        <button class=\\\"icon-eraser reset-button\\\" data-value=\\\"color\\\"\\n                                              aria-label=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Remove custom background color\", options) : helperMissing.call(depth0, \"__\", \"Remove custom background color\", options)))\n    + \"\\\"></button>\\n                                        <button class=\\\"color-trigger\\\" id=\\\"initial-color\\\" data-value=\\\"background-color\\\"\\n                                              data-target=\\\"body div.qti-item .custom-text-box.hashClass table th\\\"></button>\\n                                    </div>\\n                                </div>\\n                            </div>\\n                        </div>\\n                        <hr>\\n                        <div class=\\\"panel\\\">\\n\\n                            <div>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Font family\", options) : helperMissing.call(depth0, \"__\", \"Font family\", options)))\n    + \"</div>\\n\\n                            <div class=\\\"reset-group\\\">\\n                                <select\\n                                    data-target=\\\"body div.qti-item .custom-text-box.hashClass\\\"\\n                                    id=\\\"item-editor-font-selector\\\"\\n                                    data-has-search=\\\"false\\\"\\n                                    data-placeholder=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Default\", options) : helperMissing.call(depth0, \"__\", \"Default\", options)))\n    + \"\\\"\\n                                    class=\\\"select2 has-icon\\\"\\n                                    data-role=\\\"font-selector\\\"></select>\\n                                <button class=\\\"icon-eraser reset-button\\\" data-role=\\\"font-selector-reset\\\"\\n                                      aria-label=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Remove custom font family\", options) : helperMissing.call(depth0, \"__\", \"Remove custom font family\", options)))\n    + \"\\\"></button>\\n                            </div>\\n\\n                        </div>\\n                        <div class=\\\"panel\\\">\\n                            <div>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Font size\", options) : helperMissing.call(depth0, \"__\", \"Font size\", options)))\n    + \"</div>\\n                            <div class=\\\"reset-group\\\">\\n                                        <span id=\\\"item-editor-font-size-changer\\\" data-target=\\\"body div.qti-item .custom-text-box.hashClass\\\">\\n                                            <button data-action=\\\"reduce\\\" aria-label=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Reduce font size\", options) : helperMissing.call(depth0, \"__\", \"Reduce font size\", options)))\n    + \"\\\"\\n                                               class=\\\"icon-smaller\\\"></button>\\n                                            <button data-action=\\\"enlarge\\\" aria-label=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Enlarge font size\", options) : helperMissing.call(depth0, \"__\", \"Enlarge font size\", options)))\n    + \"\\\"\\n                                               class=\\\"icon-larger\\\"></button>\\n                                        </span>\\n\\n                                <span id=\\\"item-editor-font-size-manual-input\\\" class=\\\"item-editor-unit-input-box\\\">\\n                                            <input type=\\\"text\\\" class=\\\"item-editor-font-size-text has-icon\\\"\\n                                                   placeholder=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"e.g. 13\", options) : helperMissing.call(depth0, \"__\", \"e.g. 13\", options)))\n    + \"\\\">\\n                                                <span class=\\\"unit-indicator\\\">px</span>\\n                                        </span>\\n                                <button class=\\\"icon-eraser reset-button\\\" data-role=\\\"font-size-reset\\\"\\n                                      aria-label=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Remove custom font size\", options) : helperMissing.call(depth0, \"__\", \"Remove custom font size\", options)))\n    + \"\\\"></button>\\n                            </div>\\n\\n                        </div>\\n\\n                    </section>\\n                    <section class=\\\"tool-group clearfix\\\" id=\\\"sidebar-right-text-block-properties\\\">\\n                        <h2>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Text Block Properties\", options) : helperMissing.call(depth0, \"__\", \"Text Block Properties\", options)))\n    + \"</h2>\\n\\n                        <div class=\\\"panel\\\"></div>\\n                    </section>\\n                </div>\\n                <div class=\\\"item-editor-body-element-related sidebar-right-section-box\\\" id=\\\"item-editor-body-element-property-bar\\\">\\n                    <section class=\\\"tool-group clearfix\\\" id=\\\"sidebar-right-body-element-properties\\\">\\n                        <h2><?= __('Element Properties') ?></h2>\\n\\n                        <div class=\\\"panel\\\"></div>\\n                    </section>\\n                </div>\\n            </div>\\n        </div>\\n        <!-- /properties panel -->\\n\\n\\n    </div>\\n\\n    <div id=\\\"mediaManager\\\"></div>\\n    <div id=\\\"modal-container\\\"></div>\\n</div>\";\n  return buffer;\n  });\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 Open Assessment Technologies SA ;\n */\n/**\n * @author Jean-Sébastien Conan <jean-sebastien@taotesting.com>\n */\ndefine('taoMediaManager/qtiCreator/component/sharedStimulusAuthoring',[\n    'lodash',\n    'ui/component',\n    'core/pluginLoader',\n    'taoMediaManager/qtiCreator/sharedStimulusCreator',\n    'taoQtiItem/qtiCreator/editor/areaBroker',\n    'tpl!taoMediaManager/qtiCreator/component/tpl/sharedStimulusAuthoring',\n    'context',\n    'css!taoQtiItemCss/qti-runner.css',\n    'css!taoQtiItemCss/themes/default.css',\n    'css!taoQtiItemCss/item-creator.css'\n], function (\n    _,\n    componentFactory,\n    pluginLoaderFactory,\n    sharedStimulusCreatorFactory,\n    areaBrokerFactory,\n    componentTpl,\n    context\n) {\n    'use strict';\n\n    const defaultPlugins = [\n        {\n            module: 'taoQtiItem/qtiCreator/plugins/content/title',\n            bundle: 'taoQtiItem/loader/taoQtiItem.min',\n            category: 'content'\n        },\n        {\n            module: 'taoMediaManager/qtiCreator/plugins/navigation/back',\n            bundle: 'taoMediaManager/loader/taoMediaManager.min',\n            category: 'menu'\n        },\n        {\n            module: 'taoMediaManager/qtiCreator/plugins/menu/save',\n            bundle: 'taoMediaManager/loader/taoMediaManager.min',\n            category: 'menu'\n        },\n        {\n            module: 'taoMediaManager/qtiCreator/plugins/menu/preview',\n            bundle: 'taoMediaManager/loader/taoMediaManager.min',\n            category: 'menu'\n        },\n        {\n            module: 'taoQtiItem/qtiCreator/plugins/content/changeTracker',\n            bundle: 'taoQtiItem/loader/taoQtiItem.min',\n            category: 'content'\n        },\n        {\n            module: 'taoMediaManager/qtiCreator/plugins/content/blockAdder',\n            bundle: 'taoMediaManager/loader/taoMediaManager.min',\n            category: 'content'\n        }\n    ];\n    /**\n     * Embeds the assets creator UI in a component\n     *\n     * @example\n     *  const container = $();\n     *  const config = {\n     *      plugins: [],\n     *      properties: {\n     *          uri: 'http://item#rdf-123',\n     *          baseUrl: 'http://foo/bar/',\n     *          // ...\n     *      }\n     *  };\n     *  const component = sharedStimulusAuthoringFactory(container, config)\n     *      .on('ready', function onComponentReady() {\n     *          // ...\n     *      });\n     *\n     * @param {HTMLElement|String} container\n     * @param {Object} config - The setup for the sharedStimulus creator\n     * @param {Object} config.properties - The list of properties expected by the sharedStimulus creator\n     * @param {Object} config.properties.uri - The URI of the sharedStimulus to author\n     * @param {Object} config.properties.id - The ID of the sharedStimulus to author\n     * @param {Object} config.properties.baseUrl - The base URL to retrieve the assets\n     * @param {String} config.properties.sharedStimulusDataUrl - URL for getting sharedStimulus data (passed through to sharedStimulusCreator)\n     * @param {Object[]} [config.plugins] - Additional plugins to load\n     * @returns {component}\n     * @fires ready - When the component is ready to work\n     */\n    function sharedStimulusAuthoringFactory(container, config = {}) {\n        let areaBroker;\n        let sharedStimulusCreator;\n\n        const plugins = Array.isArray(config.plugins) ? config.plugins : [];\n        config.plugins = [...defaultPlugins, ...plugins];\n\n        const pluginLoader = pluginLoaderFactory();\n\n        const api = {\n            /**\n             * Gets access to the area broker\n             * @returns {areaBroker}\n             */\n            getAreaBroker() {\n                return areaBroker;\n            }\n        };\n\n        const sharedStimulusAuthoring = componentFactory(api)\n            // set the component's layout\n            .setTemplate(componentTpl)\n\n            // auto render on init\n            .on('init', function () {\n                // load plugins dynamically\n                _.forEach(this.getConfig().plugins, plugin => {\n                    if (plugin && plugin.module) {\n                        if (plugin.exclude) {\n                            pluginLoader.remove(plugin.module);\n                        } else {\n                            pluginLoader.add(plugin);\n                        }\n                    }\n                });\n\n                // load the plugins, then render the sharedStimulus creator\n                pluginLoader\n                    .load(!!context.bundle)\n                    .then(() => this.render(container))\n                    .catch(err => this.trigger('error', err));\n            })\n\n            // renders the component\n            .on('render', function () {\n                const $container = this.getElement();\n                areaBroker = areaBrokerFactory($container, {\n                    menu: $container.find('.menu'),\n                    menuLeft: $container.find('.menu-left'),\n                    menuRight: $container.find('.menu-right'),\n                    contentCreatorPanel: $container.find('#item-editor-panel'),\n                    editorBar: $container.find('#item-editor-panel .item-editor-bar'),\n                    title: $container.find('#item-editor-panel .item-editor-bar h1'),\n                    toolbar: $container.find('#item-editor-panel .item-editor-bar #toolbar-top'),\n                    interactionPanel: $container.find('#item-editor-interaction-bar'),\n                    propertyPanel: $container.find('#item-editor-item-widget-bar'),\n                    itemPanel: $container.find('#item-editor-scroll-inner'),\n                    itemPropertyPanel: $container.find('#sidebar-right-item-properties'),\n                    itemStylePanel: $container.find('#item-style-editor-bar'),\n                    modalContainer: $container.find('#modal-container'),\n                    elementPropertyPanel: $container.find('#item-editor-body-element-property-bar .panel')\n                });\n\n                sharedStimulusCreator = sharedStimulusCreatorFactory(\n                    this.getConfig(),\n                    areaBroker,\n                    pluginLoader.getPlugins()\n                )\n                    .spread(this, 'error success ready')\n                    .on('init', function () {\n                        this.render();\n                    })\n                    .on('destroy', function () {\n                        sharedStimulusCreator = null;\n                        sharedStimulusAuthoring.destroy();\n                    })\n                    .init();\n            })\n\n            .on('destroy', function () {\n                if (sharedStimulusCreator) {\n                    sharedStimulusCreator.destroy();\n                }\n                sharedStimulusCreator = null;\n                areaBroker = null;\n            });\n\n        // initialize the component with the provided config\n        // defer the call to allow to listen to the init event\n        _.defer(() => sharedStimulusAuthoring.init(config));\n\n        return sharedStimulusAuthoring;\n    }\n\n    return sharedStimulusAuthoringFactory;\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020-2021 (original work) Open Assessment Technologies SA ;\n */\n\n/**\n * @author Juan Luis Gutierrez Dos Santos <juanluis.gutierrezdossantos@taotesting.com>\n */\ndefine('taoMediaManager/controller/authoring',[\n    'i18n',\n    'lodash',\n    'jquery',\n    'uri',\n    'taoMediaManager/qtiCreator/component/sharedStimulusAuthoring',\n    'ui/feedback',\n    'util/url',\n    'core/dataProvider/request',\n    'core/logger'\n], function (__, _, $, uri, sharedStimulusAuthoringFactory, feedback, urlUtil, request, loggerFactory) {\n    'use strict';\n\n    const logger = loggerFactory('taoMediaManager/authoring');\n\n    const manageMediaController = {\n        /**\n         * Controller entry point\n         */\n        start() {\n            const $panel = $('#panel-authoring');\n            const assetDataUrl = urlUtil.route('get', 'SharedStimulus', 'taoMediaManager');\n            const assetId = uri.decode($panel.attr('data-id'));\n            let previewEnabled = false;\n\n            request(assetDataUrl, { id : assetId })\n                .then(response => {\n                    if (response.permissions.includes('READ')) {\n                        previewEnabled = true;\n                    }\n                }).then(() => {\n                    sharedStimulusAuthoringFactory($panel, {\n                        properties: {\n                            uri: $panel.attr('data-uri'),\n                            id: assetId,\n                            assetDataUrl,\n                            fileUploadUrl: urlUtil.route('upload', 'ItemContent', 'taoItems'),\n                            fileDeleteUrl: urlUtil.route('delete', 'ItemContent', 'taoItems'),\n                            fileDownloadUrl: urlUtil.route('download', 'ItemContent', 'taoItems'),\n                            fileExistsUrl: urlUtil.route('fileExists', 'ItemContent', 'taoItems'),\n                            getFilesUrl: urlUtil.route('files', 'ItemContent', 'taoItems'),\n                            baseUrl: urlUtil.route('getFile', 'MediaManager', 'taoMediaManager', { uri: '' }),\n                            path: 'taomedia://mediamanager/',\n                            root: 'mediamanager',\n                            lang: 'en-US',\n                            previewEnabled: previewEnabled,\n                            loadCssUrl: urlUtil.route('load', 'SharedStimulusStyling', 'taoMediaManager'),\n                            saveCssUrl: urlUtil.route('save', 'SharedStimulusStyling', 'taoMediaManager')\n                        }\n                    })\n                        .on('success', () => {\n                            feedback().success(__('Your passage is saved'));\n                        })\n                        .on('error', err => {\n                            if (!_.isUndefined(err.message)) {\n                                feedback().error(err.message);\n                            }\n                            logger.error(err);\n                        });\n                });\n        }\n    };\n\n    return manageMediaController;\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 (original work) Open Assessment Technologies SA ;\n */\n/**\n * @author Jean-Sébastien Conan <jean-sebastien@taotesting.com>\n */\ndefine('taoMediaManager/previewer/component/qtiSharedStimulusItem',[\n    'context',\n    'taoQtiTestPreviewer/previewer/runner',\n    'css!taoQtiTestPreviewer/previewer/provider/item/css/item'\n], function (context, previewerFactory) {\n    'use strict';\n\n    /**\n     * Builds a test runner to preview test item\n     * @param {jQuery|HTMLElement|String} container - The container in which renders the component\n     * @param {Object} [config] - The testRunner options\n     * @param {String} [config.itemUri] - The ID of the SharedStimulus (for consisten with other providers)\n     * @param {Object[]} [config.plugins] - Additional plugins to load\n     * @param {String} [config.fullPage] - Force the previewer to occupy the full window.\n     * @param {String} [config.readOnly] - Do not allow to modify the previewed item.\n     * @param {Function} [template] - An optional template for the component\n     * @returns {previewer}\n     */\n    return function qtiItemPreviewerFactory(container, config = {}, template = null) {\n        const testRunnerConfig = {\n            testDefinition: 'test-container',\n            serviceCallId: 'previewer',\n            providers: {\n                runner: {\n                    id: 'qtiItemPreviewer',\n                    module: 'taoQtiTestPreviewer/previewer/provider/item/item',\n                    bundle: 'taoQtiTestPreviewer/loader/qtiPreviewer.min',\n                    category: 'runner'\n                },\n                proxy: {\n                    id: 'qtiSharedStimulusItemProxy',\n                    module: 'taoMediaManager/previewer/proxy/qtiSharedStimulusItem',\n                    bundle: 'taoMediaManager/loader/taoMediaManager.min',\n                    category: 'proxy'\n                },\n                communicator: {\n                    id: 'request',\n                    module: 'core/communicator/request',\n                    bundle: 'loader/vendor.min',\n                    category: 'communicator'\n                },\n                plugins: config.plugins || []\n            },\n            options: {\n                view: config.view,\n                readOnly: config.readOnly,\n                fullPage: config.fullPage,\n                plugins: config.pluginsOptions,\n                hideActionBars: config.hideActionBars\n            },\n            proxyProvider: 'qtiSharedStimulusItemProxy'\n        };\n\n        //extra context config\n        testRunnerConfig.loadFromBundle = !!context.bundle;\n\n        return previewerFactory(container, testRunnerConfig, template).on('ready', function(runner) {\n            runner.on('renderitem', () => {\n                if (config.itemState) {\n                    runner.itemRunner.setState(config.itemState);\n                }\n                this.trigger('preview-loaded');\n            });\n            if (config.itemUri) {\n                return runner.loadItem(config.itemUri);\n            }\n        });\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 (original work) Open Assessment Technologies SA ;\n */\n\n/**\n * @author Juan Luis Gutierrez Dos Santos <juanluis.gutierrezdossantos@taotesting.com>\n */\ndefine('taoMediaManager/controller/editInstance',[\n    'jquery',\n    'lodash',\n    'layout/actions/binder',\n    'ui/previewer',\n    'util/url',\n    'taoMediaManager/previewer/component/qtiSharedStimulusItem',\n    'core/logger',\n    'ui/feedback',\n    'layout/loading-bar'\n], function($, _, binder, previewer, urlUtil, qtiItemPreviewerFactory, loggerFactory, feedback, loadingBar) {\n    'use strict';\n\n    const logger = loggerFactory('taoMediaManager/editInstance');\n\n    const manageMediaController =  {\n\n        /**\n         * Controller entry point\n         */\n        start() {\n\n            const $previewer = $('.previewer');\n            let file = {};\n            file.url = $previewer.data('url');\n            file.mime = $previewer.data('type');\n\n            const isPreviewEnabled = $previewer.data('enabled');\n            const isPassage = file.mime === 'application/qti+xml';\n\n            if (isPreviewEnabled) {\n                if (!isPassage) {\n                    // to hide the loading icon, inherited from the .previewer\n                    file.containerClass = 'no-background';\n                    $previewer.previewer(file);\n                } else {\n                    loadingBar.start();\n                    qtiItemPreviewerFactory($previewer, {itemUri:  $('#edit-media').data('uri')})\n                        .on('error', function (err) {\n                            if (!_.isUndefined(err.message)) {\n                                feedback().error(err.message);\n                            }\n                            logger.error(err);\n                        })\n                        .on('preview-loaded', loadingBar.stop);\n                }\n            }\n\n            if (isPassage) {\n                $('#media-authoring').show();\n            } else {\n                $('#media-authoring').hide();\n            }\n\n            $('#edit-media').off()\n                .on('click', function() {\n                    const action = { binding : 'load' , url: urlUtil.route('editMedia', 'MediaImport', 'taoMediaManager') };\n                    binder.exec(action, { classUri : this.dataset.classuri , id : this.dataset.uri } || this._resourceContext);\n                });\n        }\n    };\n\n    return manageMediaController;\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n *\n */\n\n//@see http://forge.taotesting.com/projects/tao/wiki/Front_js\ndefine('taoMediaManager/controller/routes',[],function(){\n    'use strict';\n\n    return {\n        'MediaManager': {\n            'deps': 'controller/actions',\n            'actions': {\n                'editInstance' : 'controller/editInstance',\n                'authoring': 'controller/authoring'\n            }\n        }\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 (original work) Open Assessment Technologies SA ;\n */\n/**\n * @author Jean-Sébastien Conan <jean-sebastien@taotesting.com>\n */\ndefine('taoMediaManager/previewer/adapter/item/qtiSharedStimulusItem',['lodash', 'core/logger', 'taoMediaManager/previewer/component/qtiSharedStimulusItem', 'ui/feedback'], function (\n    _,\n    loggerFactory,\n    qtiItemPreviewerFactory,\n    feedback\n) {\n    'use strict';\n\n    const logger = loggerFactory('taoMediaManager/previewer');\n\n    /**\n     * List of required plugins that should be loaded in order to make the previewer work properly\n     * @type {Object[]}\n     */\n    const defaultPlugins = [\n        {\n            module: 'taoQtiTestPreviewer/previewer/plugins/controls/close',\n            bundle: 'taoQtiTestPreviewer/loader/qtiPreviewer.min',\n            category: 'controls'\n        },\n        {\n            module: 'taoQtiTestPreviewer/previewer/plugins/tools/scale/scale',\n            bundle: 'taoQtiTestPreviewer/loader/qtiPreviewer.min',\n            category: 'tools'\n        },\n        {\n            module: 'taoQtiTest/runner/plugins/tools/itemThemeSwitcher/itemThemeSwitcher',\n            bundle: 'taoQtiTest/loader/testPlugins.min',\n            category: 'tools'\n        }\n    ];\n\n    /**\n     * Wraps the legacy item previewer in order to be loaded by the taoItems previewer factory\n     */\n    return {\n        name: 'qtiSharedStimulusItem',\n\n        /**\n         * Builds and shows the legacy item previewer\n         *\n         * @param {String} sharedStimulusId - The ID of the SharedStimulus to load\n         * @param {Object} state - The state of the item\n         * @param {Object} [config] - Some config entries\n         * @param {Object[]} [config.plugins] - Additional plugins to load\n         * @param {String} [config.fullPage] - Force the previewer to occupy the full window.\n         * @param {String} [config.readOnly] - Do not allow to modify the previewed item.\n         * @returns {Object}\n         */\n        init(sharedStimulusId, config = {}) {\n            config.itemUri = sharedStimulusId;\n            config.plugins = Array.isArray(config.plugins) ? [...defaultPlugins, ...config.plugins] : defaultPlugins;\n            return qtiItemPreviewerFactory(window.document.body, config).on('error', function (err) {\n                if (!_.isUndefined(err.message)) {\n                    feedback().error(err.message);\n                }\n                logger.error(err);\n            });\n        }\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 (original work) Open Assessment Technologies SA ;\n */\n\n/**\n * Test runner proxy for the QTI item previewer\n *\n * @author Hanna Dzmitryieva <hanna@taotesting.com>\n */\ndefine('taoMediaManager/previewer/proxy/qtiSharedStimulusItem',[\n    'jquery',\n    'lodash',\n    'i18n',\n    'core/promiseQueue',\n    'core/dataProvider/request',\n    'util/url',\n    'taoMediaManager/qtiCreator/helper/createDummyItemData'\n], function ($, _, __, promiseQueue, request, urlUtil, creatorDummyItemData) {\n    'use strict';\n\n    const serviceController = 'SharedStimulus';\n    const serviceExtension = 'taoMediaManager';\n    /**\n     * QTI proxy definition\n     * Related to remote services calls\n     * @type {Object}\n     */\n    return {\n        name: 'qtiSharedStimulusItemProxy',\n\n        /**\n         * Installs the proxy\n         */\n        install: function install() {\n            /**\n             * A promise queue to ensure requests run sequentially\n             */\n            this.queue = promiseQueue();\n        },\n        /**\n         * Initializes the proxy\n         * @returns {Promise} - Returns a promise. The proxy will be fully initialized on resolve.\n         *                      Any error will be provided if rejected.\n         */\n        init: function init() {\n            // the method must return a promise with Object\n            return Promise.resolve({});\n        },\n\n        /**\n         * Uninstalls the proxy\n         * @returns {Promise} - Returns a promise. The proxy will be fully uninstalled on resolve.\n         *                      Any error will be provided if rejected.\n         */\n        destroy: function destroy() {\n            // no request, just a resources cleaning\n            this.queue = null;\n\n            // the method must return a promise\n            return Promise.resolve();\n        },\n\n        /**\n         * Gets an item definition by its identifier, also gets its current state\n         * @param {String} identifier - The identifier of the sharedStimulus to get\n         * @returns {Promise} - Returns a promise. The item data will be provided on resolve.\n         *                      Any error will be provided if rejected.\n         */\n        getItem: function getItem(identifier) {\n            return Promise.all([\n                request(urlUtil.route('get', serviceController, serviceExtension), { id: identifier }, 'GET'),\n                request(urlUtil.route('getStylesheets', 'SharedStimulusStyling', serviceExtension), {\n                    uri: identifier\n                })\n            ]).then(([data, styles]) => {\n                const itemData = creatorDummyItemData(data);\n                data.baseUrl = urlUtil.route('getFile', 'MediaManager', 'taoMediaManager', { uri: '' });\n                data.content = {\n                    type: 'qti',\n                    data: itemData\n                };\n                styles.forEach((stylesheet, index) => {\n                    const serial = `stylesheet_${index}`;\n                    data.content.data.stylesheets[serial] = {\n                        qtiClass: 'stylesheet',\n                        attributes: {\n                            href: urlUtil.route('loadStylesheet', 'SharedStimulusStyling', 'taoMediaManager', {\n                                uri: identifier,\n                                stylesheet: stylesheet\n                            }),\n                            media: 'all',\n                            title: '',\n                            type: 'text/css'\n                        },\n                        serial,\n                        getComposingElements: () => ({})\n                    };\n                });\n                return data;\n            });\n        }\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n */\ndefine('taoMediaManager/qtiCreator/widgets/helpers/content',[\n    'jquery',\n    'lodash',\n    'taoMediaManager/qtiCreator/helper/creatorRenderer',\n    'taoQtiItem/qtiCreator/model/helper/container',\n    'taoQtiItem/qtiCreator/editor/gridEditor/content'\n], function($, _, creatorRenderer, containerHelper, gridContentHelper){\n    'use strict';\n    // all files that use qtiCreator/helper/creatorRenderer should be copied from taoQtiItem\n    // because they should use proper locations that are binded in Renderer\n    // qtiCreator/helper/creatorRenderer use qtiCreator/renderers/Renderer\n    // qtiCreator/renderers/Renderer return Renderer with binded locations from qtiCreator/renderers/config\n\n    const contentHelper = {};\n\n    /**\n     * Create elements from a widget box having the 'data-new=true' attribute\n     *  - render the elements at their placeholder in $container\n     *  - apply callback on each widget\n     * @param {DOMElement} container - element that will contain the new ones\n     * @param {JQuery} $container - DOM container where the new elements are created\n     * @param {String} data - corresponding HTML (?)\n     * @param {function} callback - will be triggered for each new created element\n     */\n    contentHelper.createElements = function createElements(container, $container, data, callback) {\n\n        const $dummy = $('<div>').html(data);\n\n        containerHelper.createElements(container, gridContentHelper.getContent($dummy), function(newElts){\n\n            creatorRenderer.get().load(function(){\n\n                _.each(newElts, function(serial) {\n                    let $placeholder,\n                        $widget,\n                        widget;\n\n                    $placeholder = $container.find(`.widget-box[data-new][data-qti-class=${serial.qtiClass}]`);\n\n                    serial.setRenderer(this);\n                    serial.render($placeholder);\n\n                    //render widget\n                    serial.postRender();\n\n                    widget = serial.data('widget');\n                    $widget = widget.$original;\n\n                    //inform height modification\n                    $widget.trigger('contentChange.gridEdit');\n\n                    if(_.isFunction(callback)){\n                        callback(widget);\n                    }\n                }.bind(this));\n\n            }, this.getUsedClasses());\n        });\n\n    };\n\n    contentHelper.changeInnerWidgetState = function _changeInnerWidgetState(outerWidget, state){\n\n        const selector = [];\n        _.forEach(['img', 'math', 'object', 'include'], function(qtiClass){\n            selector.push(`[data-html-editable] .widget-${qtiClass}`);\n        });\n\n        outerWidget.$container.find(selector.join(',')).each(function(){\n            const innerWidget = $(this).data('widget');\n            if(innerWidget){\n                innerWidget.changeState(state);\n            }\n        });\n    };\n\n    return contentHelper;\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014-2017 (original work) Open Assessment Technologies SA ;\n *\n */\ndefine('taoMediaManager/qtiCreator/widgets/states/Active',[\n    'jquery',\n    'taoQtiItem/qtiCreator/widgets/states/factory',\n    'taoMediaManager/qtiCreator/widgets/helpers/content'\n], function ($, stateFactory, contentHelper) {\n    'use strict';\n\n    return stateFactory.create(\n        'active',\n        function () {\n            const _widget = this.widget,\n                container = _widget.$container[0],\n                item = _widget.element.getRootElement(),\n                areaBroker = _widget.getAreaBroker(),\n                $modalFeedbacksArea = $('#modalFeedbacks'),\n                outerContainer = document.querySelector('#item-editor-scroll-outer');\n\n            function checkIfWidgetShouldSleep(e) {\n                return (\n                    container !== e.target &&\n                    !$.contains(container, e.target) &&\n                    $.contains(outerContainer, e.target) && // in case click on scrollbar\n                    (!areaBroker ||\n                        !areaBroker.getEditorBarArea ||\n                        !$.contains(areaBroker.getEditorBarArea().get(0), e.target)) &&\n                    (!$modalFeedbacksArea.length || !$.contains($modalFeedbacksArea[0], e.target)) && //if click triggered inside the #modalFeedback then state must not be changed.\n                    $(e.target).data('role') !== 'restore' &&\n                    !$(e.target).closest('.widget-popup').length\n                );\n            }\n\n            //move to sleep state by clicking anywhere outside the interaction\n            areaBroker\n                .getContentCreatorPanelArea()\n                .on(`mousedown.active.${_widget.serial}`, function (e) {\n                    if (checkIfWidgetShouldSleep(e)) {\n                        _widget.changeState('sleep');\n                    }\n                })\n                .on('beforesave.qti-creator.active', function () {\n                    _widget.changeState('sleep');\n                })\n                .on('styleedit.active', function () {\n                    _widget.changeState('sleep');\n                });\n\n            $(document).on('open-preview.qti-item', function () {\n                _widget.changeState('sleep');\n            });\n\n            if (item && item.data('widget')) {\n                //in item editing context:\n                item.data('widget').$container.on(\n                    'resizestart.gridEdit.active beforedragoverstart.gridEdit.active',\n                    function () {\n                        _widget.changeState('sleep');\n                    }\n                );\n            }\n        },\n        function () {\n            const areaBroker = this.widget.getAreaBroker();\n\n            contentHelper.changeInnerWidgetState(this.widget, 'sleep');\n\n            this.widget.$container.off('.active');\n            areaBroker.getContentCreatorPanelArea().off(`.active.${this.widget.serial}`);\n\n            const item = this.widget.element.getRootElement();\n            if (item && item.data('widget')) {\n                item.data('widget').$container.off('.active');\n            }\n        }\n    );\n});\n\n","define('taoMediaManager/qtiCreator/widgets/static/states/Active',[\n    'jquery',\n    'taoQtiItem/qtiCreator/widgets/states/factory',\n    'taoMediaManager/qtiCreator/widgets/states/Active'\n], function($, stateFactory, Active){\n    'use strict';\n\n    return stateFactory.extend(Active, function(){\n\n        var _widget = this.widget,\n            $container = _widget.$container;\n\n        _widget.beforeStateInit(function(e, element, state){\n            var serial = element.getSerial(),\n                composingElts;\n\n            if((state.name === 'active' && serial !== _widget.serial) || state.name === 'choice'){\n\n                if(_widget.element.qtiClass === 'rubricBlock'){\n                    //exclude\n                    composingElts = _widget.element.getComposingElements();\n                    if(!composingElts[element.serial]){\n                        _widget.changeState('sleep');\n                    }\n                }else{\n                    //call sleep whenever other widget is active\n                    _widget.changeState('sleep');\n                }\n\n            }\n\n        }, 'otherActive');\n\n        $container.on('mouseenter.active', function(e){\n            e.stopPropagation();\n            $container.parent().trigger('mouseleave.sleep');\n        }).on('mouseleave.active', function(e){\n            e.stopPropagation();\n            $container.parent().trigger('mouseenter.sleep');\n        }).on('click.active', function(e){\n            e.stopPropagation();\n        });\n\n    }, function(){\n        const _widget = this.widget,\n            areaBroker = _widget.getAreaBroker();\n\n        _widget.$container.off('.active');\n        areaBroker.getContentCreatorPanelArea().off(`.active.${_widget.serial}`);\n\n        _widget.offEvents('otherActive');\n    });\n\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 (original work) Open Assessment Technologies SA ;\n */\n/**\n * @author Hanna Dzmitryieva <hanna@taotesting.com>\n */\ndefine('taoMediaManager/qtiCreator/helper/ckConfigurator',['lodash', 'ui/ckeditor/ckConfigurator', 'mathJax'], function(_, ckConfigurator, mathJax) {\n    'use strict';\n\n    const _defaults = {\n        qtiImage : true,\n        qtiMedia : true,\n        qtiInclude : false,\n        underline : true,\n        mathJax : !!mathJax,\n        removePlugins: 'taoqtiinclude'\n    };\n\n    /**\n     * Generate a configuration object for CKEDITOR\n     *\n     * @param {object} editor instance of ckeditor\n     * @param {String} toolbarType block | inline | flow | qtiBlock | qtiInline | qtiFlow | reset to get back to normal\n     * @param {Object} [options] - is based on the CKEDITOR config object with some additional sugar\n     *        Note that it's here you need to add parameters for the resource manager.\n     *        Some options are not covered in http://docs.ckeditor.com/#!/api/CKEDITOR.config\n     * @param {String} [options.dtdOverrides] - @see dtdOverrides which pre-defines them\n     * @param {Object} [options.positionedPlugins] - @see ckConfig.positionedPlugins\n     * @param {Boolean} [options.qtiImage] - enables the qtiImage plugin\n     * @param {Boolean} [options.qtiInclude] - enables the qtiInclude plugin\n     * @param {Boolean} [options.underline] - enables the underline plugin\n     * @param {Boolean} [options.mathJax] - enables the mathJax plugin\n     * @returns {Function} - a function for get the config\n     *\n     * @see http://docs.ckeditor.com/#!/api/CKEDITOR.config\n     */\n    const getConfig = function(editor, toolbarType = 'qtiInline', options) {\n        return ckConfigurator.getConfig(editor, toolbarType, _.defaults(options || {}, _defaults));\n    };\n\n    return {\n        getConfig : getConfig\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2015-2022 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n */\ndefine('taoMediaManager/qtiCreator/editor/ckEditor/htmlEditor',[\n    'lodash',\n    'i18n',\n    'jquery',\n    'ckeditor',\n    'core/promise',\n    'services/features',\n    'taoMediaManager/qtiCreator/helper/ckConfigurator',\n    'taoQtiItem/qtiItem/core/Element',\n    'taoMediaManager/qtiCreator/widgets/helpers/content',\n    'taoQtiItem/qtiCreator/widgets/helpers/deletingState',\n    'taoQtiItem/qtiCreator/editor/ckEditor/featureFlag',\n    'taoQtiItem/qtiCreator/helper/languages'\n], function (\n    _,\n    __,\n    $,\n    CKEditor,\n    Promise,\n    features,\n    ckConfigurator,\n    Element,\n    contentHelper,\n    deletingHelper,\n    featureFlag,\n    languages\n) {\n    'use strict';\n\n    const _defaults = {\n        placeholder: __('some text ...'),\n        shieldInnerContent: true,\n        passthroughInnerContent: false,\n        autofocus: true\n    };\n\n    const placeholderClass = 'cke-placeholder';\n    const languagePluginEnabled = features.isVisible('taoQtiItem/creator/editor/ckEditor/languagePlugin', false);\n\n    let editorFactory;\n\n    //prevent auto inline editor creation:\n    CKEditor.disableAutoInline = true;\n\n    /**\n     * @param {JQuery} $editable - the element to be transformed into an editor\n     * @param {JQuery} $editableContainer - the container of the editor\n     * @param {Object} [options]\n     * @param {String} [options.placeholder] - the place holder text\n     * @param {Boolean} [options.shieldInnerContent] - define if the inner widget content should be protected or not\n     * @param {Boolean} [options.passthroughInnerContent] - define if the inner widget content should be accessible directly or not\n     * @param {String} [options.removePlugins] - a coma-separated list of plugins that should not be loaded: 'plugin1,plugin2,plugin3'\n     * @param {Boolean} [options.autofocus] - automatically focus\n     * @returns {Object} CKEditor\n     */\n    function _buildEditor($editable, $editableContainer, options) {\n        const widget = (options.data || {}).widget,\n            areaBroker = widget && widget.getAreaBroker && widget.getAreaBroker(),\n            $toolbarArea = areaBroker && areaBroker.getToolbarArea && areaBroker.getToolbarArea(),\n            removePlugins = [];\n\n        options = _.defaults(options, _defaults);\n\n        if (!($editable instanceof $) || !$editable.length) {\n            throw new Error('invalid jquery element for $editable');\n        }\n        if (!($editableContainer instanceof $) || !$editableContainer.length) {\n            throw new Error('invalid jquery element for $editableContainer');\n        }\n\n        if (options.placeholder && options.placeholder !== '') {\n            if ($editable.is('input')) {\n                $editable.attr('placeholder', options.placeholder);\n            } else {\n                $editable.attr('data-placeholder', options.placeholder);\n            }\n        }\n\n        if (options.removePlugins) {\n            options.removePlugins.split('').forEach(removePluginName => {\n                removePlugins.push(removePluginName.trim());\n            });\n        }\n\n        if (!languagePluginEnabled) {\n            removePlugins.push('language');\n        }\n\n        const ckConfig = {\n            dtdMode: 'qti',\n            autoParagraph: false,\n            removePlugins: removePlugins.join(','),\n            enterMode: options.enterMode || CKEditor.ENTER_P,\n            floatSpaceDockedOffsetY: 10,\n            language_list: options.language_list,\n            sharedSpaces: {\n                top: ($toolbarArea && $toolbarArea.attr('id')) || 'toolbar-top'\n            },\n            taoQtiItem: {\n                /**\n                 * @param {DOM} tempWidget - this contains the DOM nodes created by a ckEditor plugin,\n                 *                           wrapped in a temporary widget container (= a widget container with a [data-new=\"true\"] attribute)\n                 */\n                insert: function (tempWidget) {\n                    const $newContent = $(tempWidget).clone(); // we keep the original content for later use\n                    if (options.data && options.data.container && options.data.widget) {\n                        const $newImgPlaceholder = $editable.find('[data-new=\"true\"][data-qti-class=\"img\"]');\n                        if ($newImgPlaceholder.length &&\n                            !$editable.closest('.qti-simpleChoice').length) {\n                            // instead img will add figure element\n                            $newImgPlaceholder.attr('data-qti-class','figure');\n                            // span after for new line\n                            $('<span>&nbsp;</span>').insertAfter($newImgPlaceholder);\n                        }\n                        contentHelper.createElements(\n                            options.data.container,\n                            $editable,\n                            _htmlEncode(this.getData()),\n                            function (createdWidget) {\n                                const createdElement = createdWidget.element;\n\n                                if (_.isFunction(createdElement.initContainer)) {\n                                    createdElement.body($newContent.html());\n                                    createdWidget.rebuild();\n                                    createdWidget = createdElement.data('widget');\n                                }\n                                _activateInnerWidget(options.data.widget, createdWidget);\n                            }\n                        );\n                    }\n                }\n            },\n            on: {\n                instanceReady: function (e) {\n                    let widgets = {};\n                    const editor = e.editor;\n\n                    //store it in editable elt data attr\n                    $editable.data('editor', editor);\n                    $editable.data('editor-options', options);\n\n                    //need to debounce the callback to prevent the changes made by undo to trigger the event change twice\n                    editor.on(\n                        'change',\n                        _.debounce(\n                            function markupChanged() {\n                                _detectWidgetDeletion($editable, widgets, editor);\n                                if (_.isFunction(options.change)) {\n                                    options.change.call(editor, _htmlEncode(editor.getData()));\n                                }\n                            },\n                            100,\n                            {\n                                leading: true\n                            }\n                        )\n                    );\n\n                    managePlaceholder($editable, editor);\n\n                    if (options.data && options.data.container) {\n                        //store in data-qti-container attribute the editor instance as soon as it is ready\n                        $editable.data('qti-container', options.data.container);\n\n                        //init editable\n                        widgets = _rebuildWidgets(options.data.container, $editable, {\n                            restoreState: true\n                        });\n                        if (options.shieldInnerContent) {\n                            _shieldInnerContent($editable, options.data.widget);\n                        }\n                    }\n\n                    if (options.autofocus) {\n                        _focus(editor);\n                    }\n\n                    $editable.trigger('editorready', [editor]);\n\n                    $('.qti-item').trigger('toolbarchange');\n                },\n                menuShow: function (e) {\n                    const $languages = $('.cke_panel_frame').contents().find(\"[class*='cke_menubutton__language']\");\n                    const $languageMenu = $languages.parents('.cke_panel_block');\n                    const isLanguage = $languageMenu.css('display') === 'block' && $languages.length > 0;\n\n                    $('.cke_panel').toggleClass('cke_panel_visible', isLanguage);\n                },\n                blur: function () {\n                    if ($toolbarArea) {\n                        $toolbarArea.hide();\n                    }\n                },\n                focus: function () {\n                    if ($toolbarArea) {\n                        $toolbarArea.show();\n                    }\n\n                    //callback:\n                    if (_.isFunction(options.focus)) {\n                        options.focus.call(this, _htmlEncode(this.getData()));\n                    }\n\n                    $editable.trigger('editorfocus');\n\n                    $('.qti-item').trigger('toolbarchange');\n                },\n                configLoaded: function (e) {\n                    //@todo : do we really have to wait here to initialize the config?\n                    let toolbarType = options.toolbarType || '';\n                    if (options.toolbar && _.isArray(options.toolbar)) {\n                        ckConfig.toolbar = options.toolbar;\n                    } else {\n                        toolbarType = getTooltypeFromContainer($editableContainer);\n                    }\n\n                    if (typeof options.qtiMedia !== 'undefined') {\n                        ckConfig.qtiMedia = options.qtiMedia;\n                    }\n                    if (typeof options.qtiImage !== 'undefined') {\n                        ckConfig.qtiImage = options.qtiImage;\n                    }\n                    if (typeof options.qtiInclude !== 'undefined') {\n                        ckConfig.qtiInclude = options.qtiInclude;\n                    }\n                    if (typeof options.highlight !== 'undefined') {\n                        ckConfig.highlight = options.highlight;\n                    }\n\n                    e.editor.config = ckConfigurator.getConfig(e.editor, toolbarType, ckConfig);\n                },\n                afterPaste: function () {\n                    //@todo : we may add some processing on the editor after paste\n                }\n            }\n        };\n\n        return CKEditor.inline($editable[0], ckConfig);\n    }\n\n    /**\n     * Handle the placeholder for non-input elements.\n     * To avoid CK nasty side-effects of using the placeholder attribute on non-input elements,\n     * we handle the placeholder with css.\n     * @param {JQuery} $editable\n     * @param {Object} editor\n     */\n    function managePlaceholder($editable, editor) {\n        if (!$editable.is('input')) {\n            togglePlaceholder($editable);\n\n            editor.on('change', function () {\n                togglePlaceholder($editable);\n            });\n        }\n    }\n\n    /**\n     * Toggle the placeholder class on the editable depending on its content\n     * @param {JQuery} $editable\n     */\n    function togglePlaceholder($editable) {\n        const nonEmptyContent = ['img', 'table', 'math', 'object', 'printedVariable', '.tooltip-target'];\n\n        if ($editable.text().trim() === '' && !$editable.find(nonEmptyContent.join(',')).length) {\n            $editable.addClass(placeholderClass);\n        } else {\n            removePlaceholder($editable);\n        }\n    }\n\n    function removePlaceholder($editable) {\n        $editable.removeClass(placeholderClass);\n    }\n\n    /**\n     * Assess\n     * @param {type} $editableContainer\n     * @returns {String}\n     */\n    function getTooltypeFromContainer($editableContainer) {\n        let toolbarType = 'qtiFlow';\n        // build parameter for toolbar\n        if (\n            $editableContainer.hasClass('widget-blockInteraction') ||\n            $editableContainer.hasClass('widget-textBlock') ||\n            $editableContainer.hasClass('widget-rubricBlock')\n        ) {\n            toolbarType = 'qtiBlock';\n        } else if (\n            $editableContainer.hasClass('qti-prompt-container') ||\n            $editableContainer.hasClass('widget-hottext')\n        ) {\n            toolbarType = 'qtiInline';\n        } else if ($editableContainer.hasClass('widget-table') && !featureFlag.disableCellAlignment) {\n            toolbarType = 'qtiTable';\n        }\n        return toolbarType;\n    }\n\n    /**\n     * Find an inner element by its data attribute name\n     * @param {JQuery} $container\n     * @param {String} dataAttribute\n     * @returns {JQuery} collection\n     */\n    function _find($container, dataAttribute) {\n        let $collection;\n\n        if ($container.data(dataAttribute)) {\n            $collection = $container;\n        } else {\n            $collection = $container.find(`[data-${dataAttribute}=true]`);\n        }\n        return $collection;\n    }\n\n    /**\n     * Rebuild all innerwidgets located inside a container\n     *\n     * @param {Object} container\n     * @param {JQuery} $container\n     * @param {Object} options\n     * @returns {Object} widgets\n     */\n    function _rebuildWidgets(container, $container, options) {\n        const widgets = {};\n        options = options || {};\n\n        //re-init all widgets:\n        _.each(_.values(container.elements), function (elt) {\n            const widget = elt.data('widget'),\n                currentState = widget.getCurrentState().name;\n\n            widgets[elt.serial] = widget.rebuild({\n                context: $container,\n                ready: function (widgetInner) {\n                    if (options.restoreState) {\n                        //restore current state\n                        widgetInner.changeState(currentState);\n                    }\n                }\n            });\n        });\n\n        $container.trigger('widgetCreated', [widgets, container]);\n\n        return widgets;\n    }\n\n    /**\n     * Find the widget container by its serial\n     *\n     * @param {JQuery} $container\n     * @param {String} serial\n     * @returns {JQuery} $widget\n     */\n    function _findWidgetContainer($container, serial) {\n        // re-query widget container to apply changes in case of deletion\n        return $($container.selector).find(`.widget-box[data-serial=${serial}]`);\n    }\n\n    /**\n     * Detect if an inner widget has been removed\n     *\n     * @param {JQuery} $container\n     * @param {Array} widgets\n     * @param {Object} editor\n     * @returns {undefined}\n     */\n    function _detectWidgetDeletion($container, widgets, editor) {\n        const deleted = [];\n        const container = $container.data('qti-container');\n\n        _.each(widgets, function (w) {\n            if (!w.element.data('removed')) {\n                const $widget = _findWidgetContainer($container, w.serial);\n                if (!$widget.length) {\n                    deleted.push(w);\n                }\n            }\n        });\n\n        if (deleted.length) {\n            const undoCmd = editor.getCommand('undo');\n            const $messageBox = deletingHelper.createInfoBox(deleted);\n\n            $messageBox\n                .on('confirm.deleting', function () {\n                    _.each(deleted, function (w) {\n                        w.element.remove();\n                        w.destroy();\n                    });\n\n                    editor.resetUndo();\n                })\n                .on('undo.deleting', function () {\n                    editor.undoManager.undo();\n\n                    //need to rebuild the inner widgets in case the undo restored some qti elements\n                    _rebuildWidgets(container, $container, {\n                        restoreState: true\n                    });\n\n                    _shieldInnerContent($container, container.data('widget'));\n                });\n\n            if (undoCmd) {\n                //catch ckeditor's undo event to trigger the same behaviour as the undo action dialog\n                undoCmd.on('afterUndo', function () {\n                    $messageBox.find('a.undo').click();\n                });\n            }\n        }\n    }\n\n    /**\n     * @param {JQuery} $widget - the widget to be protected\n     * @returns {JQuery} The added layer (shield)\n     */\n    function addShield($widget) {\n        const $shield = $('<button>', {\n            class: 'html-editable-shield'\n        });\n\n        $widget.attr('contenteditable', false);\n        $widget.append($shield);\n        return $shield;\n    }\n\n    /**\n     * Protect the inner widgets of a container\n     *\n     * @param {JQuery} $container\n     * @param {Object} containerWidget\n     * @returns {undefined}\n     */\n    function _shieldInnerContent($container, containerWidget) {\n        $container.find('.widget-box').each(function () {\n            const $widget = $(this);\n\n            addShield($widget).on('click', function (e) {\n                //click on shield:\n                //1. this.widget.changeState('sleep');\n                //2. clicked widget.changeState('active');\n\n                e.stopPropagation();\n\n                const innerWidget = $widget.data('widget');\n                _activateInnerWidget(containerWidget, innerWidget);\n            });\n        });\n    }\n\n    /**\n     * Activate the inner widget\n     *\n     * @param {Object} containerWidget\n     * @param {Object} innerWidget\n     * @returns {undefined}\n     */\n    function _activateInnerWidget(containerWidget, innerWidget) {\n        let listenToWidgetCreation;\n        const event = `widgetCreated.${innerWidget.serial}`;\n\n        if (containerWidget && containerWidget.element && containerWidget.element.qtiClass) {\n            listenToWidgetCreation = function () {\n                containerWidget.$container.on(event, function (e, widgets) {\n                    const targetWidget = widgets[innerWidget.serial];\n                    if (targetWidget) {\n                        containerWidget.$container.off(event);\n                        //FIXME potential race condition ? (debounce the enclosing event handler ?)\n                        _.delay(function () {\n                            if (Element.isA(targetWidget.element, 'interaction')) {\n                                targetWidget.changeState('question');\n                            } else {\n                                targetWidget.changeState('active');\n                            }\n                        }, 100);\n                    }\n                });\n            };\n\n            if (Element.isA(containerWidget.element, '_container') && !containerWidget.element.data('stateless')) {\n                //only _container that are NOT stateless need to change its state to sleep before activating the new one.\n                listenToWidgetCreation();\n                containerWidget.changeState('sleep');\n            } else if (Element.isA(containerWidget.element, 'interaction')) {\n                listenToWidgetCreation();\n                containerWidget.changeState('sleep');\n            } else if (Element.isA(containerWidget.element, 'choice')) {\n                listenToWidgetCreation();\n                containerWidget.changeState('question');\n            } else if (Element.isA(containerWidget.element, 'table')) {\n                listenToWidgetCreation();\n                containerWidget.changeState('sleep');\n            } else if (Element.isA(innerWidget.element, 'choice')) {\n                innerWidget.changeState('choice');\n            } else {\n                innerWidget.changeState('active');\n            }\n        } else {\n            innerWidget.changeState('active');\n        }\n    }\n\n    /**\n     * Special encoding of ouput html generated from ie8 : moved to xmlRenderer\n     * @param {String} encodedStr\n     * @returns {String} encodedStr\n     */\n    function _htmlEncode(encodedStr) {\n        return encodedStr;\n    }\n\n    /**\n     * Focus the editor and set the cursor to the end\n     *\n     * @param {Object} editor - the ckeditor instance\n     * @returns {undefined}\n     */\n    function _focus(editor) {\n        if (editor.editable() && editor.editable().$.parentNode) {\n            editor.focus();\n            const range = editor.createRange();\n            range.moveToElementEditablePosition(editor.editable(), true);\n            editor.getSelection().selectRanges([range]);\n        }\n    }\n\n    editorFactory = {\n        /**\n         * Check if all data-html-editable has an editor\n         *\n         * @param {type} $container\n         * @returns {undefined}\n         */\n        hasEditor: function ($container) {\n            let hasEditor = false;\n\n            _find($container, 'html-editable').each(function () {\n                hasEditor = !!$(this).data('editor');\n                return hasEditor; //continue if true, break if false\n            });\n\n            return hasEditor;\n        },\n        /**\n         * Instanciate the editor\n         *\n         * @param {JQuery} $container\n         * @param {Object} [editorOptions]\n         * @param {String} [editorOptions.placeholder] - the place holder text\n         * @param {Boolean} [editorOptions.shieldInnerContent] - define if the inner widget content should be protected or not\n         * @param {Boolean} [editorOptions.passthroughInnerContent] - define if the inner widget content should be accessible directly or not\n         * @param {Boolean} [editorOptions.enterMode] - what is the behavior of the \"Enter\" key (see ENTER_MODE_xxx in ckEditor configuration)\n         * @returns {undefined}\n         */\n        buildEditor: function ($container, editorOptions) {\n            languages\n                .getList()\n                .then(languages.useCKEFormatting)\n                .then(languagesData => {\n                    const buildTasks = [];\n\n                    editorOptions.language_list = languagesData;\n\n                    _find($container, 'html-editable-container').each(function () {\n                        const $editableContainer = $(this),\n                            $editable = $editableContainer.find('[data-html-editable]');\n\n                        buildTasks.push(\n                            new Promise(function (resolve) {\n                                //need to make the element html editable to enable ck inline editing:\n                                $editable.attr('contenteditable', true);\n\n                                //build it\n                                _buildEditor($editable, $editableContainer, editorOptions);\n\n                                $editable.on('editorready', resolve);\n                            })\n                        );\n                    });\n                    return Promise.all(buildTasks);\n                });\n        },\n        /**\n         * Destroy the editor\n         *\n         * @param {JQuery} $container\n         * @returns {undefined}\n         */\n        destroyEditor: function ($container) {\n            const destructTasks = [];\n            _find($container, 'html-editable-container').each(function () {\n                const $editableContainer = $(this);\n                const $editable = $editableContainer.find('[data-html-editable]');\n\n                $editable.removeAttr('contenteditable');\n                if ($editable.data('editor')) {\n                    destructTasks.push(\n                        new Promise(function (resolve) {\n                            const editor = $editable.data('editor');\n                            const options = $editable.data('editor-options');\n\n                            //before destroying, ensure that data is stored\n                            if (_.isFunction(options.change)) {\n                                options.change.call(editor, _htmlEncode(editor.getData()));\n                            }\n\n                            removePlaceholder($editable);\n\n                            editor.on('destroy', function () {\n                                $editable.removeData('editor').removeData('editor-options');\n                                if ($editable.data('qti-container')) {\n                                    _rebuildWidgets($editable.data('qti-container'), $editable);\n                                }\n\n                                $editable.trigger('editordestroyed');\n                                resolve();\n                            });\n\n                            editor.focusManager.blur(true);\n                            editor.destroy();\n                        })\n                    );\n                }\n            });\n            return Promise.all(destructTasks);\n        },\n        /**\n         * Get the editor content\n         *\n         * @param {JQuery} $editable\n         * @returns {String}\n         */\n        getData: function ($editable) {\n            const editor = $editable.data('editor');\n            if (editor) {\n                return _htmlEncode(editor.getData());\n            } else {\n                throw new Error('no editor attached to the DOM element');\n            }\n        },\n        /**\n         * Allow to set the editor content. Works only with plain text for now.\n         *\n         * @param {JQuery} $editable\n         * @param {String} data\n         */\n        setData: function ($editable, data) {\n            const editor = $editable.data('editor');\n            if (editor) {\n                if (_.isString(data)) {\n                    editor.setData(_.escape(data));\n                }\n            } else {\n                throw new Error('no editor attached to the DOM element');\n            }\n        },\n        /**\n         * Focus all the editors found in the given container\n         *\n         * @param {JQuery} $editable\n         * @returns {undefined}\n         */\n        focus: function ($editable) {\n            _find($editable, 'html-editable').each(function () {\n                const editor = $(this).data('editor');\n                if (editor) {\n                    _focus(editor);\n                }\n            });\n        }\n    };\n\n    return editorFactory;\n});\n\n","\ndefine('tpl!taoMediaManager/qtiCreator/tpl/forms/static/text', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, functionType=\"function\";\n\n\n  buffer += \"<div class=\\\"panel\\\">\\n    <label for=\\\"textBlockCssClass\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Text Block CSS Class\", options) : helperMissing.call(depth0, \"__\", \"Text Block CSS Class\", options)))\n    + \"</label>\\n    <span class=\\\"icon-help tooltipstered\\\" data-tooltip=\\\"~ .tooltip-content:first\\\" data-tooltip-theme=\\\"info\\\"></span>\\n    <div class=\\\"tooltip-content\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Set a CSS class name in order to customize the display style.\", options) : helperMissing.call(depth0, \"__\", \"Set a CSS class name in order to customize the display style.\", options)))\n    + \"</div>\\n    <input type=\\\"text\\\" name=\\\"textBlockCssClass\\\" value=\\\"\";\n  if (helper = helpers.textBlockCssClass) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.textBlockCssClass); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" />\\n</div>\";\n  return buffer;\n  });\n});\n\n","define('taoMediaManager/qtiCreator/widgets/static/text/states/Active',[\n    'jquery',\n    'taoQtiItem/qtiCreator/widgets/states/factory',\n    'taoMediaManager/qtiCreator/widgets/static/states/Active',\n    'taoMediaManager/qtiCreator/editor/ckEditor/htmlEditor',\n    'taoQtiItem/qtiCreator/editor/gridEditor/content',\n    'taoQtiItem/qtiCreator/widgets/helpers/formElement',\n    'tpl!taoMediaManager/qtiCreator/tpl/forms/static/text',\n    'taoMediaManager/qtiCreator/editor/styleEditor/styleEditor',\n    'taoMediaManager/qtiCreator/editor/styleEditor/fontSelector',\n    'taoMediaManager/qtiCreator/editor/styleEditor/colorSelector',\n    'taoMediaManager/qtiCreator/editor/styleEditor/fontSizeChanger'\n], function (\n    $,\n    stateFactory,\n    Active,\n    htmlEditor,\n    content,\n    formElement,\n    formTpl,\n    styleEditor,\n    fontSelector,\n    colorSelector,\n    fontSizeChanger\n) {\n    'use strict';\n\n    const wrapperCls = 'custom-text-box';\n\n    const TextActive = stateFactory.extend(\n        Active,\n        function () {\n            this.buildStylesEditor();\n            this.buildEditor();\n            this.initForm();\n        },\n        function () {\n            this.destroyEditor();\n            this.destroyStylesEditor();\n            this.widget.$form.empty();\n        }\n    );\n\n    TextActive.prototype.buildEditor = function () {\n        const widget = this.widget;\n        const $editableContainer = widget.$container;\n        const container = widget.element;\n        const changeCallback = content.getChangeCallback(container);\n\n        $editableContainer.attr('data-html-editable-container', true);\n\n        if (!htmlEditor.hasEditor($editableContainer)) {\n            htmlEditor.buildEditor($editableContainer, {\n                change: function (data) {\n                    changeCallback.call(this, data);\n\n                    // remove the form value if there is no content to apply on\n                    if (!data) {\n                        widget.$form.find('[name=\"textBlockCssClass\"]').val('');\n                    }\n                },\n                blur: function () {\n                    widget.changeState('sleep');\n                },\n                data: {\n                    widget: widget,\n                    container: container\n                }\n            });\n        }\n    };\n\n    TextActive.prototype.buildStylesEditor = function () {\n        const widget = this.widget;\n        const $editableContainer = widget.$container;\n\n        let $block = $editableContainer.find(`.${wrapperCls}`);\n        if (!$block.length) {\n            // no wrapper found, insert one\n            $block = widget.$container.find('[data-html-editable=\"true\"]').wrapInner('<div />').children();\n            const hashClass = styleEditor.generateHashClass();\n            $block.attr('class', `${wrapperCls} ${hashClass}`);\n        } else {\n            const blockCls = widget.$container.find(`.${wrapperCls}`).attr('class').split(' ');\n            let hashClass = blockCls.find(className => /^tao-*/.test(className));\n            if (hashClass) {\n                styleEditor.setHashClass(hashClass);\n            } else {\n                hashClass = styleEditor.generateHashClass();\n                $block.addClass(hashClass);\n            }\n        }\n\n        const $textEditor = $('#item-editor-text-property-bar');\n        fontSelector($textEditor);\n        colorSelector($textEditor);\n        fontSizeChanger($textEditor);\n    };\n\n    TextActive.prototype.destroyEditor = function () {\n        //search and destroy the editor\n        htmlEditor.destroyEditor(this.widget.$container);\n    };\n\n    TextActive.prototype.destroyStylesEditor = function () {\n        const hashClass = styleEditor.getHashClass();\n        const $block = this.widget.$container.find(`.${wrapperCls}`);\n        const textBlockCssClass = ($block.attr('class') || '').replace(wrapperCls, '').replace(hashClass, '').trim();\n        const styles = styleEditor.getStyle();\n        const regex = new RegExp(hashClass);\n        if (!textBlockCssClass && !Object.keys(styles).find(selector => regex.test(selector))) {\n            // no need to have a wrapper if no block class is set\n            $block.children().unwrap();\n        }\n    };\n\n    TextActive.prototype.initForm = function () {\n        const widget = this.widget;\n        const $form = widget.$form;\n        const blockCls = widget.$container.find(`.${wrapperCls}`).attr('class');\n        const hashClass = styleEditor.getHashClass();\n\n        $form.html(\n            formTpl({\n                textBlockCssClass: (blockCls || '').replace(wrapperCls, '').replace(hashClass, '').trim()\n            })\n        );\n\n        formElement.initWidget($form);\n\n        formElement.setChangeCallbacks($form, widget.element, {\n            textBlockCssClass: function (element, value) {\n                let $block = widget.$container.find(`.${wrapperCls}`);\n\n                // prevent to have the wrapper class twice\n                value = value.trim();\n                if (value === wrapperCls) {\n                    value = '';\n                }\n\n                if (value) {\n                    if (!$block.length) {\n                        // no wrapper found, insert one\n                        $block = widget.$container.find('[data-html-editable=\"true\"]').wrapInner('<div />').children();\n                    }\n\n                    // replace the block class\n                    $block.attr('class', `${wrapperCls} ${value}`);\n                }\n            }\n        });\n    };\n\n    return TextActive;\n});\n\n","define('taoMediaManager/qtiCreator/widgets/static/text/states/states',[\n    'taoQtiItem/qtiCreator/widgets/states/factory',\n    'taoQtiItem/qtiCreator/widgets/static/states/states',\n    'taoQtiItem/qtiCreator/widgets/static/text/states/Sleep',\n    'taoMediaManager/qtiCreator/widgets/static/text/states/Active'\n], function(factory, states){\n    'use strict';\n\n    return factory.createBundle(states, arguments);\n});\n","define('taoMediaManager/qtiCreator/widgets/static/text/Widget',[\n    'jquery',\n    'taoQtiItem/qtiCreator/widgets/static/Widget',\n    'taoMediaManager/qtiCreator/widgets/static/text/states/states',\n    'tpl!taoQtiItem/qtiCreator/tpl/toolbars/textBlock'\n], function($, Widget, states, toolbarTpl){\n    'use strict';\n\n    const TextWidget = Widget.clone();\n\n    TextWidget.initCreator = function(){\n\n        Widget.initCreator.call(this);\n\n        this.registerStates(states);\n\n    };\n\n    TextWidget.buildContainer = function(){\n\n        const $wrap = $('<div>', {'data-serial' : this.element.serial, 'data-qti-class' : '_container', 'class' : 'widget-box widget-block widget-textBlock'})\n            .append($('<div>', {'data-html-editable' : true}));\n\n        this.$original.wrapInner($wrap);\n\n        this.$container = this.$original.children('.widget-box');\n    };\n\n    TextWidget.createToolbar = function(){\n\n        const $tlb = $(toolbarTpl({\n            serial : this.serial,\n            state : 'active'\n        }));\n\n        this.$container.append($tlb);\n\n        $tlb.find('[data-role=\"delete\"]').on('click.widget-box', e => {\n            e.stopPropagation();//to prevent direct deleting;\n            this.changeState('deleting');\n        });\n\n        return this;\n    };\n\n    return TextWidget;\n});\n","define('taoMediaManager/qtiCreator/editor/blockAdder/blockAdder',[\n    'jquery',\n    'lodash',\n    'tpl!taoQtiItem/qtiCreator/editor/blockAdder/tpl/addColumnRow',\n    'taoQtiItem/qtiItem/core/Element',\n    'taoMediaManager/qtiCreator/helper/creatorRenderer',\n    'taoQtiItem/qtiCreator/model/helper/container',\n    'taoQtiItem/qtiCreator/editor/gridEditor/content',\n    'taoMediaManager/qtiCreator/widgets/static/text/Widget'\n], function ($, _, adderTpl, Element, creatorRenderer, containerHelper, contentHelper, TextWidget) {\n    'use strict';\n\n    const _wrap = '<div class=\"colrow\"></div>';\n    const _placeholder = '<div class=\"placeholder\">';\n\n    /**\n     * Init the block adder on the item editor panel\n     *\n     * @param {Object} item - standard qti js object\n     * @param {JQuery} $editorPanel - the container the selector popup will be located in\n     */\n    function create(item, $editorPanel) {\n        /**\n         * Get the qti item body dom\n         *\n         * @returns {JQuery}\n         */\n        function _getItemBody() {\n            return $editorPanel.find('.qti-itemBody');\n        }\n\n        /**\n         * Init insertion relative to a widget container\n         *\n         * @param {JQuery} $widget\n         */\n        function _initInsertion($widget) {\n            const $wrap = $(_wrap);\n            let $colRow = $widget.parent('.colrow');\n\n            //trigger event to restore all currently active widget back to sleep state\n            $editorPanel.trigger('beforesave.qti-creator.active');\n\n            if (!$colRow.length) {\n                $widget.wrap(_wrap);\n                $colRow = $widget.parent('.colrow');\n            }\n            $colRow.after($wrap);\n\n            const $placeholder = $(_placeholder);\n            $wrap.addClass('tmp').prepend($placeholder);\n            _insertElement('_container', $placeholder);\n        }\n\n        /**\n         * End the current insertion state\n         *\n         * @returns {undefined}\n         */\n        function _endInsertion() {\n            //need to update item body\n            item.body(contentHelper.getContent(_getItemBody()));\n        }\n\n        /**\n         * Function to define behaviour when the insertion is completed\n         *\n         * @param {JQuery} $wrap\n         */\n        function _done($wrap) {\n            //remove tmp class\n            $wrap.removeClass('tmp');\n            _endInsertion();\n        }\n\n        /**\n         * Append the \"plus\" button into a widget\n         *\n         * @param {JQuery} $widget\n         * @returns {undefined}\n         */\n        function _appendButton($widget) {\n            //only append button to no-tmp widget and only add it once:\n            if (!$widget.children('.add-block-element').length && !$widget.parent('.colrow.tmp').length) {\n                const $adder = $(adderTpl());\n                $widget.append($adder);\n                $adder.on('click', function (e) {\n                    e.preventDefault();\n                    e.stopPropagation();\n\n                    const $widgetParent = $(this).parents('.widget-box');\n                    _initInsertion($widgetParent);\n                });\n            }\n        }\n\n        $editorPanel.find('.widget-textBlock').each(function () {\n            _appendButton($(this));\n        });\n\n        //bind add event\n        $editorPanel.on('ready.qti-widget', function (e, _widget) {\n            const qtiElement = _widget.element;\n\n            if (\n                qtiElement.is('_container')\n            ) {\n                let $colRow = _widget.$container.parent('.colrow');\n                if ($colRow.hasClass('tmp')) {\n                    _done($colRow);\n                }\n                if (!$colRow.length) {\n                    _widget.$container.wrap(_wrap);\n                }\n                _appendButton(_widget.$container);\n            }\n        });\n    }\n\n    /**\n     * Create a new qti element in place of the give $placehoder\n     *\n     * @param {String} qtiClass\n     * @param {JQuery} $placeholder\n     */\n    function _insertElement(qtiClass, $placeholder) {\n        //a new qti element has been added: update the model + render\n        $placeholder.removeAttr('id'); //prevent it from being deleted\n\n        $placeholder.addClass('widget-box'); //required for it to be considered as a widget during container serialization\n        $placeholder.attr({\n            'data-new': true,\n            'data-qti-class': qtiClass\n        }); //add data attribute to get the dom ready to be replaced by rendering\n\n        const $widget = $placeholder.parent().closest('.widget-box, .qti-item');\n        const $editable = $placeholder.closest('[data-html-editable], .qti-itemBody');\n        const widget = $widget.data('widget');\n        const element = widget.element;\n        const container = Element.isA(element, '_container') ? element : element.getBody();\n\n        if (!element || !$editable.length) {\n            throw new Error('cannot create new element');\n        }\n\n        containerHelper.createElements(container, contentHelper.getContent($editable), function (newElts) {\n            const creator = creatorRenderer.get();\n            creator.load(function () {\n                for (const serial in newElts) {\n                    const elt = newElts[serial];\n                    let $widgetElem;\n                    let widgetElem;\n                    let $colParent = $placeholder.parent();\n\n                    elt.setRenderer(this);\n\n                    //the text widget is \"inner-wrapped\" so need to build a temporary container:\n                    $placeholder.replaceWith('<div class=\"text-block\"></div>');\n                    const $textBlock = $colParent.find('.text-block');\n                    $textBlock.html(elt.render());\n\n                    //build the widget\n                    widgetElem = TextWidget.build(elt, $textBlock, creator.getOption('textOptionForm'), {\n                        ready: function () {\n                            //remove the temorary container\n                            if (this.$container.parent('.text-block').length) {\n                                this.$container.unwrap();\n                            }\n                            this.changeState('active');\n                        }\n                    });\n                    $widgetElem = widgetElem.$container;\n\n                    //inform height modification\n                    $widgetElem.trigger('contentChange.gridEdit');\n                    $widgetElem.trigger('resize.gridEdit');\n                }\n            }, this.getUsedClasses());\n        });\n    }\n\n    return {\n        create: create\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014-2020 (original work) Open Assessment Technologies SA;\n *\n */\ndefine('taoMediaManager/qtiCreator/editor/containerEditor',[\n    'lodash',\n    'jquery',\n    'core/promise',\n    'taoQtiItem/qtiItem/core/Loader',\n    'taoQtiItem/qtiCreator/model/Container',\n    'taoQtiItem/qtiCreator/model/Item',\n    'taoQtiItem/qtiCreator/model/helper/event',\n    'taoQtiItem/qtiCreator/model/qtiClasses',\n    'taoQtiItem/qtiCreator/helper/commonRenderer',\n    'taoQtiItem/qtiCreator/helper/xmlRenderer',\n    'taoQtiItem/qtiItem/helper/simpleParser',\n    'taoMediaManager/qtiCreator/helper/creatorRenderer',\n    'taoQtiItem/qtiCreator/editor/gridEditor/content',\n    'taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor'\n], function(_, $, Promise, Loader, Container, Item, event, allQtiClasses, commonRenderer, xmlRenderer, simpleParser, creatorRenderer, content, htmlEditor) {\n    'use strict';\n    // all files that use qtiCreator/helper/creatorRenderer should be copied from taoQtiItem\n    // because they should use proper locations that are binded in Renderer\n    // qtiCreator/helper/creatorRenderer use qtiCreator/renderers/Renderer\n    // qtiCreator/renderers/Renderer return Renderer with binded locations from qtiCreator/renderers/config\n\n    const _ns = 'containereditor';\n\n    const _defaults = {\n        change : _.noop,\n        markup : '',\n        markupSelector : '',\n        qtiMedia : false\n    };\n\n    event.initElementToWidgetListeners();\n\n    function parser($container){\n\n        //detect math ns :\n        const mathNs = 'm';//for 'http://www.w3.org/1998/Math/MathML'\n\n        //parse qti xml content to build a data object\n        const data = simpleParser.parse($container.clone(), {\n            ns : {\n                math : mathNs\n            }\n        });\n\n        if (data.body) {\n            return data.body;\n        } else {\n            throw new Error('invalid content for qti container');\n        }\n    }\n\n    /**\n     * Transform the given dom element into a rich-text editor\n     *\n     * @param {JQuery} $container - the container of the DOM element that is going to editable\n     * @param {Object} [options]\n     * @param {String} [options.markup] - the markup to be use as the initial editor content\n     * @param {String} [options.markupSelector] - the element in $xontainer that holds the html to be used as the initial editor content\n     * @param {Object} [options.related] - define the qti element object this editor is attached too. Very important to edit a picture or math element inside it because prevents leaving the editing state of the related element.\n     * @param {Function} [options.change] - the callback called when the editor content has been modified\n     * @param {String} [options.placeholder] - the placeholder text of the container editor when\n     * @param {Array} [options.toolbar] - the ck toolbar\n     * @param {Boolean} [options.qtiMedia=false] - allow insert media object\n     * @param {Object} [options.areaBroker] - allow to set a custom areaBroker on the renderer\n     * @param {String} [options.removePlugins] - a coma-separated plugin list that should not be loaded\n     * @param {Object} [options.metadata] - some metadata to attach to the root element (ex: { myDataName: 'myDataValue' })\n     * @param {Boolean} [options.resetRenderer] - force resetting the renderer\n     * @param {Boolean} [options.autofocus] - automatically focus the editor\n     * @returns {undefined}\n     */\n    function create($container, options){\n\n        let html, htmls, data, loader;\n\n        options = _.defaults(options || {}, _defaults);\n\n        //assign proper markup\n        if (options.markup) {\n            html = options.markup;\n            if (options.markupSelector) {\n                htmls = extractHtmlFromMarkup(html, options.markupSelector);\n                html = htmls[0] || '';\n            }\n            $container.html(html);\n        }\n\n        data = parser($container);\n        loader = new Loader().setClassesLocation(allQtiClasses);\n        loader.loadRequiredClasses(data, function() {\n\n            let item,\n                containerEditors,\n                renderer,\n                qtiClasses = ['img', 'object', 'math', 'include', 'printedVariable', '_container', '_tooltip'];\n\n            //create a new container object\n            const container = new Container();\n\n            //tag the new container as statelss, which means that its state is not supposed to change\n            container.data('stateless', true);\n\n            $container.data('container', container);\n\n            //need to attach a container to the item to enable innserElement.remove()\n            //@todo fix this\n            item = new Item().setElement(container);\n            container.setRootElement(item);\n\n            if (options.metadata) {\n                _.each(options.metadata, function (value, name) {\n                    item.data(name, value);\n                });\n            }\n\n            //associate it to the interaction?\n            if (options.related) {\n                containerEditors = options.related.data('container-editors') || [];\n                containerEditors.push(container);\n                options.related.data('container-editors', containerEditors);\n            }\n\n            this.loadContainer(container, data);\n\n            //apply common renderer :\n            renderer = creatorRenderer.get(options.resetRenderer, {}, options.areaBroker);\n            renderer.load(function() {\n                container.setRenderer(this);\n                $container.html(container.render());\n                container.postRender();\n\n                buildContainer($container);\n                buildEditor($container, container, {\n                    placeholder : options.placeholder || '',\n                    toolbar : options.toolbar || '',\n                    qtiMedia : options.qtiMedia,\n                    highlight : options.highlight,\n                    removePlugins : options.removePlugins || '',\n                    areaBroker : options.areaBroker,\n                    autofocus : options.autofocus || false\n                });\n\n                $container\n                    .off(`.${  _ns}`)\n                    .on(event.getList(_ns + event.getNs() + event.getNsModel()).join(' '), _.throttle(function(){\n                        var editorContent = container.render(xmlRenderer.get());\n                        $container.trigger(`containerchange.${  _ns}`, [editorContent]);\n\n                        if(_.isFunction(options.change)){\n                            options.change(editorContent);\n                        }\n                    }, 600));\n\n                $container.trigger('editorready.containereditor');\n\n            }, qtiClasses);\n\n        });\n\n    }\n\n    function buildContainer($container) {\n        $container.wrapInner($('<div>', {'class' : 'container-editor', 'data-html-editable' : true}));\n    }\n\n    function cleanup($container) {\n        const container = $container.data('container');\n        return new Promise(function (resolve) {\n            if(container) {\n                $(document).off(`.${  container.serial}`);\n                commonRenderer.load(['img', 'object', 'math', 'include', '_container', 'printedVariable', '_tooltip'], function(){\n                    $container.html(container.render(this));\n                    resolve();\n                });\n\n                $container.removeData('container');\n            } else {\n                resolve();\n            }\n        });\n    }\n\n    /**\n     * create a false widget that is required in html editor\n     *\n     * @param {JQuery} $editableContainer\n     * @param {Object} container\n     * @param {Object} options\n     * @param {Object} options.areaBroker\n     * @returns {Object} The fake widget object\n     */\n    function createFakeWidget($editableContainer, container, options) {\n\n        var widget = {\n            $container : $editableContainer,\n            element : container,\n            changeState : _.noop,\n            getAreaBroker : function getAreaBroker() {\n                return options.areaBroker;\n            }\n        };\n        //associate the widget to the container\n        container.data('widget', widget);\n\n        return widget;\n    }\n\n    function buildEditor($editableContainer, container, options) {\n\n        $editableContainer.attr('data-html-editable-container', true);\n\n        if (!htmlEditor.hasEditor($editableContainer)) {\n\n            htmlEditor.buildEditor($editableContainer, _.defaults(options || {}, {\n                shieldInnerContent : false,\n                passthroughInnerContent : false,\n                change : content.getChangeCallback(container),\n                data : {\n                    widget : createFakeWidget($editableContainer, container, options),\n                    container : container\n                }\n            }));\n        }\n    }\n\n    function destroy($editableContainer) {\n        return htmlEditor.destroyEditor($editableContainer)\n            .then(function() {\n                $editableContainer.removeAttr('data-html-editable-container');\n                return cleanup($editableContainer);\n            });\n    }\n\n    function extractHtmlFromMarkup(markupStr, selector) {\n        const $found = $('<div>').html(markupStr).find(selector);\n        let ret = [];\n        $found.each(function(){\n            ret.push($(this).html());\n        });\n        return ret;\n    }\n\n    return {\n        create : create,\n        destroy : destroy\n    };\n});\n","\n/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\n */\n\n/**\n * This plugin add a \"plus\" button below each content block to add content more easily.\n *\n * @author Bertrand Chevrier <bertrand@taotesting.com>\n */\ndefine('taoMediaManager/qtiCreator/plugins/content/blockAdder',[\n    'i18n',\n    'core/plugin',\n    'taoMediaManager/qtiCreator/editor/blockAdder/blockAdder'\n], function(__, pluginFactory, blockAdder){\n    'use strict';\n\n    /**\n     * Returns the configured plugin\n     * @returns {Function} the plugin\n     */\n    return pluginFactory({\n\n        name : 'blockAdder',\n\n        /**\n         * Hook to the host's init\n         */\n        init : function init(){},\n\n        /**\n         * Hook to the host's render\n         */\n        render : function render(){\n\n            //set up the block adder\n            blockAdder.create(\n                this.getHost().getItem(),\n                this.getAreaBroker().getItemPanelArea()\n            );\n        }\n    });\n});\n\n","\n/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 (original work) Open Assessment Technologies SA ;\n */\n\n/**\n * This plugin displays add the preview button and launch it.\n * It also provides a mechanism that ask to save\n * the item before the preview (if the item has changed - should).\n *\n * @author Juan Luis Gutierrez Dos Santos <juanluis.gutierrezdossantos@taotesting.com>\n */\n\ndefine('taoMediaManager/qtiCreator/plugins/menu/preview',[\n    'jquery',\n    'i18n',\n    'core/plugin',\n    'ui/hider',\n    'taoMediaManager/previewer/adapter/item/qtiSharedStimulusItem',\n    'tpl!taoQtiItem/qtiCreator/plugins/button',\n], function($, __, pluginFactory, hider, previewerFactory, buttonTpl) {\n    'use strict';\n\n    /**\n     * Returns the configured plugin\n     * @returns {Function} the plugin\n     */\n    return pluginFactory({\n        name : 'preview',\n\n        /**\n         * Initialize the plugin (called during itemCreator's init)\n         * @fires {itemCreator#preview}\n         */\n        init() {\n            const SharedStimulusCreator = this.getHost();\n\n            /**\n             * Preview an item\n             * @event SharedStimulusCreator#preview\n             * @param {String} uri - the uri of this item to preview\n             */\n            SharedStimulusCreator.on('preview', (id) => {\n\n                // TO DO should be created empty item with shared stimulus inside\n                previewerFactory.init(id, {\n                    readOnly: false,\n                    fullPage: true\n                });\n            });\n\n            const sharedStimulusConfig = SharedStimulusCreator.getConfig();\n            if (sharedStimulusConfig.properties.previewEnabled) {\n                //creates the preview button\n                this.$element = $(buttonTpl({\n                    icon: 'preview',\n                    title: __('Preview the item'),\n                    text: __('Preview'),\n                    cssClass: 'preview-trigger',\n                    testId: 'preview-the-asset'\n                })).on('click', e => {\n                    $(document).trigger('open-preview.qti-item');\n                    e.preventDefault();\n                    this.disable();\n                    SharedStimulusCreator.trigger('preview', SharedStimulusCreator.getSharedStimulusId());\n                    this.enable();\n                });\n            }\n        },\n\n        /**\n         * Initialize the plugin (called during SharedStimulusCreator's render)\n         */\n        render() {\n            //attach the element to the menu area\n            const $container = this.getAreaBroker().getMenuArea();\n            $container.append(this.$element);\n        },\n\n        /**\n         * Called during the SharedStimulusCreator's destroy phase\n         */\n        destroy() {\n            this.$element.remove();\n        },\n\n        /**\n         * Enable the button\n         */\n        enable() {\n            this.$element\n                .removeProp('disabled')\n                .removeClass('disabled');\n        },\n\n        /**\n         * Disable the button\n         */\n        disable() {\n            this.$element\n                .prop('disabled', true)\n                .addClass('disabled');\n        },\n\n        /**\n         * Show the button\n         */\n        show() {\n            hider.show(this.$element);\n        },\n\n        /**\n         * Hide the button\n         */\n        hide() {\n            hider.hide(this.$element);\n        }\n    });\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 (original work) Open Assessment Technologies SA ;\n */\n\n/**\n * This plugin adds a save button to the menu.\n * Could be useful, or not (Save is so 90's, we want auto-saving with undo/redo capabilities)\n *\n * @author Juan Luis Gutierrez Dos Santos <juanluis.gutierrezdossantos@taotesting.com>\n */\n\ndefine('taoMediaManager/qtiCreator/plugins/menu/save',[\n    'jquery',\n    'i18n',\n    'core/plugin',\n    'ui/hider',\n    'tpl!taoQtiItem/qtiCreator/plugins/button'\n], function($, __, pluginFactory, hider, buttonTpl) {\n    'use strict';\n\n    /**\n     * Returns the configured plugin\n     * @returns {Function} the plugin\n     */\n    return pluginFactory({\n        name : 'save',\n\n        /**\n         * Initialize the plugin (called during itemCreator's init)\n         */\n        init() {\n            const sharedStimulusCreator = this.getHost();\n\n            this.$element = $(buttonTpl({\n                icon: 'save',\n                title: __('Save the asset'),\n                text : __('Save'),\n                cssClass: 'save-trigger',\n                testId: 'save-the-asset'\n            })).on('click', e => {\n                e.preventDefault();\n                this.disable();\n                $('#item-editor-panel').trigger('beforesave.qti-creator');\n                sharedStimulusCreator.trigger('save');\n            });\n\n            this.hide();\n            this.disable();\n\n            sharedStimulusCreator.on('ready saved error', () => {\n                this.enable();\n            });\n        },\n\n        /**\n         * Called during the sharedStimulusCreator's render phase\n         */\n        render() {\n            //attach the element to the menu area\n            const $container = this.getAreaBroker().getMenuArea();\n            $container.append(this.$element);\n            this.show();\n        },\n\n        /**\n         * Called during the sharedStimulusCreator's destroy phase\n         */\n        destroy() {\n            this.$element.remove();\n        },\n\n        /**\n         * Enable the button\n         */\n        enable() {\n            this.$element\n                .removeProp('disabled')\n                .removeClass('disabled');\n        },\n\n        /**\n         * Disable the button\n         */\n        disable() {\n            this.$element\n                .prop('disabled', true)\n                .addClass('disabled');\n        },\n\n        /**\n         * Show the button\n         */\n        show() {\n            hider.show(this.$element);\n        },\n\n        /**\n         * Hide the button\n         */\n        hide() {\n            hider.hide(this.$element);\n        }\n    });\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 (original work) Open Assessment Technologies SA;\n */\n\n/**\n * This plugin adds a \"back\" button that does a History.go(-1)\n * (like your browser's back button).\n *\n * @author Juan Luis Gutierrez Dos Santos <juanluis.gutierrezdossantos@taotesting.com>\n */\n\ndefine('taoMediaManager/qtiCreator/plugins/navigation/back',[\n    'jquery',\n    'i18n',\n    'core/plugin',\n    'ui/hider',\n    'tpl!taoQtiItem/qtiCreator/plugins/button'\n], function($, __, pluginFactory, hider, buttonTpl) {\n    'use strict';\n\n    /**\n     * Returns the configured plugin\n     * @returns {Function} the plugin\n     */\n    return pluginFactory({\n        name : 'back',\n\n        /**\n         * Initialize the plugin\n         */\n        init() {\n            const sharedStimulusCreator = this.getHost();\n\n            sharedStimulusCreator.on('exit', function(){\n                window.history.back();\n            });\n\n            this.$element = $(buttonTpl({\n                icon: 'left',\n                title: __('Back to Manage Assets'),\n                text : __('Manage Assets'),\n                cssClass: 'back-action',\n                testId: 'manage-assets'\n            })).on('click', function backHandler(e){\n                e.preventDefault();\n                sharedStimulusCreator.trigger('exit');\n            });\n            this.hide();\n        },\n\n        /**\n         * Called during the sharedStimulusCreator's render phase\n         */\n        render() {\n            //attach the element to the menu area\n            const $container = this.getAreaBroker().getMenuLeftArea();\n            $container.append(this.$element);\n            this.show();\n        },\n\n        /**\n         * Called during the sharedStimulusCreator's destroy phase\n         */\n        destroy() {\n            this.$element.remove();\n        },\n\n        /**\n         * Enable the button\n         */\n        enable() {\n            this.$element\n                .removeProp('disabled')\n                .removeClass('disabled');\n        },\n\n        /**\n         * Disable the button\n         */\n        disable() {\n            this.$element\n                .prop('disabled', true)\n                .addClass('disabled');\n        },\n\n        /**\n         * Show the button\n         */\n        show() {\n            hider.show(this.$element);\n        },\n\n        /**\n         * Hide the button\n         */\n        hide(){\n            hider.hide(this.$element);\n        }\n    });\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2022 (original work) Open Assessment Technologies SA\n *\n */\ndefine('taoMediaManager/qtiCreator/renderers/Figcaption',[\n    'lodash',\n    'taoQtiItem/qtiCommonRenderer/renderers/Figcaption'\n], function(_, Figcaption){\n    'use strict';\n\n    const CreatorFigcaption = _.clone(Figcaption);\n\n    return CreatorFigcaption;\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2021 (original work) Open Assessment Technologies SA ;\n *\n */\ndefine('taoMediaManager/qtiCreator/widgets/static/figure/states/Active',[\n    'taoQtiItem/qtiCreator/widgets/states/factory',\n    'taoQtiItem/qtiCreator/widgets/static/states/Active',\n    'tpl!taoQtiItem/qtiCreator/tpl/forms/static/figure',\n    'taoQtiItem/qtiCreator/widgets/helpers/formElement',\n    'taoQtiItem/qtiCreator/widgets/static/helpers/inline',\n    'ui/figure/FigureStateActive',\n], function (stateFactory, ActiveState, formTpl, formElement, inlineHelper, FigureStateActive) {\n    'use strict';\n    return FigureStateActive(stateFactory, ActiveState, formTpl, formElement, inlineHelper);\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2022 (original work) Open Assessment Technologies SA ;\n *\n */\ndefine('taoMediaManager/qtiCreator/widgets/static/figure/states/states',[\n    'taoQtiItem/qtiCreator/widgets/states/factory',\n    'taoQtiItem/qtiCreator/widgets/static/states/states',\n    'taoQtiItem/qtiCreator/widgets/static/figure/states/Sleep',\n    'taoMediaManager/qtiCreator/widgets/static/figure/states/Active'\n], function(factory, states){\n    return factory.createBundle(states, arguments);\n});\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2022 (original work) Open Assessment Technologies SA ;\n *\n */\ndefine('taoMediaManager/qtiCreator/widgets/static/figure/Widget',[\n    'jquery',\n    'lodash',\n    'taoQtiItem/qtiCreator/widgets/static/Widget',\n    'taoMediaManager/qtiCreator/widgets/static/figure/states/states',\n    'taoQtiItem/qtiCreator/widgets/static/helpers/widget',\n    'tpl!taoQtiItem/qtiCreator/tpl/toolbars/media',\n    'taoQtiItem/qtiCreator/widgets/static/helpers/inline',\n    'ui/mediaEditor/plugins/mediaAlignment/helper'\n], function ($, _, Widget, states, helper, toolbarTpl, inlineHelper, alignmentHelper) {\n    'use strict';\n\n    const FigureWidget = Widget.clone();\n\n    FigureWidget.initCreator = function initCreator(options) {\n        const figure = this.element;\n        const img = _.find(figure.getBody().elements, elem => elem.is('img'));\n\n        this.registerStates(states);\n\n        Widget.initCreator.call(this);\n\n        inlineHelper.togglePlaceholder(this);\n        // Resets classes for dom elements: figure and wrapper on initial load and in sleep / inactive mode\n        alignmentHelper.initAlignment(this);\n\n        //check file exists:\n        inlineHelper.checkFileExists(this, img, 'src', options.baseUrl);\n        $('#item-editor-scope').on(`filedelete.resourcemgr.${this.element.serial}`, (e, src) => {\n            if (this.getAssetManager().resolve(img.attr('src')) === this.getAssetManager().resolve(src)) {\n                img.attr('src', '');\n                inlineHelper.togglePlaceholder(this);\n            }\n        });\n    };\n\n    FigureWidget.destroy = function destroy() {\n        $('#item-editor-scope').off(`.${this.element.serial}`);\n    };\n\n    FigureWidget.getRequiredOptions = function () {\n        return ['baseUrl', 'uri', 'lang', 'mediaManager', 'assetManager'];\n    };\n\n    FigureWidget.buildContainer = function buildContainer() {\n        helper.buildBlockContainer(this);\n        const img = _.find(this.element.getBody().elements, elem => elem.is('img'));\n        const $img = this.$original.find('img');\n        if ($img.length) {\n            // move width from image to figure\n            this.$container.css({ width: img.attr('width') });\n            $img.attr('width', '100%');\n            $img.removeAttr('style');\n        }\n        return this;\n    };\n\n    FigureWidget.createToolbar = function createToolbar() {\n        helper.createToolbar(this, toolbarTpl);\n        return this;\n    };\n\n    return FigureWidget;\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2022 (original work) Open Assessment Technologies SA\n *\n */\ndefine('taoMediaManager/qtiCreator/renderers/Figure',[\n    'lodash',\n    'taoQtiItem/qtiCommonRenderer/renderers/Figure',\n    'taoMediaManager/qtiCreator/widgets/static/figure/Widget'\n], function(_, Figure, FigureWidget){\n    'use strict';\n\n    const CreatorFigure = _.clone(Figure);\n\n    CreatorFigure.render = function(figure, options){\n        const imageElem = _.find(figure.getBody().elements, elem => elem.is('img'));\n        options = options || {};\n        options.baseUrl = this.getOption('baseUrl');\n        options.uri = this.getOption('uri');\n        options.lang = this.getOption('lang');\n        options.mediaManager = this.getOption('mediaManager');\n        options.assetManager = this.getAssetManager();\n        options.state = imageElem.metaData.widget && imageElem.metaData.widget.getCurrentState().name;\n\n        FigureWidget.build(\n            figure,\n            Figure.getContainer(figure),\n            this.getOption('bodyElementOptionForm'),\n            options\n        );\n    };\n\n    return CreatorFigure;\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2021 (original work) Open Assessment Technologies SA ;\n *\n */\ndefine('taoMediaManager/qtiCreator/widgets/static/img/states/Active',[\n    'taoQtiItem/qtiCreator/widgets/states/factory',\n    'taoQtiItem/qtiCreator/widgets/static/states/Active',\n    'tpl!taoQtiItem/qtiCreator/tpl/forms/static/img',\n    'taoQtiItem/qtiCreator/widgets/helpers/formElement',\n    'taoQtiItem/qtiCreator/widgets/static/helpers/inline',\n    'ui/image/ImgStateActive',\n], function (stateFactory, ActiveState, formTpl, formElement, inlineHelper, ImgStateActive) {\n    'use strict';\n    return ImgStateActive(stateFactory, ActiveState, formTpl, formElement, inlineHelper);\n});\n\n","define('taoMediaManager/qtiCreator/widgets/static/img/states/states',[\n    'taoQtiItem/qtiCreator/widgets/states/factory',\n    'taoQtiItem/qtiCreator/widgets/static/states/states',\n    'taoQtiItem/qtiCreator/widgets/static/img/states/Sleep',\n    'taoMediaManager/qtiCreator/widgets/static/img/states/Active'\n], function (factory, states) {\n    'use strict';\n\n    return factory.createBundle(states, arguments);\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 (original work) Open Assessment Technologies SA ;\n *\n */\ndefine('taoMediaManager/qtiCreator/widgets/static/img/Widget',[\n    'jquery',\n    'taoQtiItem/qtiCreator/widgets/static/Widget',\n    'taoMediaManager/qtiCreator/widgets/static/img/states/states',\n    'taoQtiItem/qtiCreator/widgets/static/helpers/widget',\n    'tpl!taoQtiItem/qtiCreator/tpl/toolbars/media',\n    'taoQtiItem/qtiCreator/widgets/static/helpers/inline',\n    'ui/mediaEditor/plugins/mediaAlignment/helper'\n], function ($, Widget, states, helper, toolbarTpl, inlineHelper, alignmentHelper) {\n    'use strict';\n\n    const ImgWidget = Widget.clone();\n\n    ImgWidget.initCreator = function initCreator(options) {\n        const img = this.element;\n\n        this.registerStates(states);\n\n        Widget.initCreator.call(this);\n\n        inlineHelper.togglePlaceholder(this);\n        // Resets classes for dom elements: img and wrapper on initial load and in sleep / inactive mode\n        alignmentHelper.initAlignment(this);\n\n        //check file exists:\n        inlineHelper.checkFileExists(this, img, 'src', options.baseUrl);\n        $('#item-editor-scope').on(`filedelete.resourcemgr.${this.element.serial}`, (e, src) => {\n            if (this.getAssetManager().resolve(img.attr('src')) === this.getAssetManager().resolve(src)) {\n                img.attr('src', '');\n                inlineHelper.togglePlaceholder(self);\n            }\n        });\n    };\n\n    ImgWidget.destroy = function destroy() {\n        $('#item-editor-scope').off(`.${this.element.serial}`);\n    };\n\n    ImgWidget.getRequiredOptions = function getRequiredOptions() {\n        return ['baseUrl', 'uri', 'lang', 'mediaManager', 'assetManager'];\n    };\n\n    ImgWidget.buildContainer = function buildContainer() {\n        helper.buildInlineContainer(this);\n\n        this.$container.css({\n            width: this.element.attr('width'),\n            height: this.element.attr('height')\n        });\n        if (this.$original[0]) {\n            this.$original[0].setAttribute('width', '100%');\n            this.$original[0].removeAttribute('height');\n        }\n\n        return this;\n    };\n\n    ImgWidget.createToolbar = function createToolbar() {\n        helper.createToolbar(this, toolbarTpl);\n\n        return this;\n    };\n\n    return ImgWidget;\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n */\n\ndefine('taoMediaManager/qtiCreator/renderers/Img',[\n    'lodash',\n    'taoQtiItem/qtiCommonRenderer/renderers/Img',\n    'taoMediaManager/qtiCreator/widgets/static/img/Widget'\n], function (_, Renderer, Widget) {\n    'use strict';\n\n    const CreatorImg = _.clone(Renderer);\n\n    CreatorImg.render = function render(img, options) {\n        const $container = Renderer.getContainer(img);\n        if ($container.parent('figure').length) {\n            // don't create widget if has figure parent\n            return CreatorImg;\n        }\n\n        options = options || {};\n        options.baseUrl = this.getOption('baseUrl');\n        options.uri = this.getOption('uri');\n        options.lang = this.getOption('lang');\n        options.mediaManager = this.getOption('mediaManager');\n        options.assetManager = this.getAssetManager();\n\n        Widget.build(img, Renderer.getContainer(img), this.getOption('bodyElementOptionForm'), options);\n    };\n\n    return CreatorImg;\n});\n\n","\ndefine('tpl!taoMediaManager/qtiCreator/tpl/forms/item', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var stack1, functionType=\"function\", escapeExpression=this.escapeExpression, self=this, helperMissing=helpers.helperMissing;\n\nfunction program1(depth0,data) {\n  \n  var buffer = \"\", stack1, helper, options;\n  buffer += \"\\n    <div class=\\\"panel\\\">\\n        <label for=\\\"xml:lang\\\">\\n            \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Language\", options) : helperMissing.call(depth0, \"__\", \"Language\", options)))\n    + \"\\n        </label>\\n        <span class=\\\"icon-help tooltipstered\\\" data-tooltip=\\\"~ .tooltip-content:first\\\" data-tooltip-theme=\\\"info\\\"></span>\\n        <span class=\\\"tooltip-content\\\">\\n            \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Define item language.\", options) : helperMissing.call(depth0, \"__\", \"Define item language.\", options)))\n    + \"\\n        </span>\\n        <select name=\\\"xml:lang\\\" class=\\\"select2\\\" data-has-search=\\\"false\\\">\\n            \";\n  stack1 = helpers.each.call(depth0, (depth0 && depth0.languagesList), {hash:{},inverse:self.noop,fn:self.programWithDepth(2, program2, data, depth0),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n        </select>\\n    </div>\\n\";\n  return buffer;\n  }\nfunction program2(depth0,data,depth1) {\n  \n  var buffer = \"\", stack1, helper, options;\n  buffer += \"\\n                <option value=\\\"\"\n    + escapeExpression(((stack1 = (data == null || data === false ? data : data.key)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1))\n    + \"\\\"\";\n  stack1 = (helper = helpers.equal || (depth1 && depth1.equal),options={hash:{},inverse:self.noop,fn:self.program(3, program3, data),data:data},helper ? helper.call(depth0, (data == null || data === false ? data : data.key), (depth1 && depth1['xml:lang']), options) : helperMissing.call(depth0, \"equal\", (data == null || data === false ? data : data.key), (depth1 && depth1['xml:lang']), options));\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \">\"\n    + escapeExpression((typeof depth0 === functionType ? depth0.apply(depth0) : depth0))\n    + \"</option>\\n            \";\n  return buffer;\n  }\nfunction program3(depth0,data) {\n  \n  \n  return \" selected=\\\"selected\\\"\";\n  }\n\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.languagesList), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { return stack1; }\n  else { return ''; }\n  });\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014-2020 (original work) Open Assessment Technologies SA ;\n *\n */\n\ndefine('taoMediaManager/qtiCreator/widgets/item/states/Active',[\n    'lodash',\n    'taoQtiItem/qtiCreator/widgets/states/factory',\n    'taoMediaManager/qtiCreator/widgets/states/Active',\n    'tpl!taoMediaManager/qtiCreator/tpl/forms/item',\n    'taoQtiItem/qtiCreator/widgets/helpers/formElement'\n], function(_, stateFactory, Active, formTpl, formElement){\n    'use strict';\n\n    const ItemStateActive = stateFactory.create(Active, function enterActiveState() {\n        const _widget = this.widget;\n        const item = _widget.element;\n        const $form = _widget.$form;\n\n        //build form:\n        $form.html(formTpl({\n            'xml:lang' : item.attr('xml:lang'),\n            languagesList : item.data('languagesList')\n        }));\n\n        //init widget\n        formElement.initWidget($form);\n\n        //init data validation and binding\n        formElement.setChangeCallbacks($form, item, {\n            'xml:lang' : formElement.getAttributeChangeCallback()\n        });\n\n    }, _.noop);\n\n    return ItemStateActive;\n});\n\n","define('taoMediaManager/qtiCreator/widgets/item/states/states',[\n    'taoQtiItem/qtiCreator/widgets/states/factory',\n    'taoMediaManager/qtiCreator/widgets/item/states/Active'\n], function(factory){\n    'use strict';\n\n    return factory.createBundle(arguments);\n});\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 (original work) Open Assessment Technologies SA ;\n *\n */\n\ndefine('taoMediaManager/qtiCreator/widgets/item/Widget',[\n    'lodash',\n    'i18n',\n    'jquery',\n    'core/promise',\n    'util/url',\n    'taoQtiItem/qtiCreator/widgets/Widget',\n    'taoMediaManager/qtiCreator/widgets/item/states/states',\n    'taoQtiItem/qtiItem/core/Element',\n    'taoMediaManager/qtiCreator/helper/creatorRenderer',\n    'taoQtiItem/qtiCreator/model/helper/container',\n    'taoQtiItem/qtiCreator/editor/gridEditor/content',\n    'taoQtiItem/qtiCreator/helper/xmlRenderer',\n    'taoQtiItem/qtiCreator/helper/devTools',\n    'taoMediaManager/qtiCreator/widgets/static/text/Widget',\n    'taoQtiItem/qtiItem/helper/xmlNsHandler',\n    'taoQtiItem/qtiCreator/editor/jquery.gridEditor'\n], function(\n    _,\n    __,\n    $,\n    Promise,\n    urlUtil,\n    Widget,\n    states,\n    Element,\n    creatorRenderer,\n    containerHelper,\n    contentHelper,\n    xmlRenderer,\n    devTools,\n    TextWidget,\n    xmlNsHandler\n){\n    'use strict';\n\n    const ItemWidget = Widget.clone();\n\n    ItemWidget.initCreator = function(config) {\n        const self = this;\n        this.registerStates(states);\n\n        Widget.initCreator.call(this);\n\n        if (!config || !config.uri) {\n            throw new Error('missing required config parameter uri in item widget initialization');\n        }\n\n        this.saveItemUrl = config.saveItemUrl;\n\n        this.renderer = config.renderer;\n\n        this.itemUri = config.uri;\n\n        //this.initUiComponents();\n\n        return new Promise(function(resolve) {\n            self.initTextWidgets(function() {\n\n                //when the text widgets are ready:\n                this.initGridEditor();\n\n                //active debugger\n                this.debug({\n                    state : false,\n                    xml : false\n                });\n\n                resolve();\n            });\n        });\n    };\n\n    ItemWidget.buildContainer = function() {\n        this.$container = this.$original;\n    };\n\n    ItemWidget.initUiComponents = function() {\n\n        const element = this.element,\n            $saveBtn = $('#save-trigger');\n\n        //listen to invalid states:\n        this.on('metaChange', function(data){\n            if (data.element.getSerial() === element.getSerial() && data.key === 'invalid') {\n                const invalid = element.data('invalid');\n                if (_.size(invalid)) {\n                    $saveBtn.addClass('disabled');\n                } else {\n                    $saveBtn.removeClass('disabled');\n                }\n            }\n        }, true);\n\n    };\n\n    ItemWidget.initGridEditor = function() {\n\n        const self = this,\n            item = this.element,\n            $itemBody = this.$container.find('.qti-itemBody'),\n            $itemEditorPanel = $('#item-editor-panel');\n\n        $itemBody.gridEditor();\n        $itemBody.gridEditor('resizable');\n        $itemBody.gridEditor('addInsertables', $('.tool-list > [data-qti-class]:not(.disabled)'), {\n            helper : function() {\n                return $(this).find('.icon').clone().addClass('dragging');\n            }\n        });\n\n        $itemBody.on('beforedragoverstart.gridEdit', function() {\n\n            $itemEditorPanel.addClass('dragging');\n            $itemBody.removeClass('hoverable').addClass('inserting');\n\n        }).on('dragoverstop.gridEdit', function() {\n\n            $itemEditorPanel.removeClass('dragging');\n            $itemBody.addClass('hoverable').removeClass('inserting');\n\n        }).on('dropped.gridEdit.insertable', function(e, qtiClass, $placeholder) {\n\n            //a new qti element has been added: update the model + render\n            $placeholder.removeAttr('id');//prevent it from being deleted\n\n            if (qtiClass === 'rubricBlock') {\n                //qti strange exception: a rubricBlock must be the first child of itemBody, nothing else...\n                //so in this specific case, consider the whole row as the rubricBlock\n                //by the way, in our grid system, rubricBlock can only have a width of col-12\n                $placeholder = $placeholder.parent('.col-12').parent('.grid-row');\n            }\n\n            $placeholder.addClass('widget-box');//required for it to be considered as a widget during container serialization\n            $placeholder.attr({\n                'data-new' : true,\n                'data-qti-class' : qtiClass\n            });//add data attribute to get the dom ready to be replaced by rendering\n\n            const $widget = $placeholder.parent().closest('.widget-box, .qti-item');\n            const $editable = $placeholder.closest('[data-html-editable], .qti-itemBody');\n            const widget = $widget.data('widget');\n            const element = widget.element;\n            const container = Element.isA(element, '_container') ? element : element.getBody();\n\n            if (!element || !$editable.length) {\n                throw new Error('cannot create new element');\n            }\n\n            containerHelper.createElements(container, contentHelper.getContent($editable), function(newElts) {\n\n                creatorRenderer.get().load(function() {\n\n                    _.forEach(newElts, (elt) => {\n                        let $eltWidget,\n                            eltwWdget,\n                            $colParent = $placeholder.parent();\n\n\n                        elt.setRenderer(this);\n\n                        if (Element.isA(elt, '_container')) {\n                            $colParent.empty();//clear the col content, and leave an empty text field\n                            $colParent.html(elt.render());\n                            eltwWdget = self.initTextWidget(elt, $colParent);\n                            $eltWidget = eltwWdget.$container;\n                        } else {\n                            elt.render($placeholder);\n\n                            //TODO resolve the promise it returns\n                            elt.postRender();\n                            eltwWdget = elt.data('widget');\n                            if (Element.isA(elt, 'blockInteraction')) {\n                                $eltWidget = eltwWdget.$container;\n                            } else {\n                                //leave the container in place\n                                $eltWidget = eltwWdget.$original;\n                            }\n                        }\n\n                        //inform height modification\n                        $eltWidget.trigger('contentChange.gridEdit');\n                        $eltWidget.trigger('resize.gridEdit');\n\n                        //active it right away:\n                        if (Element.isA(elt, 'interaction')) {\n                            eltwWdget.changeState('question');\n                        } else {\n                            eltwWdget.changeState('active');\n                        }\n\n                    });\n                }, this.getUsedClasses());\n            });\n\n        }).on('resizestop.gridEdit', function() {\n\n            item.body($itemBody.gridEditor('getContent'));\n\n        });\n\n    };\n\n    const _detachElements = function(container, elements) {\n\n        const containerElements = {};\n        _.each(elements, function(elementSerial){\n            containerElements[elementSerial] = container.elements[elementSerial];\n            delete container.elements[elementSerial];\n        });\n        return containerElements;\n    };\n\n    ItemWidget.initTextWidgets = function(callback) {\n\n        let self = this,\n            item = this.element,\n            $originalContainer = this.$container,\n            i = 1,\n            subContainers = [];\n\n        callback = callback || _.noop;\n\n        //temporarily tag col that need to be transformed into\n        $originalContainer.find('.qti-itemBody > .grid-row').each(function() {\n\n            const $row = $(this);\n\n            if (!$row.hasClass('widget-box')) {//not a rubricBlock\n                $row.children().each(function() {\n\n                    let $col = $(this),\n                        isTextBlock = false;\n\n                    $col.contents().each(function() {\n                        if(this.nodeType === 3 && this.nodeValue && this.nodeValue.trim()){\n                            isTextBlock = true;\n                            return false;\n                        }\n                    });\n\n                    const $widget = $col.children();\n                    if ($widget.length > 1 || !$widget.hasClass('widget-blockInteraction')) {//not an immediate qti element\n                        if ($widget.hasClass('colrow')) {\n                            $widget.each(function() {\n                                const $subElement = $(this);\n                                const $subWidget = $subElement.children();\n                                if ($subWidget.length > 1 || !$subWidget.hasClass('widget-blockInteraction')) {\n                                    $subElement.attr('data-text-block-id', `text-block-${i}`);\n                                    i++;\n                                }\n                            });\n                        } else {\n                            isTextBlock = true;\n                        }\n                    }\n\n                    if (isTextBlock) {\n                        $col.attr('data-text-block-id', `text-block-${i}`);\n                        i++;\n                    }\n                });\n            }\n        });\n\n        //clone the container to create the new container model:\n        const $clonedContainer = $originalContainer.clone();\n        $clonedContainer.find('.qti-itemBody > .grid-row [data-text-block-id]').each(function() {\n\n            const $originalTextBlock = $(this),\n                textBlockId = $originalTextBlock.data('text-block-id'),\n                $subContainer = $originalTextBlock.clone(),\n                subContainerElements = contentHelper.serializeElements($subContainer),\n                subContainerBody = $subContainer.html();//get serialized body\n\n            $originalTextBlock.removeAttr('data-text-block-id').html('{{_container:new}}');\n\n            subContainers.push({\n                body : subContainerBody,\n                elements : subContainerElements,\n                $original : $originalContainer.find(`[data-text-block-id=\"${textBlockId}\"]`).removeAttr('data-text-block-id')\n            });\n        });\n\n        //create new container model with the created sub containers\n        contentHelper.serializeElements($clonedContainer);\n\n        const serializedItemBody = $clonedContainer.find('.qti-itemBody').html(),\n            itemBody = item.getBody();\n\n        if (subContainers.length) {\n\n            containerHelper.createElements(itemBody, serializedItemBody, function(newElts) {\n\n                if (_.size(newElts) !== subContainers.length) {\n\n                    throw new Error(\"number of sub-containers mismatch\");\n\n                } else {\n\n                    _.each(newElts, function(container){\n\n                        const containerData = subContainers.shift();//get data in order\n                        const containerElements = _detachElements(itemBody, containerData.elements);\n\n                        container.setElements(containerElements, containerData.body);\n\n                        self.initTextWidget(container, containerData.$original);\n\n                    });\n\n                    _.defer(function(){\n                        callback.call(self);\n                    });\n                }\n            });\n\n        } else {\n\n            callback.call(self);\n        }\n\n    };\n\n    ItemWidget.initTextWidget = function(container, $col) {\n        return TextWidget.build(container, $col, this.renderer.getOption('textOptionForm'), {});\n    };\n\n    /**\n     * Enable debugging\n     *\n     * @param {Object} [options] - log state change in console\n     * @param {Boolean} [options.state = false] - log state change in console\n     * @param {Boolean} [options.xml = false] - real-time qti xml display under the creator\n     */\n    ItemWidget.debug = function(options) {\n\n        options = options || {};\n\n        if (options.state) {\n            devTools.listenStateChange();\n        }\n\n        if (options.xml) {\n            const $code = $('<code>', {'class' : 'language-markup'}),\n                $pre = $('<pre>', {'class' : 'line-numbers'}).append($code);\n\n            $('#item-editor-wrapper').append($pre);\n            devTools.liveXmlPreview(this.element, $code);\n        }\n\n    };\n\n    function hasUnsupportedInteraction(xml) {\n        const $qti = $(xml);\n        return ($qti.find('div.qti-interaction.qti-customInteraction[data-serial]').length > 0);\n    }\n\n    return ItemWidget;\n});\n\n","\ndefine('tpl!taoMediaManager/qtiCreator/renderers/tpl/wrap', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  \n\n\n  return \"<div class=\\\"grid-row\\\"><div class=\\\"col-12\\\"></div></div>\";\n  });\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n */\n\ndefine('taoMediaManager/qtiCreator/renderers/Item',[\n    'jquery',\n    'lodash',\n    'taoQtiItem/qtiCommonRenderer/renderers/Item',\n    'taoMediaManager/qtiCreator/widgets/item/Widget',\n    'tpl!taoQtiItem/qtiCreator/tpl/item',\n    'tpl!taoMediaManager/qtiCreator/renderers/tpl/wrap'\n], function($, _, CommonRenderer, Widget, tpl, wrapTpl) {\n    'use strict';\n\n    const CreatorItem = _.clone(CommonRenderer);\n\n    const _normalizeItemBody = function _normalizeItemBody($itemBody) {\n\n        $itemBody.children().each(function(){\n            const $child = $(this);\n            //must be a grid-row for editing:\n            if (!$child.hasClass('grid-row') && !$child.hasClass('qti-infoControl')) {\n                $child.wrap(wrapTpl());\n            }\n        });\n\n        return $itemBody;\n    };\n\n    CreatorItem.template = tpl;\n\n    CreatorItem.render = function render(item, options) {\n\n        const $itemContainer = CommonRenderer.getContainer(item);\n\n        _normalizeItemBody($itemContainer.find('.qti-itemBody'));\n\n        options = options || {};\n        options.state = 'active';//the item widget never sleeps ! <- this sounds very scary!\n        options.renderer = this;\n\n        return Widget.build(\n            item,\n            $itemContainer,\n            this.getOption('itemOptionForm'),\n            options\n        );\n    };\n\n    return CreatorItem;\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 (original work) Open Assessment Technologies SA ;\n *\n */\ndefine('taoMediaManager/qtiCreator/widgets/static/object/states/Active',[\n    'lodash',\n    'jquery',\n    'i18n',\n    'taoQtiItem/qtiCreator/widgets/states/factory',\n    'taoQtiItem/qtiCreator/widgets/static/states/Active',\n    'tpl!taoQtiItem/qtiCreator/tpl/forms/static/object',\n    'taoQtiItem/qtiCreator/widgets/helpers/formElement',\n    'taoQtiItem/qtiCreator/widgets/static/helpers/inline',\n    'ui/mediaEditor/mediaEditorComponent',\n    'ui/previewer',\n    'ui/resourcemgr',\n    'ui/tooltip'\n], function (_, $, __, stateFactory, Active, formTpl, formElement, inlineHelper, mediaEditorComponent) {\n    'use strict';\n    /**\n     * media Editor instance if has been initialized\n     * @type {null}\n     */\n    let mediaEditor = null;\n    let $panelObjectSize = null;\n    let $panelMediaSize = null;\n\n    const _config = {\n        renderingThrottle: 1000,\n        fileFilters:\n            'image/jpeg,image/png,image/gif,image/svg+xml,video/mp4,video/avi,video/ogv,video/mpeg,video/ogg,video/quicktime,video/webm,video/x-ms-wmv,video/x-flv,audio/mp3,audio/vnd.wav,audio/ogg,audio/vorbis,audio/webm,audio/mpeg,application/ogg,audio/aac,application/pdf'\n    };\n\n    const ObjectStateActive = stateFactory.extend(\n        Active,\n        function () {\n            this.initForm();\n        },\n        function () {\n            if (mediaEditor) {\n                mediaEditor.destroy();\n            }\n            mediaEditor = null;\n            $panelObjectSize = null;\n            $panelMediaSize = null;\n            this.widget.$original.off('playerready');\n            this.widget.$form.empty();\n        }\n    );\n\n    const refreshRendering = _.throttle(function refreshRendering(widget) {\n        const obj = widget.element;\n        const $container = widget.$original;\n        const previewOptions = {\n            url: obj.renderer.resolveUrl(obj.attr('data')),\n            mime: obj.attr('type')\n        };\n        if (obj.attr('height')) {\n            previewOptions.height = obj.attr('height');\n        }\n        if (obj.attr('width')) {\n            previewOptions.width = obj.attr('width');\n        }\n        if (previewOptions.url && previewOptions.mime) {\n            $container.previewer(previewOptions);\n        }\n    }, _config.renderingThrottle);\n\n    const setMediaSizeEditor = widget => {\n        const qtiObject = widget.element;\n        const type = qtiObject.attr('type');\n        if (/video/.test(type)) {\n            const $container = widget.$original;\n            const mediaplayer = $container.data('player');\n            let width = qtiObject.attr('width');\n            let height = qtiObject.attr('height');\n            if (!/%/.test(width)) {\n                // if we don't have % width we need calculate default % width\n                const originalSize = mediaplayer.getMediaOriginalSize();\n                if (!originalSize.width) {\n                    // video is not loaded yet\n                    return;\n                }\n                const containerWidth = $container.closest('.widget-textBlock').width();\n                // the default % and by that the size of the video is based on the original video size compared to the container size\n                if (!width) {\n                    width = Math.round(100 / (containerWidth / originalSize.width));\n                    height = 0;\n                } else if (height) {\n                    // for old format (px and height is set) the default % is calculated on rendered width and height\n                    const scaleHeight =\n                        (Math.max(height || 0, 200) - $container.find('.mediaplayer .controls').height()) /\n                        originalSize.height;\n                    const scaleWidth = Math.max(width || 0, 200) / originalSize.width;\n                    const scale = Math.min(scaleHeight, scaleWidth);\n                    width = Math.round(100 / (containerWidth / (scale * originalSize.width)));\n                    qtiObject.removeAttr('height');\n                    height = 0;\n                }\n            }\n            const onChange = _.debounce(nMedia => {\n                if (qtiObject.attr('width') !== `${nMedia['width']}%`) {\n                    const newWidth = `${Math.round(nMedia['width'])}%`;\n                    qtiObject.attr('width', newWidth);\n                    mediaplayer.resize(newWidth, 'auto');\n                }\n            }, 200);\n            if (mediaEditor) {\n                mediaEditor.destroy();\n            }\n            mediaEditor = mediaEditorComponent(\n                $panelMediaSize,\n                {\n                    $node: $container.find('.mediaplayer .media'),\n                    $container: $container,\n                    type: qtiObject.attr('type'),\n                    width,\n                    height,\n                    responsive: true\n                },\n                {\n                    mediaDimension: {\n                        active: true,\n                        showResponsiveToggle: false\n                    }\n                }\n            ).on('change', onChange);\n        }\n    };\n    const hideShowPanels = type => {\n        if (/video/.test(type)) {\n            $panelObjectSize.hide();\n            $panelMediaSize.show();\n        } else {\n            if (mediaEditor) {\n                mediaEditor.destroy();\n            }\n            $panelObjectSize.show();\n            $panelMediaSize.hide();\n        }\n    };\n    const _initUpload = function (widget) {\n        const $form = widget.$form,\n            options = widget.options,\n            qtiObject = widget.element,\n            $uploadTrigger = $form.find('[data-role=\"upload-trigger\"]'),\n            $src = $form.find('input[name=src]');\n\n        const _openResourceMgr = function _openResourceMgr() {\n            $uploadTrigger.resourcemgr({\n                title: __(\n                    'Please select a media file from the resource manager. You can add files from your computer with the button \"Add file(s)\".'\n                ),\n                appendContainer: options.mediaManager.appendContainer,\n                mediaSourcesUrl: options.mediaManager.mediaSourcesUrl,\n                browseUrl: options.mediaManager.browseUrl,\n                uploadUrl: options.mediaManager.uploadUrl,\n                deleteUrl: options.mediaManager.deleteUrl,\n                downloadUrl: options.mediaManager.downloadUrl,\n                fileExistsUrl: options.mediaManager.fileExistsUrl,\n                params: {\n                    uri: options.uri,\n                    lang: options.lang,\n                    filters: _config.fileFilters\n                },\n                pathParam: 'path',\n                path: options.mediaManager.path,\n                root: options.mediaManager.root,\n                select: function (e, files) {\n                    let file, type;\n                    if (files && files.length) {\n                        file = files[0].file;\n                        type = files[0].mime;\n                        qtiObject.attr('type', type);\n                        $src.val(file).trigger('change');\n                    }\n                },\n                open: function () {\n                    //hide tooltip if displayed\n                    if ($src.data('$tooltip')) {\n                        $src.blur().data('$tooltip').hide();\n                    }\n                },\n                close: function () {\n                    //triggers validation :\n                    $src.blur();\n                }\n            });\n        };\n\n        $uploadTrigger.on('click', _openResourceMgr);\n\n        //if empty, open file manager immediately\n        if (!$src.val()) {\n            _openResourceMgr();\n        }\n    };\n\n    ObjectStateActive.prototype.initForm = function initForm() {\n        const _widget = this.widget,\n            $form = _widget.$form,\n            qtiObject = _widget.element,\n            baseUrl = _widget.options.baseUrl;\n        const $container = _widget.$original;\n\n        $form.html(\n            formTpl({\n                baseUrl: baseUrl || '',\n                src: qtiObject.attr('data'),\n                alt: qtiObject.attr('alt'),\n                height: qtiObject.attr('height'),\n                width: qtiObject.attr('width')\n            })\n        );\n\n        //init resource manager\n        _initUpload(_widget);\n\n        //init standard ui widget\n        formElement.initWidget($form);\n\n        $panelObjectSize = $('.size-panel', $form);\n        $panelMediaSize = $('.media-size-panel', $form);\n        hideShowPanels(qtiObject.attr('type'));\n\n        $container.off('playerready').on('playerready', function () {\n            setMediaSizeEditor(_widget);\n        });\n\n        //init data change callbacks\n        formElement.setChangeCallbacks($form, qtiObject, {\n            src: function (object, value) {\n                if (value !== qtiObject.attr('data')) {\n                    qtiObject.attr('data', value);\n                    qtiObject.removeAttr('width');\n                    qtiObject.removeAttr('height');\n                    $form.find('input[name=width]').val('');\n                    $form.find('input[name=height]').val('');\n                    $container.removeData('ui.previewer');\n                    hideShowPanels(qtiObject.attr('type'));\n                    inlineHelper.togglePlaceholder(_widget);\n                    refreshRendering(_widget);\n                }\n            },\n            width: function (object, value) {\n                const val = parseInt(value, 10);\n                if (_.isNaN(val)) {\n                    qtiObject.removeAttr('width');\n                } else {\n                    qtiObject.attr('width', val);\n                }\n                refreshRendering(_widget);\n            },\n            height: function (object, value) {\n                const val = parseInt(value, 10);\n                if (_.isNaN(val)) {\n                    qtiObject.removeAttr('height');\n                } else {\n                    qtiObject.attr('height', val);\n                }\n                refreshRendering(_widget);\n            },\n            alt: function (qtiObjectAlt, value) {\n                qtiObjectAlt.attr('alt', value);\n            },\n            align: function (qtiObjectAlign, value) {\n                inlineHelper.positionFloat(_widget, value);\n            }\n        });\n    };\n\n    return ObjectStateActive;\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 (original work) Open Assessment Technologies SA ;\n *\n */\ndefine('taoMediaManager/qtiCreator/widgets/static/object/states/states',[\n    'taoQtiItem/qtiCreator/widgets/states/factory',\n    'taoQtiItem/qtiCreator/widgets/static/states/states',\n    'taoQtiItem/qtiCreator/widgets/static/object/states/Sleep',\n    'taoMediaManager/qtiCreator/widgets/static/object/states/Active'\n], function (factory, states) {\n    'use strict';\n\n    return factory.createBundle(states, arguments);\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 (original work) Open Assessment Technologies SA ;\n *\n */\ndefine('taoMediaManager/qtiCreator/widgets/static/object/Widget',[\n    'taoQtiItem/qtiCreator/widgets/static/Widget',\n    'taoMediaManager/qtiCreator/widgets/static/object/states/states',\n    'taoQtiItem/qtiCreator/widgets/static/helpers/widget',\n    'tpl!taoQtiItem/qtiCreator/tpl/toolbars/media',\n    'taoQtiItem/qtiCreator/widgets/static/helpers/inline'\n], function (Widget, states, helper, toolbarTpl, inlineHelper) {\n    'use strict';\n\n    const ObjectWidget = Widget.clone();\n\n    ObjectWidget.initCreator = function initCreator() {\n        this.registerStates(states);\n\n        Widget.initCreator.call(this);\n\n        inlineHelper.togglePlaceholder(this);\n    };\n\n    ObjectWidget.getRequiredOptions = function getRequiredOptions() {\n        return ['baseUrl', 'uri', 'lang', 'mediaManager'];\n    };\n\n    ObjectWidget.buildContainer = function buildContainer() {\n        helper.buildBlockContainer(this);\n\n        return this;\n    };\n\n    ObjectWidget.createToolbar = function createToolbar() {\n        helper.createToolbar(this, toolbarTpl);\n\n        return this;\n    };\n\n    return ObjectWidget;\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n */\n\ndefine('taoMediaManager/qtiCreator/renderers/Object',[\n    'lodash',\n    'taoQtiItem/qtiCommonRenderer/renderers/Object',\n    'taoMediaManager/qtiCreator/widgets/static/object/Widget'\n], function (_, Renderer, Widget) {\n    'use strict';\n\n    const CreatorObject = _.clone(Renderer);\n\n    CreatorObject.render = function render(object, options) {\n        //initial rendering:\n        Renderer.render(object);\n\n        options = options || {};\n        options.baseUrl = this.getOption('baseUrl');\n        options.uri = this.getOption('uri');\n        options.lang = this.getOption('lang');\n        options.mediaManager = this.getOption('mediaManager');\n        options.assetManager = this.getAssetManager();\n\n        Widget.build(object, Renderer.getContainer(object), this.getOption('bodyElementOptionForm'), options);\n    };\n\n    return CreatorObject;\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2017-2022 (original work) Open Assessment Technologies SA ;\n *\n */\n/**\n * @author Christophe Noël <christophe@taotesting.com>\n */\ndefine('taoMediaManager/qtiCreator/widgets/static/table/states/Active',[\n    'lodash',\n    'jquery',\n    'i18n',\n    'ckeditor',\n    'ui/tableModel',\n    'taoQtiItem/qtiCreator/widgets/states/factory',\n    'taoMediaManager/qtiCreator/widgets/static/states/Active',\n    'taoQtiItem/qtiCreator/widgets/static/table/components/tableActions',\n    'taoMediaManager/qtiCreator/editor/ckEditor/htmlEditor',\n    'taoQtiItem/qtiCreator/editor/gridEditor/content',\n    'taoQtiItem/qtiCreator/widgets/helpers/formElement',\n    'tpl!taoQtiItem/qtiCreator/tpl/forms/static/table'\n], function (\n    _,\n    $,\n    __,\n    ckEditor,\n    tableModelFactory,\n    stateFactory,\n    Active,\n    tableActionsFactory,\n    htmlEditor,\n    contentHelper,\n    formElement,\n    formTpl\n) {\n    'use strict';\n\n    let tableModel, colActions, rowActions;\n\n    const css = {\n        deleteColRow: 'hoverDelete',\n        insertRowAfter: 'insertRowAfter',\n        insertColAfter: 'insertColAfter',\n\n        hAlignCenter: 'table-center',\n        hAlignRight: 'table-right'\n    };\n\n    const TableStateActive = stateFactory.extend(\n        Active,\n        function create() {\n            this.initForm();\n            this.buildEditor();\n        },\n        function exit() {\n            this.widget.$form.empty();\n            this.destroyEditor();\n        }\n    );\n\n    // the element body should only contain the <table> tag content, and not the <table> tag itself.\n    // as the ckeditor instance is bound to a wrapping <div>, we need to go through an extra step to remove the <table> tag.\n    function getChangeCallback(container) {\n        return _.throttle(function (data) {\n            const $tableTagContent = $(data).children(), // might a mix of tbody / thead / tfoot\n                $pseudoContainer = $('<div>').html($tableTagContent),\n                newBody = contentHelper.getContent($pseudoContainer);\n            container.body(newBody);\n        }, 400);\n    }\n\n    TableStateActive.prototype.initForm = function initForm() {\n        const _widget = this.widget,\n            $form = _widget.$form,\n            table = _widget.element,\n            $container = _widget.$container;\n\n        const hAlignOptions = [\n            {\n                name: __('Left'),\n                value: 'left'\n            },\n            {\n                name: __('Center'),\n                value: 'center',\n                selected: table.hasClass(css.hAlignCenter)\n            },\n            {\n                name: __('Right'),\n                value: 'right',\n                selected: table.hasClass(css.hAlignRight)\n            }\n        ];\n\n        $form.html(\n            formTpl({\n                hAlignOptions: hAlignOptions\n            })\n        );\n\n        //... init standard ui widget\n        formElement.initWidget($form);\n\n        //init data change callbacks\n        formElement.setChangeCallbacks($form, table, {\n            hAlign: function (t, value) {\n                hideTableActions();\n                t.removeClass(css.hAlignRight);\n                t.removeClass(css.hAlignCenter);\n                $container.removeClass(`${css.hAlignRight} ${css.hAlignCenter}`);\n                switch (value) {\n                    case 'center': {\n                        t.addClass(css.hAlignCenter);\n                        $container.addClass(css.hAlignCenter);\n                        break;\n                    }\n                    case 'right': {\n                        t.addClass(css.hAlignRight);\n                        $container.addClass(css.hAlignRight);\n                        break;\n                    }\n                }\n            }\n        });\n    };\n\n    TableStateActive.prototype.buildEditor = function buildEditor() {\n        const _widget = this.widget,\n            container = _widget.element.getBody(),\n            $itemPanel = _widget.getAreaBroker().getItemPanelArea(),\n            $editableContainer = _widget.$container,\n            $editable = $editableContainer.find('.qti-table-container'),\n            $tablePropTrigger = $editableContainer.find('[data-role=\"cke-table-properties\"]');\n        const areaBroker = _widget && _widget.getAreaBroker && _widget.getAreaBroker(),\n            $toolbarArea = areaBroker && areaBroker.getToolbarArea && areaBroker.getToolbarArea();\n\n        $editableContainer.attr('data-html-editable-container', true);\n        $editable.attr('data-html-editable', true); // DO NOT move in template to avoid creation of nested ckInstances when container editor is created\n\n        if (!htmlEditor.hasEditor($editableContainer)) {\n            htmlEditor.buildEditor($editableContainer, {\n                placeholder: '',\n                change: getChangeCallback(container),\n                removePlugins: 'magicline',\n                data: {\n                    container: container,\n                    widget: _widget\n                },\n                blur: function () {\n                    _widget.changeState('sleep');\n                }\n            });\n        }\n\n        $editable\n            .on('editorready.tableActive', function (event, editor) {\n                tableModel = tableModelFactory($editable.find('table'));\n\n                // listener for table properties\n                $tablePropTrigger.on('click.tableActive', function openTableProperties(e) {\n                    e.stopPropagation();\n                    hideTableActions();\n                    editor.execCommand('taoqtitableProperties');\n                });\n\n                // listeners for columns actions\n                colActions = tableActionsFactory({\n                    insertCol: true,\n                    deleteTitle: 'Delete column'\n                })\n                    .on('delete', function () {\n                        editor.execCommand('columnDelete');\n                        updateTable(editor, $editableContainer);\n                        hideTableActions();\n                    })\n                    .on('deleteMouseEnter', function () {\n                        addClassOnCurrentCol(editor, css.deleteColRow);\n                    })\n                    .on('deleteMouseLeave', function () {\n                        clearCellClasses($editable, css.deleteColRow);\n                    })\n                    .on('insertCol', function () {\n                        editor.execCommand('columnInsertAfter');\n                        clearCellClasses($editable, css.insertColAfter); // this is because ck clone the current cells to insert the new ones\n                        this.trigger('insertColMouseEnter'); // so we don't want him to clone the \"insert style\"\n                        updateTable(editor, $editableContainer);\n                    })\n                    .on('insertColMouseEnter', function () {\n                        addClassOnCurrentCol(editor, css.insertColAfter);\n                    })\n                    .on('insertColMouseLeave', function () {\n                        clearCellClasses($editable, css.insertColAfter);\n                    })\n                    .render($itemPanel);\n\n                // listeners for row actions\n                rowActions = tableActionsFactory({\n                    insertRow: true,\n                    deleteTitle: 'Delete row'\n                })\n                    .on('delete', function () {\n                        editor.execCommand('rowDelete');\n                        updateTable(editor, $editableContainer);\n                        hideTableActions();\n                    })\n                    .on('deleteMouseEnter', function () {\n                        addClassOnCurrentRow(editor, css.deleteColRow);\n                    })\n                    .on('deleteMouseLeave', function () {\n                        clearCellClasses($editable, css.deleteColRow);\n                    })\n                    .on('insertRow', function () {\n                        editor.execCommand('rowInsertAfter');\n                        clearCellClasses($editable, css.insertRowAfter); // this is because ck clone the current cells to insert the new ones\n                        this.trigger('insertRowMouseEnter'); // so we don't want him to clone the \"insert style\"\n                        updateTable(editor, $editableContainer);\n                    })\n                    .on('insertRowMouseEnter', function () {\n                        addClassOnCurrentRow(editor, css.insertRowAfter);\n                    })\n                    .on('insertRowMouseLeave', function () {\n                        clearCellClasses($editable, css.insertRowAfter);\n                    })\n                    .render($itemPanel);\n\n                // When the table is clicked,\n                // Set focus at the end of the last cell\n                // and show the table, column, and row toolbars\n                displayTableActions(editor, $editableContainer);\n\n                $editableContainer.on('keyup.tableActive mouseup.tableActive', function () {\n                    displayTableActions(editor, $editableContainer);\n                    const currentSelection = getSelection(editor);\n                    const $toolbars = $toolbarArea.find('.cke_toolbar');\n                    // According 'ui/ckeditor/ckConfigurator' for table 2nd toolbar is Insert\n                    // and 3rd is Links\n                    // for multiselection they shouldd be hidden\n                    if (currentSelection.length > 1) {\n                        $toolbars.eq(1).hide();\n                        $toolbars.eq(2).hide();\n                    } else {\n                        $toolbars.eq(1).show();\n                        $toolbars.eq(2).show();\n                    }\n                });\n            })\n            .on('editordestroyed.tableActive', function () {\n                if ($tablePropTrigger.length) {\n                    $tablePropTrigger.off('.tableActive');\n                }\n            });\n    };\n\n    TableStateActive.prototype.destroyEditor = function destroyEditor() {\n        const _widget = this.widget,\n            $editableContainer = _widget.$container,\n            $editable = $editableContainer.find('[data-html-editable=\"true\"]');\n\n        clearCellClasses($editable, css.insertColAfter);\n        clearCellClasses($editable, css.insertRowAfter);\n        clearCellClasses($editable, css.deleteColRow);\n\n        //search and destroy the editor\n        htmlEditor.destroyEditor($editableContainer);\n        $editableContainer.off('.tableActive');\n        $editable.off('.tableActive');\n\n        $editable.attr('data-html-editable', false);\n        $editableContainer.attr('data-html-editable-container', false);\n\n        tableModel = null;\n\n        // destroy the actions toolbars\n        if (colActions) {\n            colActions.destroy();\n            colActions = null;\n        }\n\n        if (rowActions) {\n            rowActions.destroy();\n            rowActions = null;\n        }\n    };\n\n    function addClassOnCurrentRow(editor, className) {\n        const currentCellPos = getCurrentCellPos(editor);\n        if (currentCellPos) {\n            const $currentCol = tableModel.getRowCells(currentCellPos.y);\n            $currentCol.addClass(className);\n        }\n    }\n\n    function addClassOnCurrentCol(editor, className) {\n        const currentCellPos = getCurrentCellPos(editor);\n        if (currentCellPos) {\n            const $currentCol = tableModel.getColCells(currentCellPos.x);\n            $currentCol.addClass(className);\n        }\n    }\n\n    function clearCellClasses($editable, className) {\n        $editable.find('th, td').removeClass(className);\n    }\n\n    /**\n     * Update the table model and the available actions on rows/columns\n     * @param {Object} editor\n     * @param {JQueryElement} $editableContainer\n     */\n    function updateTable(editor, $editableContainer) {\n        tableModel.update();\n        if (tableModel.getRowCount() === 1) {\n            rowActions.hideDelete();\n        } else {\n            rowActions.showDelete();\n        }\n        if (tableModel.getColCount() === 1) {\n            colActions.hideDelete();\n        } else {\n            colActions.showDelete();\n        }\n        // reposition toolbars as their dimensions might have change\n        displayTableActions(editor, $editableContainer);\n    }\n\n    /**\n     * hide components containing row and column actions\n     */\n    function hideTableActions() {\n        if (colActions) {\n            colActions.hide();\n        }\n        if (rowActions) {\n            rowActions.hide();\n        }\n    }\n\n    /**\n     * Display row and columns actions at the correct position, depending of where the user has the cursor\n     * @param {ckEditor} editor - editor instance to access the current selection\n     * @param {jQuery} $tableContainer - the table DOM element, so we can align the toolbars on it\n     */\n    function displayTableActions(editor, $tableContainer) {\n        const selectedCells = getSelection(editor);\n\n        if (selectedCells && selectedCells.length !== 1) {\n            // when none or more than one cells are selected, then we do not display the toolbars as the expected behavior is not obvious.\n            // for example, it's difficult to define the expected behavior of deleting a column when cells from multiple columns are selected...\n            hideTableActions();\n        } else {\n            const $currentCell = $(selectedCells[0].$);\n\n            colActions.show().hAlignWith($currentCell, 'center').vAlignWith($tableContainer, 'top');\n\n            rowActions.show().hAlignWith($tableContainer, 'left').vAlignWith($currentCell, 'center');\n        }\n    }\n\n    /**\n     * only works when a single cell is selected\n     * @param {Object} editor\n     * @returns {Object} x,y cell position\n     */\n    function getCurrentCellPos(editor) {\n        const selectedCells = getSelection(editor);\n\n        if (selectedCells && selectedCells.length === 1) {\n            const currentCell = selectedCells[0].$;\n\n            return {\n                x: currentCell.cellIndex,\n                y: currentCell.parentNode.rowIndex\n            };\n        }\n    }\n\n    /**\n     * Get the current selected cells in the table\n     * @param {Object} editor - CkEditor instance\n     * @returns {ckEditor.dom.element[]}\n     */\n    function getSelection(editor) {\n        const selection = editor.getSelection(),\n            tabletools = window.CKEDITOR.plugins.tabletools;\n\n        if (selection && tabletools) {\n            return tabletools.getSelectedCells(selection);\n        }\n    }\n\n    return TableStateActive;\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA ;\n *\n */\ndefine('taoMediaManager/qtiCreator/widgets/static/table/states/states',[\n    'taoQtiItem/qtiCreator/widgets/states/factory',\n    'taoQtiItem/qtiCreator/widgets/static/states/states',\n    'taoQtiItem/qtiCreator/widgets/static/table/states/Sleep',\n    'taoMediaManager/qtiCreator/widgets/static/table/states/Active'\n], function(factory, states){\n    'use strict';\n\n    return factory.createBundle(states, arguments);\n});\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA;\n */\n/**\n * @author Christophe Noël <christophe@taotesting.com>\n */\ndefine('taoMediaManager/qtiCreator/widgets/static/table/Widget',[\n    'jquery',\n    'taoQtiItem/qtiCreator/widgets/static/Widget',\n    'taoMediaManager/qtiCreator/widgets/static/table/states/states',\n    'taoQtiItem/qtiCreator/widgets/static/helpers/widget',\n    'tpl!taoQtiItem/qtiCreator/tpl/toolbars/table'\n], function($, Widget, states, helper, toolbarTpl) {\n    'use strict';\n\n    var TableWidget = Widget.clone();\n\n    TableWidget.initCreator = function() {\n\n        this.registerStates(states);\n\n        Widget.initCreator.call(this);\n    };\n\n    TableWidget.buildContainer = function(){\n        var table = this.element;\n\n        helper.buildBlockContainer(this);\n\n        if (table.attr('class')) {\n            this.$container.addClass(table.attr('class'));\n        }\n\n        return this;\n    };\n\n    TableWidget.createToolbar = function(){\n\n        const self = this,\n            $tlb = $(toolbarTpl({\n                serial : this.serial,\n                state : 'active'\n            }));\n\n        this.$container.append($tlb);\n\n        $tlb.find('[data-role=\"delete\"]').on('click.widget-box', function(e){\n            e.stopPropagation();//to prevent direct deleting;\n            self.changeState('deleting');\n        });\n\n        return this;\n    };\n\n    return TableWidget;\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 (original work) Open Assessment Technologies SA;\n */\n/**\n * @author Christophe Noël <christophe@taotesting.com>\n */\ndefine('taoMediaManager/qtiCreator/renderers/Table',[\n    'lodash',\n    'taoQtiItem/qtiCommonRenderer/renderers/Table',\n    'taoMediaManager/qtiCreator/widgets/static/table/Widget',\n    'tpl!taoQtiItem/qtiCreator/tpl/table'\n], function(_, Renderer, Widget, tpl) {\n    'use strict';\n\n    const CreatorTable = _.clone(Renderer);\n\n    CreatorTable.template = tpl;\n\n    CreatorTable.render = function render(table, options){\n\n        Widget.build(\n            table,\n            Renderer.getContainer(table),\n            this.getOption('bodyElementOptionForm'),\n            options || {}\n        );\n    };\n\n    return CreatorTable;\n});\n\n","\ndefine('tpl!taoMediaManager/qtiXmlRenderer/tpl/item', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, functionType=\"function\", escapeExpression=this.escapeExpression, self=this, helperMissing=helpers.helperMissing;\n\nfunction program1(depth0,data) {\n  \n  var buffer = \"\", stack1;\n  stack1 = helpers['if'].call(depth0, (data == null || data === false ? data : data.key), {hash:{},inverse:self.program(4, program4, data),fn:self.program(2, program2, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \" \";\n  return buffer;\n  }\nfunction program2(depth0,data) {\n  \n  var buffer = \"\", stack1;\n  buffer += \"xmlns:\"\n    + escapeExpression(((stack1 = (data == null || data === false ? data : data.key)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1))\n    + \"=\\\"\"\n    + escapeExpression((typeof depth0 === functionType ? depth0.apply(depth0) : depth0))\n    + \"\\\"\";\n  return buffer;\n  }\n\nfunction program4(depth0,data) {\n  \n  var buffer = \"\";\n  buffer += \"xmlns=\\\"\"\n    + escapeExpression((typeof depth0 === functionType ? depth0.apply(depth0) : depth0))\n    + \"\\\"\";\n  return buffer;\n  }\n\nfunction program6(depth0,data) {\n  \n  var stack1, helper, options;\n  stack1 = (helper = helpers.join || (depth0 && depth0.join),options={hash:{},data:data},helper ? helper.call(depth0, (depth0 && depth0.attributes), \"=\", \" \", \"\\\"\", options) : helperMissing.call(depth0, \"join\", (depth0 && depth0.attributes), \"=\", \" \", \"\\\"\", options));\n  if(stack1 || stack1 === 0) { return stack1; }\n  else { return ''; }\n  }\n\nfunction program8(depth0,data) {\n  \n  \n  return \"\\n        <div class=\\\"empty\\\"></div>\\n    \";\n  }\n\nfunction program10(depth0,data) {\n  \n  var buffer = \"\", stack1, helper;\n  buffer += \"\\n        \";\n  if (helper = helpers.body) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.body); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n    \";\n  return buffer;\n  }\n\n  buffer += \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\n<div\\n    \";\n  stack1 = helpers.each.call(depth0, (depth0 && depth0.namespaces), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n    \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.attributes), {hash:{},inverse:self.noop,fn:self.program(6, program6, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \">\\n    \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.empty), {hash:{},inverse:self.program(10, program10, data),fn:self.program(8, program8, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n</div>\";\n  return buffer;\n  });\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 (original work) Open Assessment Technologies SA;\n *\n */\n\ndefine('taoMediaManager/qtiXmlRenderer/renderers/Item',['lodash', 'tpl!taoMediaManager/qtiXmlRenderer/tpl/item'], function(_, tpl){\n    'use strict';\n\n    return {\n        qtiClass : 'assessmentItem',\n        template : tpl,\n        getData : function getData(item, data){\n            const defaultData = {\n                'class' : data.attributes.class || '',\n                namespaces : item.getNamespaces(),\n                schemaLocations : '',\n                xsi: 'xsi:',//the standard namespace prefix for xml schema\n                empty : item.isEmpty(),\n            };\n\n            _.forIn(item.getSchemaLocations(), (url, uri) => {\n                defaultData.schemaLocations += `${uri} ${url} `;\n            });\n            defaultData.schemaLocations = defaultData.schemaLocations.trim();\n\n            data = _.merge({}, data, defaultData);\n            delete data.attributes.title;\n            delete data.attributes.adaptive;\n            delete data.attributes.timeDependent;\n            delete data.attributes.identifier;\n\n            data.attributes = _.mapValues(data.attributes, function (val) {\n                return _.isString(val) ? _.escape(val) : val;\n            });\n\n            return data;\n        }\n    };\n});\n\n","\n(function(c){var d=document,a='appendChild',i='styleSheet',s=d.createElement('style');s.type='text/css';d.getElementsByTagName('head')[0][a](s);s[i]?s[i].cssText=c:s[a](d.createTextNode(c));})\n('.previewer{position:relative}.previewer iframe{min-height:400px;width:100%}.previewer .previewer-component{background-color:white;text-align:initial}.previewer .previewer-component .item-previewer-scope{height:calc(100vh - 250px)}.previewer .previewer-component .item-previewer-scope .action-bar,.previewer .previewer-component .item-previewer-scope .test-sidebar{display:none}.previewer.no-background{background:none}#item-editor-scope .left-bar .tool-group ._accordion{display:none}#item-editor-scope .focus-border{box-shadow:1px 1px 3px 2px #3e7da7}#item-editor-scope .qti-itemBody.item-editor-drop-area{margin-top:0}#item-editor-scope .qti-item{padding:20px}#item-editor-scope .item-editor-sidebar #item-editor-font-size-changer .icon-smaller,#item-editor-scope .item-editor-sidebar #item-editor-font-size-changer .icon-larger{background:none;color:black;height:21px;width:20px}#item-editor-scope .item-editor-sidebar #item-editor-font-size-changer .icon-smaller{margin-left:30px}#item-editor-scope .item-editor-sidebar #item-editor-font-size-changer .icon-smaller:before{font-size:1.2rem}#item-editor-scope .item-editor-sidebar #item-editor-font-size-changer .icon-larger:before{font-size:1.8rem}#item-editor-scope .item-editor-sidebar .item-editor-color-picker .color-trigger{background:none}#item-editor-scope .item-editor-sidebar .item-editor-color-picker .reset-button{top:0}#item-editor-scope .item-editor-sidebar .reset-group .reset-button{background:none;color:black}div.item-editor-item{border-color:transparent}\\n\\n/*# sourceMappingURL=../../../taoMediaManager/views/css/media.css.map */');\n","\ndefine(\"taoMediaManager/loader/taoMediaManager.bundle\", function(){});\n","define(\"taoMediaManager/loader/taoMediaManager.min\", [\"taoItems/loader/taoItemsRunner.min\",\"taoTests/loader/taoTestsRunner.min\",\"taoQtiItem/loader/taoQtiItemRunner.min\",\"taoQtiItem/loader/taoQtiItem.min\",\"taoQtiTestPreviewer/loader/qtiPreviewer.min\"], function(){});\n"]}