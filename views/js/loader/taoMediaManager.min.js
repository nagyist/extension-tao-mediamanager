function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("tpl!taoMediaManager/qtiCreator/tpl/relatedItemsPopup",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+="<li>"+escapeExpression((stack1=depth0&&depth0.label,"function"===_typeof(stack1)?stack1.apply(depth0):stack1))+"</li>",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return(helper=helpers.inUsageMessage)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.inUsageMessage,stack1="function"===_typeof(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\n<ul>\n",stack1=helpers.each.call(depth0,depth0&&depth0.items,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</ul>\n",(helper=helpers.confirmationMessage)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.confirmationMessage,stack1="function"===_typeof(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1),buffer})}),define("tpl!taoMediaManager/qtiCreator/tpl/relatedItemsClassPopup",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function";return buffer+="<b>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Warning",options):helperMissing.call(depth0,"__","Warning",options)))+"</b><br><br>\n"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"You are about to delete the class",options):helperMissing.call(depth0,"__","You are about to delete the class",options)))+" <b>",(helper=helpers.name)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.name,stack1="function"===_typeof(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</b>, "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"which contains assets that are in use elsewhere.",options):helperMissing.call(depth0,"__","which contains assets that are in use elsewhere.",options)))+"\n"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Deleting this class will break the items and the tests that are currently using them.",options):helperMissing.call(depth0,"__","Deleting this class will break the items and the tests that are currently using them.",options)))+"<br><br>\n"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Are you sure you want to delete this class and all of its content?",options):helperMissing.call(depth0,"__","Are you sure you want to delete this class and all of its content?",options))),buffer})}),define("tpl!taoMediaManager/qtiCreator/tpl/forbiddenClassAction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function";return buffer+="<b>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Forbidden action",options):helperMissing.call(depth0,"__","Forbidden action",options)))+"</b><br><br>\n"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The class",options):helperMissing.call(depth0,"__","The class",options)))+" <b>",(helper=helpers.name)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.name,stack1="function"===_typeof(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</b> "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"you are trying to delete is too large and contains too many subclasses.",options):helperMissing.call(depth0,"__","you are trying to delete is too large and contains too many subclasses.",options)))+"<br>\n"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Please delete the subclasses before.",options):helperMissing.call(depth0,"__","Please delete the subclasses before.",options))),buffer})}),define("css!taoMediaManagerCss/media",[],function(){}),define("taoMediaManager/controller/actions",["lodash","jquery","i18n","layout/actions/binder","uri","layout/section","core/request","core/router","core/logger","ui/feedback","ui/dialog/confirm","ui/dialog/alert","util/url","tpl!taoMediaManager/qtiCreator/tpl/relatedItemsPopup","tpl!taoMediaManager/qtiCreator/tpl/relatedItemsClassPopup","tpl!taoMediaManager/qtiCreator/tpl/forbiddenClassAction","css!taoMediaManagerCss/media.css"],function(_,$,__,binder,uri,section,request,router,loggerFactory,feedback,confirmDialog,alertDialog,urlUtil,relatedItemsPopupTpl,relatedItemsClassPopupTpl,forbiddenClassActionTpl){"use strict";function callConfirmModal(actionContext,message,url,data,resolve,reject){confirmDialog(message,function(){return accept(actionContext,url,data,resolve,reject)},function(){return cancel(reject)})}function callAlertModal(actionContext,message,reject){alertDialog(message,function(){return cancel(reject)})}function accept(actionContext,url,data,resolve,reject){return request({url:url,method:"POST",data:data,dataType:"json"}).then(function(response){return response.success&&response.deleted?(feedback().success(response.message||__("Resource deleted")),actionContext.tree&&$(actionContext.tree).trigger("removenode.taotree",[{id:actionContext.uri||actionContext.classUri}]),resolve({uri:actionContext.uri||actionContext.classUri})):void(response.success&&!response.deleted&&($(actionContext.tree).trigger("refresh.taotree"),reject(response.msg||response.message||__("Unable to delete the selected resource because you do not have the required rights to delete part of its content."))),reject(response.msg||response.message||__("Unable to delete the selected resource")))})}function cancel(reject){reject({cancel:!0})}var logger=loggerFactory("taoMediaManager/manageMedia");binder.register("newSharedStimulus",function instanciate(actionContext){var self=this,classUri=uri.decode(actionContext.classUri);return request({url:self.url,data:JSON.stringify({classUri:classUri}),method:"POST"}).then(function(response){return actionContext.tree&&$(actionContext.tree).trigger("addnode.taotree",[{uri:uri.decode(response.data.id),label:response.data.name,parent:uri.decode(actionContext.classUri),cssClass:"node-instance"}]),{uri:uri.decode(response.data.id),label:response.data.name,classUri:uri.decode(actionContext.classUri),type:"instance"}}).catch(function(err){_.isUndefined(err.message)||feedback().error(err.message),logger.error(err)})}),binder.register("sharedStimulusAuthoring",function sharedStimulusAuthoring(actionContext){section.updateContentBlock("").create({id:"authoring",name:__("Authoring"),url:this.url,content:" ",visible:!1}).show();var $panel=$("#panel-authoring");$panel.attr("data-id",actionContext.id),$panel.attr("data-uri",actionContext.uri),router.dispatch("".concat(this.url,"?id=").concat(actionContext.id))}),binder.register("deleteSharedStimulus",function remove(actionContext){var self=this,data={},mediaRelationsData={type:"media"};return"instance"===actionContext.context[0]?mediaRelationsData.sourceId=actionContext.id:mediaRelationsData.classId=actionContext.id,data.uri=uri.decode(actionContext.uri),data.classUri=uri.decode(actionContext.classUri),data.id=actionContext.id,data.signature=actionContext.signature,new Promise(function(resolve,reject){request({url:urlUtil.route("index","ResourceRelations","tao"),data:mediaRelationsData,method:"GET",noToken:!0}).then(function(responseRelated){var message,haveItemReferences=responseRelated.data.relations,name=$("a.clicked",actionContext.tree).text().trim();"instance"===actionContext.context[0]?0===haveItemReferences.length?message="".concat(__("Are you sure you want to delete this")," <b>").concat(name,"</b>?"):message=relatedItemsPopupTpl({name:name,inUsageMessage:__("This \"%s\" is currently used in %d item(s)",name,haveItemReferences.length),confirmationMessage:__("Are you sure you want to delete this \"%s\"?",name),items:haveItemReferences}):"instance"!==actionContext.context[0]&&(0===haveItemReferences.length?message="".concat(__("Are you sure you want to delete this class and all of its content?")):0!==haveItemReferences.length&&(message=relatedItemsClassPopupTpl({name:name,number:haveItemReferences.length,items:haveItemReferences}))),callConfirmModal(actionContext,message,self.url,data,resolve,reject)}).catch(function(errorObject){var message;"class"===actionContext.context[0]&&999===errorObject.response.code&&(message=forbiddenClassActionTpl()),callAlertModal(actionContext,message,reject)})})})}),define("taoMediaManager/qtiCreator/helper/createDummyItemData",["taoQtiItem/qtiCreator/model/Item"],function(Item){"use strict";var _generateIdentifier=function _generateIdentifier(uri){var pos=uri.lastIndexOf("#");return uri.substr(pos+1)},creatorDummyItemData=function creatorDummyItemData(sharedStimulusData){var newItem=new Item().id(_generateIdentifier(sharedStimulusData.id)).attr("title",sharedStimulusData.name);newItem.data("new",!0),newItem.data("dummy",!0);var itemData=Object.assign({},newItem);return delete itemData.bdy,delete itemData.rootElement,itemData.body=sharedStimulusData.body.body,itemData.qtiClass="assessmentItem",itemData.responseProcessing={attributes:{},qtiClass:"responseProcessing",responseRules:[],serial:"response_".concat(sharedStimulusData.body.serial)},itemData.response={},sharedStimulusData.body.attributes["xml:lang"]&&(itemData.attributes["xml:lang"]=sharedStimulusData.body.attributes["xml:lang"]),sharedStimulusData.body.attributes.class&&(itemData.attributes.class=sharedStimulusData.body.attributes.class),itemData};return creatorDummyItemData}),define("taoMediaManager/qtiCreator/helper/sharedStimulusLoader",["jquery","taoQtiItem/qtiItem/core/Loader","taoQtiItem/qtiCreator/model/qtiClasses","taoMediaManager/qtiCreator/helper/createDummyItemData","core/dataProvider/request","util/url"],function($,Loader,qtiClasses,creatorDummyItemData,request,urlUtil){"use strict";var qtiNamespace="http://www.imsglobal.org/xsd/imsqti_v2p2",qtiSchemaLocation={"http://www.imsglobal.org/xsd/imsqti_v2p2":"http://www.imsglobal.org/xsd/qti/qtiv2p2/imsqti_v2p2.xsd"},languagesUrl=urlUtil.route("index","Languages","tao"),creatorLoader={loadSharedStimulus:function loadSharedStimulus(config,callback){if(config.id){var languagesList=request(languagesUrl),assetData=request(config.assetDataUrl,{id:config.id});Promise.all([languagesList,assetData]).then(function(values){var loader,itemData;itemData=creatorDummyItemData(values[1]),loader=new Loader().setClassesLocation(qtiClasses),loader.loadItemData(itemData,function(loadedItem){var namespaces;namespaces=loadedItem.getNamespaces(),namespaces[""]="http://www.imsglobal.org/xsd/imsqti_v2p2",loadedItem.setNamespaces(namespaces),loadedItem.setSchemaLocations(qtiSchemaLocation),languagesList&&loadedItem.data("languagesList",values[0]),callback(loadedItem,this.getLoadedClasses())})})}}};return creatorLoader}),define("taoMediaManager/qtiCreator/renderers/config",["lodash","taoQtiItem/qtiCommonRenderer/renderers/config","taoItems/assets/manager","taoItems/assets/strategies"],function(_,commonRenderConfig,assetManagerFactory,assetStrategies){"use strict";var assetManager=assetManagerFactory([assetStrategies.taomedia,assetStrategies.external,assetStrategies.base64,assetStrategies.baseUrl],{baseUrl:""}),locations=_.defaults({_container:"taoQtiItem/qtiCreator/renderers/Container",_tooltip:"taoQtiItem/qtiCreator/renderers/Tooltip",assessmentItem:"taoMediaManager/qtiCreator/renderers/Item",figure:"taoMediaManager/qtiCreator/renderers/Figure",img:"taoMediaManager/qtiCreator/renderers/Img",figcaption:"taoMediaManager/qtiCreator/renderers/Figcaption",math:"taoQtiItem/qtiCreator/renderers/Math",object:"taoMediaManager/qtiCreator/renderers/Object",table:"taoMediaManager/qtiCreator/renderers/Table"},commonRenderConfig.locations);return{name:"creatorRenderer",locations:locations,options:{assetManager:assetManager}}}),define("taoMediaManager/qtiCreator/renderers/Renderer",["taoQtiItem/qtiRunner/core/Renderer","taoMediaManager/qtiCreator/renderers/config"],function(Renderer,config){"use strict";return Renderer.build(config.locations,config.name,config.options)}),define("taoMediaManager/qtiCreator/helper/creatorRenderer",["jquery","lodash","taoMediaManager/qtiCreator/renderers/Renderer","taoItems/assets/manager","taoItems/assets/strategies","util/dom"],function($,_,Renderer,assetManagerFactory,assetStrategies,dom){"use strict";var creatorRenderer=null,get=function get(reset,config,areaBroker){var $bodyEltForm;return config=config||{},config.properties=config.properties||{},(!creatorRenderer||reset)&&($bodyEltForm=creatorRenderer?creatorRenderer.getOption("bodyElementOptionForm"):null,(reset||!$bodyEltForm||!$bodyEltForm.length||!dom.contains($bodyEltForm))&&(creatorRenderer=new Renderer({lang:"",uri:"",shuffleChoices:!1,itemOptionForm:$("#item-editor-item-property-bar #sidebar-right-passage-properties .panel"),bodyElementOptionForm:areaBroker.getElementPropertyPanelArea(),textOptionForm:$("#item-editor-text-property-bar #sidebar-right-text-block-properties .panel"),mediaManager:{appendContainer:"#mediaManager",browseUrl:config.properties.getFilesUrl,uploadUrl:config.properties.fileUploadUrl,deleteUrl:config.properties.fileDeleteUrl,downloadUrl:config.properties.fileDownloadUrl,fileExistsUrl:config.properties.fileExistsUrl,path:config.properties.path,root:config.properties.root},qtiCreatorContext:config.qtiCreatorContext,locations:config.properties.locations}),creatorRenderer.getAssetManager().setData({baseUrl:config.properties.baseUrl||""}),creatorRenderer.setAreaBroker(areaBroker),_.assign(creatorRenderer,{getCreatorContext:function getCreatorContext(){return this.getOption("qtiCreatorContext")}}))),creatorRenderer};return{get:get,setOption:function setOption(name,value){return get().setOption(name,value)},setOptions:function setOptions(options){return get().setOptions(options)},load:function load(qtiClasses,done){return get().load(function(){if(_.isFunction(done)){for(var _len=arguments.length,rest=Array(_len),_key=0;_key<_len;_key++)rest[_key]=arguments[_key];done.apply(this,rest)}},qtiClasses)}}}),define("tpl!taoMediaManager/qtiCreator/tpl/toolbars/cssToggler",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+="<li data-css-res=\"",(helper=helpers.path)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.path,stack1="function"===_typeof(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    <span class=\"icon-preview style-sheet-toggler\" title=\"",(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1="function"===_typeof(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"></span>\n    <span class=\"file-label truncate\" title=\"",(helper=helpers.editLabelTxt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.editLabelTxt,stack1="function"===_typeof(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1="function"===_typeof(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n    <input type=\"text\" class=\"style-sheet-label-editor\" value=\"",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1="function"===_typeof(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    <span class=\"icon-bin\" title=\"",(helper=helpers.deleteTxt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.deleteTxt,stack1="function"===_typeof(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-role=\"css-delete\"></span>\n    <span class=\"icon-download\" title=\"",(helper=helpers.downloadTxt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.downloadTxt,stack1="function"===_typeof(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-role=\"css-download\"></span>\n</li>",buffer})}),define("taoMediaManager/qtiCreator/editor/styleEditor/styleEditor",["jquery","lodash","i18n","util/urlParser","core/dataProvider/request","tpl!taoMediaManager/qtiCreator/tpl/toolbars/cssToggler","jquery.fileDownload"],function($,_,__,UrlParser,request,cssTpl){"use strict";var itemConfig,globalConfig,currentItem,_getUri=function _getUri(action){return globalConfig["".concat(action,"CssUrl")]},_basename=function _basename(path){return path.substring(path.lastIndexOf("/")+1)},hashClassSelector="hashClass",taoHashClassPrefix="tao-",hashClass="",style={},customStylesheet="",$styleElem=function(){var styleElem=$("#item-editor-user-styles");return styleElem.length?styleElem.empty():(styleElem=$("<style>",{id:"item-editor-user-styles"}),$("head").append(styleElem)),styleElem}(),common={title:__("Disable this stylesheet temporarily"),deleteTxt:__("Remove this stylesheet"),editLabelTxt:__("Edit stylesheet label"),downloadTxt:__("Download this stylesheet"),preparingMessageHtml:__("Preparing CSS, please wait\u2026"),failMessageHtml:__("There was a problem downloading your CSS, please try again."),isInValidLocalTxt:__("This stylesheet has not been found on the server. you may want to delete this reference")},erase=function erase(){return style={},$styleElem.text(""),!1},create=function create(dontAppend){var mSelector,mProp,css="";return _.isEmpty(style)?erase():(_.forEach(style,function(value1,key1){css+="".concat(key1,"{"),_.forEach(value1,function(value2,key2){if(_.isPlainObject(value2))for(mSelector in value2){for(mProp in css+="".concat(key2,"{"),value2)css+="".concat(mProp,":").concat(value2[mSelector],";");css+="}"}else css+="".concat(key2,":").concat(value2,";")}),css+="}\n"}),dontAppend||$styleElem.text(css),css)},apply=function apply(selector,property,value){selector=selector.replace(hashClassSelector,hashClass),style[selector]=style[selector]||{},value?style[selector][property]=value:(delete style[selector][property],0===_.size(style[selector])&&delete style[selector]),create(),$(document).trigger("stylechange.qti-creator")},verifyInit=function verifyInit(){if(!itemConfig)throw new Error("Missing itemConfig, did you call styleEditor.init()?");return!0},save=function save(){return verifyInit(),request(_getUri("save"),_.extend({},itemConfig,{cssJson:JSON.stringify(style),stylesheetUri:customStylesheet.attr("href")}),"POST")},download=function download(uri){verifyInit(),$.fileDownload(_getUri("download"),{preparingMessageHtml:common.preparingMessageHtml,failMessageHtml:common.failMessageHtml,successCallback:function successCallback(){},httpMethod:"POST",data:_.extend({},itemConfig,{stylesheetUri:uri})})},addStylesheet=function addStylesheet(stylesheet){function loadStylesheet(linkElement,stylesheetObject,isLocal,isValid){var isInvalidLocal=isLocal&&!isValid,tplData={path:stylesheetObject.attr("href"),label:stylesheetObject.attr("title")||fileName,title:common.title,deleteTxt:common.deleteTxt,downloadTxt:common.downloadTxt,editLabelTxt:isInvalidLocal?common.isInValidLocalTxt:common.editLabelTxt};return listEntry=$(cssTpl(tplData)),listEntry.data("stylesheetObj",stylesheetObject),$("#style-sheet-toggler").append(listEntry),isInvalidLocal?(listEntry.addClass("not-available"),void listEntry.find("[data-role=\"css-download\"], .style-sheet-toggler").css("visibility","hidden")):void($styleElem.before(linkElement),setTimeout(function(){var isInit=!1;$(document).trigger("customcssloaded.styleeditor",[style]),$(window).trigger("resize"),currentItem.pendingStylesheetsInit&&(isInit=!0,currentItem.pendingStylesheetsInit--),$(document).trigger("stylechange.qti-creator",[{initializing:isInit}])},isLocal?500:3500))}var fileName,link,listEntry,parser;_.isString(stylesheet)&&(stylesheet=currentItem.createStyleSheet(stylesheet)),fileName=_basename(stylesheet.attr("href")),link=function(){var _link=$(stylesheet.render()),_href=_link.attr("href"),_sep=-1<_href.indexOf("?")?"&":"?";return _link.attr("href",_href+_sep+new Date().getTime().toString()),_link}(),parser=new UrlParser(link.attr("href")),parser.checkCORS()?$.when($.ajax(link.attr("href"))).then(function(){loadStylesheet(link,stylesheet,!0,!0)},function(){loadStylesheet(link,stylesheet,!0,!1)}):loadStylesheet(link,stylesheet,!1)},addItemStylesheets=function addItemStylesheets(){var currentStylesheet;currentItem.pendingStylesheetsInit=_.size(currentItem.stylesheets),_.forEach(currentItem.stylesheets,function(value){currentStylesheet=value,"tao-user-styles.css"===_basename(currentStylesheet.attr("href"))?customStylesheet=currentStylesheet:addStylesheet(value)}),customStylesheet||(customStylesheet=currentItem.createStyleSheet("css/tao-user-styles.css"))},removeOrphanedStylesheets=function removeOrphanedStylesheets(){$("link[data-serial]").remove(),customStylesheet=null,erase()},getItem=function getItem(){return currentItem},init=function init(item,config){var href;globalConfig=config,currentItem=item,itemConfig={uri:config.id,lang:config.lang},removeOrphanedStylesheets(),addItemStylesheets(),href=customStylesheet.attr("href"),currentItem.data("responsive",!0),request(_getUri("load"),_.extend({},itemConfig,{stylesheetUri:href})).then(function(_style){style=_style,create(),$(document).trigger("customcssloaded.styleeditor",[style])})},getStyle=function getStyle(){return style},getHashClass=function getHashClass(){return hashClass},setHashClass=function setHashClass(cssClass){hashClass=cssClass},generateHashClass=function generateHashClass(){return hashClass="".concat(taoHashClassPrefix).concat(Math.random().toString(36).substr(2,9))},replaceHashClass=function replaceHashClass(selector){return selector.replace(hashClassSelector,hashClass)},clearCache=function clearCache(){removeOrphanedStylesheets(),$(document).off("customcssloaded.styleeditor")};return{apply:apply,save:save,download:download,erase:erase,init:init,create:create,getItem:getItem,getStyle:getStyle,addStylesheet:addStylesheet,getHashClass:getHashClass,setHashClass:setHashClass,generateHashClass:generateHashClass,replaceHashClass:replaceHashClass,clearCache:clearCache}}),define("taoMediaManager/qtiCreator/editor/styleEditor/styleSheetToggler",["jquery","taoMediaManager/qtiCreator/editor/styleEditor/styleEditor","i18n","lodash","taoQtiItem/qtiCreator/model/Stylesheet","tpl!taoQtiItem/qtiCreator/tpl/notifications/genericFeedbackPopup","ui/resourcemgr"],function($,styleEditor,__,_,Stylesheet,genericFeedbackPopup){"use strict";var $doc=$(document),styleSheetToggler=function(){var init=function init(itemConfig){var cssToggler=$("#style-sheet-toggler"),uploader=$("#stylesheet-uploader"),customCssToggler=$("[data-custom-css]"),getContext=function getContext(trigger){trigger=$(trigger);var li=trigger.closest("li"),stylesheetObj=li.data("stylesheetObj")||new Stylesheet({href:li.data("css-res")}),input=li.find(".style-sheet-label-editor"),labelBox=input.prev(".file-label"),label=input.val();return{li:li,input:input,label:label,labelBox:labelBox,isCustomCss:!!li.data("custom-css"),isDisabled:li.find(".icon-preview").hasClass("disabled"),stylesheetObj:stylesheetObj,cssUri:stylesheetObj.attr("href")}};uploader.on("click",function(){uploader.resourcemgr({appendContainer:"#mediaManager",path:"/",root:"local",browseUrl:itemConfig.getFilesUrl,uploadUrl:itemConfig.fileUploadUrl,deleteUrl:itemConfig.fileDeleteUrl,downloadUrl:itemConfig.fileDownloadUrl,fileExistsUrl:itemConfig.fileExistsUrl,params:{uri:itemConfig.uri,lang:itemConfig.lang,filters:"text/css"},pathParam:"path",select:function select(e,files){var i,l=files.length;for(i=0;i<l;i++)styleEditor.addStylesheet(files[i].file)}})});var deleteStylesheet=function deleteStylesheet(trigger){var context=getContext(trigger),attr=context.isDisabled?"disabled-href":"href",cssLinks=$("head link");styleEditor.getItem().removeStyleSheet(context.stylesheetObj),cssLinks.filter("["+attr+"*=\""+context.cssUri+"\"]").remove(),context.li.remove(),$(".feedback-info").hide(),_createInfoBox({message:__("Style Sheet <b>%s</b> removed<br> Click <i>Add Style Sheet</i> to re-apply.").replace("%s",context.label),type:"info"}),$doc.trigger("customcssloaded.styleeditor",[styleEditor.getStyle()])},initLabelEditor=function initLabelEditor(trigger){var context=getContext(trigger);context.labelBox.hide(),context.input.show()},downloadStylesheet=function downloadStylesheet(trigger){styleEditor.download(getContext(trigger).cssUri)},saveLabel=function saveLabel(trigger){var context=getContext(trigger),title=$.trim(context.input.val());return title?void(context.stylesheetObj.attr("title",title),context.input.hide(),context.labelBox.html(title).show()):(context.stylesheetObj.attr("title",""),!1)},handleAvailability=function handleAvailability(trigger){var link,context=getContext(trigger),attrTo="disabled-href",attrFrom="href";context.isCustomCss?context.isDisabled?(styleEditor.create(),customCssToggler.removeClass("not-available")):(styleEditor.erase(),customCssToggler.addClass("not-available")):(context.isDisabled&&(attrTo="href",attrFrom="disabled-href"),link=$("link["+attrFrom+"$=\""+context.cssUri+"\"]"),link.attr(attrTo,link.attr(attrFrom)).removeAttr(attrFrom)),$(trigger).toggleClass("disabled")};cssToggler.on("click",function(e){var target=e.target,className=target.className;-1<className.indexOf("icon-bin")?deleteStylesheet(e.target):-1<className.indexOf("file-label")?initLabelEditor(e.target):-1<className.indexOf("icon-preview")?handleAvailability(e.target):-1<className.indexOf("icon-download")&&downloadStylesheet(e.target)}),cssToggler.on("keydown","input",function(e){13===e.keyCode&&$(e.target).trigger("blur")}),cssToggler.on("blur","input",function(e){saveLabel(e.target)})},_createInfoBox=function _createInfoBox(data){var $messageBox=$(genericFeedbackPopup(data)),closeTrigger=$messageBox.find(".close-trigger");return $("body").append($messageBox),closeTrigger.on("click",function(){$messageBox.fadeOut(function(){$(this).remove()})}),setTimeout(function(){closeTrigger.trigger("click")},4523),$messageBox};return{init:init}}();return styleSheetToggler}),define("taoMediaManager/qtiCreator/editor/styleEditor/fontSelector",["jquery","lodash","json!taoQtiItem/qtiCreator/editor/resources/font-stacks.json","taoMediaManager/qtiCreator/editor/styleEditor/styleEditor","i18n","select2"],function($,_,fontStacks,styleEditor,__){"use strict";var fontSelector=function fontSelector($container){var selector="select#item-editor-font-selector",$selector=$container.find("select#item-editor-font-selector"),target=styleEditor.replaceHashClass($selector.data("target")),normalize=function normalize(font){return font.replace(/"/g,"'").replace(/, /g,",")},clean=function clean(font){return font.substring(0,font.indexOf(",")).replace(/'/g,"").replace(/"/g,"")},resetButton=$selector.parent().find("[data-role=\"font-selector-reset\"]"),toLabel=function toLabel(font){return font=font.replace(/-/g," "),font.replace(/^([a-z\u00E0-\u00FC])|\s+([a-z\u00E0-\u00FC])/g,function($1){return $1.toUpperCase()})},format=function format(state){var originalOption=state.element;return state.id?"<span style=\"font-size: 12px;".concat($(originalOption).attr("style"),"\">").concat(state.text,"</span>"):state.text},reset=function reset(){styleEditor.apply(target,"font-family"),$selector.select2("val","")},applyToStylesEditor=!0;$selector.empty(),$selector.append("<option value=\"\">".concat(__("Default"),"</option>"));var styles=styleEditor.getStyle()||{},selectedFontFamily=styles[target]&&styles[target]["font-family"]&&clean(styles[target]["font-family"]);_.forEach(fontStacks,function(value,key){var optGroup=$("<optgroup>",{label:toLabel(key)});_.forEach(value,function(font){var normalizeFont=normalize(font),option=$("<option>",{value:normalizeFont,text:clean(normalizeFont)}).css({fontFamily:normalizeFont});clean(normalizeFont)===selectedFontFamily&&option.attr("selected",!0),optGroup.append(option)}),$selector.append(optGroup)}),resetButton.off("click").on("click",reset),$selector.select2({formatResult:format,formatSelection:format,width:"resolve"}),$selector.off("change").on("change",function(){applyToStylesEditor?styleEditor.apply(target,"font-family",$(this).val()):applyToStylesEditor=!0}),$(document).on("customcssloaded.styleeditor",function(e,style){style[target]&&style[target]["font-family"]&&($selector.select2("val",style[target]["font-family"]),$("".concat("select#item-editor-font-selector"," option:selected")).first().attr("selected","selected")),applyToStylesEditor=!1,$selector.trigger("change")})};return fontSelector}),define("taoMediaManager/qtiCreator/editor/styleEditor/colorSelector",["jquery","lodash","i18n","taoMediaManager/qtiCreator/editor/styleEditor/styleEditor","taoQtiItem/qtiCreator/helper/popup","lib/farbtastic/farbtastic"],function($,_,__,styleEditor){"use strict";function rgbToHex(color){function toHexPair(inp){return"0".concat(parseInt(inp,10).toString(16)).slice(-2)}if(!_.isString(color))return color;var rgbArr=/rgb\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/i.exec(color);return _.isArray(rgbArr)&&4===rgbArr.length?"#".concat(toHexPair(rgbArr[1])).concat(toHexPair(rgbArr[2])).concat(toHexPair(rgbArr[3])):color}function additionalStylesToObject(){var additional=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",styles={},additionalStyles=additional.split(";");return additionalStyles.forEach(function(element){var keyValue=element.split(":");styles[keyValue[0]]=keyValue[1]}),styles}var colorSelector=function colorSelector($container){var widgetObj,colorPicker=$container.find(".item-editor-color-picker"),widget=colorPicker.find(".color-picker"),widgetBox=colorPicker.find(".color-picker-container"),titleElement=colorPicker.find(".color-picker-title"),input=colorPicker.find(".color-picker-input"),resetButtons=colorPicker.find(".reset-button"),colorTriggers=colorPicker.find(".color-trigger"),colorTriggerLabels=colorPicker.find("label"),$doc=$(document),additionalStyles={},currentProperty="color",setTitle=function setTitle(property,trigger){titleElement.text(trigger.parent().find("label").text())},setTriggerColor=function setTriggerColor(){colorTriggers.each(function(){var value,$trigger=$(this),target=styleEditor.replaceHashClass($trigger.data("target")),style=styleEditor.getStyle()||{};style[target]&&style[target][$trigger.data("value")]?(value=style[target][$trigger.data("value")],$trigger.css("background-color",value),$trigger.attr("title",rgbToHex(value))):($trigger.css("background-color",""),$trigger.attr("title",__("No value set")))})},collectCommonAdditionalStyles=function collectCommonAdditionalStyles(){colorTriggers.each(function(){var $trigger=$(this),target=styleEditor.replaceHashClass($trigger.data("target")),value=$trigger.data("value"),styles=additionalStylesToObject($trigger.data("additional"));Object.keys(styles).forEach(function(key){additionalStyles[key]?additionalStyles[key].push({target:target,value:value}):additionalStyles[key]=[{target:target,value:value}]})})};widgetObj=$.farbtastic(widget).linkTo(input),setTriggerColor(),collectCommonAdditionalStyles(),colorTriggers.add(colorTriggerLabels).off("click").on("click",function(){var $tmpTrigger=$(this),$trigger="label"===this.nodeName.toLowerCase()?$tmpTrigger.parent().find(".color-trigger"):$tmpTrigger;widget.prop("target",$trigger.data("target")),widget.prop("additional",$trigger.data("additional")||""),widgetBox.hide(),currentProperty=$trigger.data("value"),setTitle(currentProperty,$trigger),widgetObj.setColor(rgbToHex($trigger.css("background-color"))),widgetBox.show(),widget.on("colorchange.farbtastic",function(e,color){if(styleEditor.apply(widget.prop("target"),currentProperty,color),widget.prop("additional")){var styles=additionalStylesToObject(widget.prop("additional"));Object.keys(styles).forEach(function(key){styleEditor.apply(widget.prop("target"),key,styles[key])})}setTriggerColor()}),$doc.on("mouseup.colorselector",function(e){return $(e.target).hasClass("closer")?(widgetBox.hide(),widget.off("colorchange.farbtastic"),$doc.off("colorselector"),!1):widgetBox.is(e.target)||0!==widgetBox.has(e.target).length?void 0:(widgetBox.hide(),widget.off("colorchange.farbtastic"),$doc.off("colorselector"),!1)}),$doc.on("keyup.colorselector",function(e){if(27===e.keyCode)return widgetBox.hide(),widget.off("colorchange.farbtastic"),$doc.off("colorselector"),!1})}),resetButtons.off("click").on("click",function(){var $this=$(this),$colorTrigger=$this.parent().find(".color-trigger"),target=styleEditor.replaceHashClass($colorTrigger.data("target")),value=$colorTrigger.data("value"),additional=$colorTrigger.data("additional");if(styleEditor.apply(target,value),additional){var styles=additionalStylesToObject(additional);Object.keys(styles).forEach(function(key){if(1===additionalStyles[key].length)styleEditor.apply(target,key);else{var style=styleEditor.getStyle()||{},needToRemove=!0;additionalStyles[key].forEach(function(element){(target!==element.target||value!==element.value)&&style[target]&&style[element.target][element.value]&&(needToRemove=!1)}),needToRemove&&styleEditor.apply(target,key)}})}setTriggerColor()}),$doc.on("customcssloaded.styleeditor",setTriggerColor)};return colorSelector}),define("taoMediaManager/qtiCreator/editor/styleEditor/fontSizeChanger",["jquery","lodash","taoMediaManager/qtiCreator/editor/styleEditor/styleEditor"],function($,_,styleEditor){"use strict";var fontSizeChanger=function fontSizeChanger($container){var $fontSizeChanger=$container.find("#item-editor-font-size-changer"),itemSelector=styleEditor.replaceHashClass($fontSizeChanger.data("target")),figcaptionSelector="".concat(itemSelector," figure figcaption"),$resetBtn=$fontSizeChanger.parents(".reset-group").find("[data-role=\"font-size-reset\"]"),$input=$container.find(".item-editor-font-size-text"),itemFontSize=parseInt($(itemSelector).css("font-size"),10),styles=styleEditor.getStyle()||{};styles[itemSelector]&&styles[itemSelector]["font-size"]?(itemFontSize=parseInt(styles[itemSelector]["font-size"],10),$input.val(itemFontSize)):$input.val("");var resizeFont=function resizeFont(){styleEditor.apply(itemSelector,"font-size","".concat(itemFontSize.toString(),"px"));var figcaptionSize=14<itemFontSize?(itemFontSize-2).toString():Math.min(itemFontSize,12).toString();styleEditor.apply(figcaptionSelector,"font-size","".concat(figcaptionSize,"px"))};$fontSizeChanger.find("button").off("click").on("click",function(e){if(e.preventDefault(),"reduce"===$(this).data("action")){if(10>=itemFontSize)return;itemFontSize--}else itemFontSize++;resizeFont(),$input.val(itemFontSize),$(this).parent().blur()}),$input.off("blur").on("blur",function(){this.value?(itemFontSize=parseInt(this.value,10),resizeFont()):(styleEditor.apply(itemSelector,"font-size"),styleEditor.apply(figcaptionSelector,"font-size"))}),$input.off("keydown").on("keydown",function(e){var c=e.keyCode;return 13===c&&$input.trigger("blur"),_.contains([8,37,39,46],c)||48<=c&&57>=c||96<=c&&105>=c}),$resetBtn.off("click").on("click",function(){styleEditor.apply(itemSelector,"font-size"),styleEditor.apply(figcaptionSelector,"font-size"),$input.val(""),itemFontSize=parseInt($(itemSelector).css("font-size"),10)}),$(document).on("customcssloaded.styleeditor",function(e,style){style[itemSelector]&&style[itemSelector]["font-size"]?(itemFontSize=parseInt(style[itemSelector]["font-size"],10),$input.val(itemFontSize)):$input.val("")})};return fontSizeChanger}),define("taoMediaManager/qtiCreator/editor/propertiesPanel",["jquery","taoQtiItem/qtiCreator/helper/panel","taoMediaManager/qtiCreator/editor/styleEditor/styleEditor","taoMediaManager/qtiCreator/editor/styleEditor/styleSheetToggler","taoMediaManager/qtiCreator/editor/styleEditor/fontSelector","taoMediaManager/qtiCreator/editor/styleEditor/colorSelector","taoMediaManager/qtiCreator/editor/styleEditor/fontSizeChanger"],function($,panel,styleEditor,styleSheetToggler,fontSelector,colorSelector,fontSizeChanger){"use strict";return function setUpInteractionPanel($container,widget,config){panel.initSidebarAccordion($container),panel.initFormVisibilityListener(),styleEditor.init(widget.element,config),styleSheetToggler.init(config);var $passageEditor=$("#item-editor-item-property-bar");fontSelector($passageEditor),colorSelector($passageEditor),fontSizeChanger($passageEditor)}}),define("taoMediaManager/qtiXmlRenderer/renderers/config",["taoItems/assets/manager"],function(assetManagerFactory){"use strict";var assetManager=assetManagerFactory([{name:"nomalize",handle:function normalizeStrategy(url){if(url)return url.toString().replace(/^\.?\//,"")}}]);return{name:"xmlRenderer",locations:{_container:"taoQtiItem/qtiXmlRenderer/renderers/Container",assessmentItem:"taoMediaManager/qtiXmlRenderer/renderers/Item",_tooltip:"taoQtiItem/qtiXmlRenderer/renderers/Tooltip",math:"taoQtiItem/qtiXmlRenderer/renderers/Math",figure:"taoQtiItem/qtiXmlRenderer/renderers/Figure",img:"taoQtiItem/qtiXmlRenderer/renderers/Img",figcaption:"taoQtiItem/qtiXmlRenderer/renderers/Figcaption",object:"taoQtiItem/qtiXmlRenderer/renderers/Object",table:"taoQtiItem/qtiXmlRenderer/renderers/Table"},options:{assetManager:assetManager}}}),define("taoMediaManager/qtiXmlRenderer/renderers/Renderer",["taoQtiItem/qtiRunner/core/Renderer","taoMediaManager/qtiXmlRenderer/renderers/config"],function(Renderer,config){"use strict";return Renderer.build(config.locations,config.name,config.options)}),define("taoMediaManager/qtiCreator/helper/xmlRenderer",["core/logger","taoMediaManager/qtiXmlRenderer/renderers/Renderer","taoQtiItem/qtiItem/core/Element"],function(loggerFactory,XmlRenderer,Element){"use strict";var logger=loggerFactory("taoMediaManager/qtiCreator/helper/xmlRenderer"),_xmlRenderer=new XmlRenderer().load(),_render=function _render(element){var xml="";try{element instanceof Element&&(xml=element.render(_xmlRenderer))}catch(e){logger.error(e)}return xml};return{render:_render,get:function get(){return _xmlRenderer}}}),define("taoMediaManager/qtiCreator/editor/interactionsPanel",["lodash","i18n","taoQtiItem/qtiCreator/editor/interactionsToolbar","taoQtiItem/qtiCreator/helper/panel"],function(_,__,interactionsToolbar,panel){"use strict";return function setUpInteractionPanel($container){var tagTitles={inlineInteractions:__("Inline Interactions")},interactions={_container:{label:__("Text Block"),icon:"icon-font",description:__("Block contains the content (stimulus) of the item such as text or image. It is also required for Inline Interactions."),short:__("Block"),qtiClass:"_container",tags:[tagTitles.inlineInteractions,"text"],group:__("inline-interactions")}};interactionsToolbar.create($container,interactions),panel.initSidebarAccordion($container),panel.toggleInlineInteractionGroup()}}),define("taoMediaManager/qtiCreator/sharedStimulusCreator",["jquery","lodash","i18n","core/eventifier","taoQtiItem/qtiCreator/context/qtiCreatorContext","taoMediaManager/qtiCreator/helper/sharedStimulusLoader","taoMediaManager/qtiCreator/helper/creatorRenderer","taoQtiItem/qtiCreator/helper/commonRenderer","taoMediaManager/qtiCreator/editor/propertiesPanel","taoQtiItem/qtiCreator/model/helper/event","taoMediaManager/qtiCreator/helper/xmlRenderer","taoQtiItem/qtiItem/helper/xmlNsHandler","core/request","util/url","taoMediaManager/qtiCreator/editor/interactionsPanel","taoMediaManager/qtiCreator/editor/styleEditor/styleEditor","taoQtiItem/qtiItem/core/Element"],function($,_,__,eventifier,qtiCreatorContextFactory,sharedStimulusLoader,creatorRenderer,commonRenderer,propertiesPanel,eventHelper,xmlRenderer,xmlNsHandler,request,urlUtil,interactionPanel,styleEditor,Element){"use strict";var loadSharedStimulus=function loadSharedStimulus(id,uri,assetDataUrl){return new Promise(function(resolve,reject){sharedStimulusLoader.loadSharedStimulus({id:id,uri:uri,assetDataUrl:assetDataUrl},function(item){item||reject(new Error("Unable to load the Shared Stimulus")),item.data("uri",uri),resolve(item)})})},sharedStimulusCreatorFactory=function sharedStimulusCreatorFactory(config,areaBroker,pluginFactories){var sharedStimulusCreator,qtiCreatorContext=qtiCreatorContextFactory(),plugins={},pluginRun=function pluginRun(method){var execStack=[];return _.forEach(plugins,function(plugin){_.isFunction(plugin[method])&&execStack.push(plugin[method]())}),Promise.all(execStack)};if(!_.isPlainObject(config))throw new TypeError("The shared stimulus creator configuration is required");if(!config.properties||_.isEmpty(config.properties.uri)||_.isEmpty(config.properties.baseUrl))throw new TypeError("The creator configuration must contains the required properties triples: uri, label and baseUrl");if(!areaBroker)throw new TypeError("Without an areaBroker there are no chance to see something you know");return sharedStimulusCreator=eventifier({init:function init(){var _this=this;return _.forEach(pluginFactories,function(pluginFactory){var plugin=pluginFactory(_this,areaBroker);plugins[plugin.getName()]=plugin}),$(document).off(".qti-widget"),this.on("save",function(silent){var item=_this.getItem(),styles=styleEditor.getStyle();_.size(styles)&&!item.attributes.class&&(item.attributes.class=_this.hashClass);var xml=xmlNsHandler.restoreNs(xmlRenderer.render(item),item.getNamespaces());Promise.all([request({url:urlUtil.route("patch","SharedStimulus","taoMediaManager",{id:config.properties.id}),type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify({body:xml}),method:"PATCH",noToken:!0}),styleEditor.save()]).then(function(){silent||_this.trigger("success"),_this.trigger("saved")}).catch(function(err){_this.trigger("error",err)})}),this.on("exit",function(){$(".item-editor-item",areaBroker.getItemPanelArea()).empty(),this.destroy()}),loadSharedStimulus(config.properties.id,config.properties.uri,config.properties.assetDataUrl).then(function(item){return _.isObject(item)?void(_this.item=item):void _this.trigger("error",new Error("Unable to load the item ".concat(config.properties.label)))}).then(function(){return pluginRun("init")}).then(function(){_this.trigger("init",_this.item)}).then(function(){return qtiCreatorContext.on("error",function(err){_this.trigger("error",err)}),qtiCreatorContext.init()}).catch(function(err){_this.trigger("error",err)}),this},render:function render(){var _this2=this,self=this,item=this.getItem();return item&&_.isFunction(item.getUsedClasses)?(commonRenderer.setContext(areaBroker.getItemPanelArea()),commonRenderer.get(!0,config).setOption("baseUrl",config.properties.baseUrl),interactionPanel(areaBroker.getInteractionPanelArea()),$(document).on("ready.qti-widget",function(e,elt){"assessmentItem"===elt.element.qtiClass&&_this2.trigger("ready")}),$(document).on("afterStateInit.qti-widget",function(e,element,state){if(element.getRootElement().data("widget")){var $itemContainer=element.getRootElement().data("widget").$container;switch(state.name){case"active":Element.isA(element,"assessmentItem")||$itemContainer.removeClass("focus-border");break;case"sleep":$itemContainer.find(".widget-box.edit-active").length||($itemContainer.addClass("focus-border"),styleEditor.setHashClass(sharedStimulusCreator.hashClass));}}}),config.qtiCreatorContext=qtiCreatorContext,creatorRenderer.get(!0,config,areaBroker).setOptions(config.properties).load(function(){var widget;item.setRenderer(this),areaBroker.getItemPanelArea().append(item.render()),Promise.all(item.postRender(_.clone(config.properties))).then(function(){return areaBroker.getContainer().data("widget",item),widget=item.data("widget"),item.attributes.class?styleEditor.setHashClass(item.attributes.class):styleEditor.generateHashClass(),sharedStimulusCreator.hashClass=styleEditor.getHashClass(),widget.$container.find(".qti-itemBody").addClass(sharedStimulusCreator.hashClass),propertiesPanel(areaBroker.getPropertyPanelArea(),widget,config.properties),eventHelper.initElementToWidgetListeners(),pluginRun("render").then(function(){self.trigger("render")})}).catch(function(err){self.trigger("error",err)})},item.getUsedClasses()),this):this.trigger("error",new Error("We need an item to render."))},destroy:function destroy(){var _this3=this;return $(document).off(".qti-widget"),styleEditor.clearCache(),pluginRun("destroy").then(function(){return qtiCreatorContext.destroy()}).then(function(){_this3.trigger("destroy")}).catch(function(err){_this3.trigger("error",err)}),this},getItem:function getItem(){return this.item},getSharedStimulusId:function getSharedStimulusId(){return config.properties.id},getConfig:function getConfig(){return config}}),sharedStimulusCreator};return sharedStimulusCreatorFactory}),define("tpl!taoMediaManager/qtiCreator/component/tpl/sharedStimulusAuthoring",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression;return buffer+="<div id=\"item-editor-scope\" data-content-target=\"wide\">\n\n    <nav class=\"action-bar plain content-action-bar horizontal-action-bar\">\n        <ul class=\"menu-left action-group plain item-editor-menu\"></ul>\n\n        <ul class=\"menu action-group plain item-editor-menu\"></ul>\n\n        <ul class=\"menu-right action-group plain item-editor-menu\">\n        </ul>\n    </nav>\n    <div class=\"wrapper clearfix content sidebar-popup-parent\" id=\"item-editor-wrapper\">\n\n        <!-- interaction panel -->\n        <div class=\"item-editor-sidebar-wrapper left-bar\">\n            <form class=\"item-editor-sidebar\" id=\"item-editor-interaction-bar\" autocomplete=\"off\"></form>\n        </div>\n\n        <!-- item panel -->\n        <main id=\"item-editor-panel\" class=\"clearfix\">\n\n            <div class=\"item-editor-bar\">\n                <h1 class=\"truncate\"></h1>\n                <div id=\"toolbar-top\"></div>\n            </div>\n\n            <div id=\"item-editor-scoll-container\">\n                <div id=\"item-editor-scroll-outer\">\n                    <div id=\"item-editor-scroll-inner\">\n                        <!-- item goes here -->\n                    </div>\n                </div>\n            </div>\n\n        </main>\n\n        <!-- properties panel -->\n        <div class=\"item-editor-sidebar-wrapper right-bar sidebar-popup-parent\">\n            <div class=\"item-editor-sidebar\" id=\"item-editor-item-widget-bar\">\n                <div class=\"item-editor-item-related sidebar-right-section-box\" id=\"item-editor-item-property-bar\">\n                    <section class=\"tool-group clearfix\" id=\"sidebar-right-passage-properties\">\n                        <h2>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Passage Properties",options):helperMissing.call(depth0,"__","Passage Properties",options)))+"</h2>\n                        <div class=\"panel\"></div>\n                    </section>\n                    <section class=\"tool-group clearfix\" id=\"sidebar-right-style-editor\">\n\n                        <h2>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Passage Style",options):helperMissing.call(depth0,"__","Passage Style",options)))+"</h2>\n\n                        <div class=\"panel color-picker-panel\">\n                            <div class=\"item-editor-color-picker sidebar-popup-container-box\">\n                                <div class=\"color-picker-container sidebar-popup\">\n                                    <div class=\"sidebar-popup-title\">\n                                        <h3 class=\"color-picker-title\"></h3>\n                                        <a class=\"closer\" href=\"#\" data-close=\"#color-picker-container\"></a>\n                                    </div>\n                                    <div class=\"sidebar-popup-content\">\n                                        <div class=\"color-picker\"></div>\n                                        <input class=\"color-picker-input\" type=\"text\" value=\"#000000\">\n                                    </div>\n                                </div>\n                                <div class=\"reset-group\">\n                                    <div class=\"clearfix\">\n                                        <label for=\"initial-bg\" class=\"truncate\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Background color",options):helperMissing.call(depth0,"__","Background color",options)))+"</label>\n                                        <button class=\"icon-eraser reset-button\" data-value=\"background-color\"\n                                            aria-label=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Remove custom background color",options):helperMissing.call(depth0,"__","Remove custom background color",options)))+"\"></button>\n                                        <button class=\"color-trigger\" id=\"initial-bg\" data-value=\"background-color\"\n                                            data-target=\"body div.qti-item .hashClass\" data-additional=\"padding:20px\"></button>\n                                    </div>\n                                    <div class=\"clearfix\">\n                                        <label for=\"initial-color\" class=\"truncate\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Text color",options):helperMissing.call(depth0,"__","Text color",options)))+"</label>\n                                        <button class=\"icon-eraser reset-button\" data-value=\"color\"\n                                              aria-label=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Remove custom text color",options):helperMissing.call(depth0,"__","Remove custom text color",options)))+"\"></button>\n                                        <button class=\"color-trigger\" id=\"initial-color\" data-value=\"color\"\n                                              data-target=\"body div.qti-item .hashClass\"></button>\n                                    </div>\n                                    <div class=\"clearfix\">\n                                        <label for=\"initial-color\" class=\"truncate\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Border color",options):helperMissing.call(depth0,"__","Border color",options)))+"</label>\n                                        <button class=\"icon-eraser reset-button\" data-value=\"color\"\n                                              aria-label=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Remove custom border color",options):helperMissing.call(depth0,"__","Remove custom border color",options)))+"\"></button>\n                                        <button class=\"color-trigger\" id=\"initial-color\" data-value=\"border-color\"\n                                              data-target=\"body div.qti-item .hashClass\" data-additional=\"border-width:4px;border-style:solid;padding:20px\"></button>\n                                    </div>\n                                    <div class=\"clearfix\">\n                                        <label for=\"initial-color\" class=\"truncate\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Table headings",options):helperMissing.call(depth0,"__","Table headings",options)))+"</label>\n                                        <button class=\"icon-eraser reset-button\" data-value=\"color\"\n                                              aria-label=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Remove custom background color",options):helperMissing.call(depth0,"__","Remove custom background color",options)))+"\"></button>\n                                        <button class=\"color-trigger\" id=\"initial-color\" data-value=\"background-color\"\n                                              data-target=\"body div.qti-item .hashClass table th\"></button>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        <hr>\n                        <div class=\"panel\">\n\n                            <div>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Font family",options):helperMissing.call(depth0,"__","Font family",options)))+"</div>\n\n                            <div class=\"reset-group\">\n                                <select\n                                    data-target=\"body div.qti-item .hashClass\"\n                                    id=\"item-editor-font-selector\"\n                                    data-has-search=\"false\"\n                                    data-placeholder=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Default",options):helperMissing.call(depth0,"__","Default",options)))+"\"\n                                    class=\"select2 has-icon\"\n                                    data-role=\"font-selector\"></select>\n                                <button class=\"icon-eraser reset-button\" data-role=\"font-selector-reset\"\n                                      aria-label=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Remove custom font family",options):helperMissing.call(depth0,"__","Remove custom font family",options)))+"\"></button>\n                            </div>\n\n                        </div>\n                        <div class=\"panel\">\n                            <div>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Font size",options):helperMissing.call(depth0,"__","Font size",options)))+"</div>\n                            <div class=\"reset-group\">\n                                        <span id=\"item-editor-font-size-changer\" data-target=\"body div.qti-item .hashClass\">\n                                            <button data-action=\"reduce\" aria-label=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Reduce font size",options):helperMissing.call(depth0,"__","Reduce font size",options)))+"\"\n                                               class=\"icon-smaller\"></button>\n                                            <button data-action=\"enlarge\" aria-label=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Enlarge font size",options):helperMissing.call(depth0,"__","Enlarge font size",options)))+"\"\n                                               class=\"icon-larger\"></button>\n                                        </span>\n\n                                <span id=\"item-editor-font-size-manual-input\" class=\"item-editor-unit-input-box\">\n                                            <input type=\"text\" class=\"item-editor-font-size-text has-icon\"\n                                                   placeholder=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"e.g. 13",options):helperMissing.call(depth0,"__","e.g. 13",options)))+"\">\n                                                <span class=\"unit-indicator\">px</span>\n                                        </span>\n                                <button class=\"icon-eraser reset-button\" data-role=\"font-size-reset\"\n                                      aria-label=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Remove custom font size",options):helperMissing.call(depth0,"__","Remove custom font size",options)))+"\"></button>\n                            </div>\n\n                        </div>\n\n                    </section>\n                </div>\n                <div class=\"item-editor-item-related sidebar-right-section-box\" id=\"item-editor-text-property-bar\">\n                    <section class=\"tool-group clearfix\" id=\"sidebar-right-style-editor\">\n\n                        <h2>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Text Block Style",options):helperMissing.call(depth0,"__","Text Block Style",options)))+"</h2>\n\n                        <div class=\"panel color-picker-panel\">\n                            <div class=\"item-editor-color-picker sidebar-popup-container-box\">\n                                <div class=\"color-picker-container sidebar-popup\">\n                                    <div class=\"sidebar-popup-title\">\n                                        <h3 id=\"color-picker-title\"></h3>\n                                        <a class=\"closer\" href=\"#\" data-close=\"#color-picker-container\"></a>\n                                    </div>\n                                    <div class=\"sidebar-popup-content\">\n                                        <div class=\"color-picker\"></div>\n                                        <input class=\"color-picker-input\" type=\"text\" value=\"#000000\">\n                                    </div>\n                                </div>\n                                <div class=\"reset-group\">\n                                    <div class=\"clearfix\">\n                                        <label for=\"initial-bg\" class=\"truncate\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Background color",options):helperMissing.call(depth0,"__","Background color",options)))+"</label>\n                                        <button class=\"icon-eraser reset-button\" data-value=\"background-color\"\n                                              aria-label=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Remove custom background color",options):helperMissing.call(depth0,"__","Remove custom background color",options)))+"\"></button>\n                                        <button class=\"color-trigger\" id=\"initial-bg\" data-value=\"background-color\"\n                                              data-target=\"body div.qti-item .custom-text-box.hashClass\" data-additional=\"padding:20px\"></button>\n                                    </div>\n                                    <div class=\"clearfix\">\n                                        <label for=\"initial-color\" class=\"truncate\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Text color",options):helperMissing.call(depth0,"__","Text color",options)))+"</label>\n                                        <button class=\"icon-eraser reset-button\" data-value=\"color\"\n                                              aria-label=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Remove custom text color",options):helperMissing.call(depth0,"__","Remove custom text color",options)))+"\"></button>\n                                        <button class=\"color-trigger\" id=\"initial-color\" data-value=\"color\"\n                                              data-target=\"body div.qti-item .custom-text-box.hashClass\"></button>\n                                    </div>\n                                    <div class=\"clearfix\">\n                                        <label for=\"initial-color\" class=\"truncate\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Border color",options):helperMissing.call(depth0,"__","Border color",options)))+"</label>\n                                        <button class=\"icon-eraser reset-button\" data-value=\"color\"\n                                              aria-label=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Remove custom border color",options):helperMissing.call(depth0,"__","Remove custom border color",options)))+"\"></button>\n                                        <button class=\"color-trigger\" id=\"initial-color\" data-value=\"border-color\"\n                                              data-target=\"body div.qti-item .custom-text-box.hashClass\" data-additional=\"border-width:4px;border-style:solid;padding:20px\"></button>\n                                    </div>\n                                    <div class=\"clearfix\">\n                                        <label for=\"initial-color\" class=\"truncate\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Table headings",options):helperMissing.call(depth0,"__","Table headings",options)))+"</label>\n                                        <button class=\"icon-eraser reset-button\" data-value=\"color\"\n                                              aria-label=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Remove custom background color",options):helperMissing.call(depth0,"__","Remove custom background color",options)))+"\"></button>\n                                        <button class=\"color-trigger\" id=\"initial-color\" data-value=\"background-color\"\n                                              data-target=\"body div.qti-item .custom-text-box.hashClass table th\"></button>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        <hr>\n                        <div class=\"panel\">\n\n                            <div>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Font family",options):helperMissing.call(depth0,"__","Font family",options)))+"</div>\n\n                            <div class=\"reset-group\">\n                                <select\n                                    data-target=\"body div.qti-item .custom-text-box.hashClass\"\n                                    id=\"item-editor-font-selector\"\n                                    data-has-search=\"false\"\n                                    data-placeholder=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Default",options):helperMissing.call(depth0,"__","Default",options)))+"\"\n                                    class=\"select2 has-icon\"\n                                    data-role=\"font-selector\"></select>\n                                <button class=\"icon-eraser reset-button\" data-role=\"font-selector-reset\"\n                                      aria-label=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Remove custom font family",options):helperMissing.call(depth0,"__","Remove custom font family",options)))+"\"></button>\n                            </div>\n\n                        </div>\n                        <div class=\"panel\">\n                            <div>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Font size",options):helperMissing.call(depth0,"__","Font size",options)))+"</div>\n                            <div class=\"reset-group\">\n                                        <span id=\"item-editor-font-size-changer\" data-target=\"body div.qti-item .custom-text-box.hashClass\">\n                                            <button data-action=\"reduce\" aria-label=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Reduce font size",options):helperMissing.call(depth0,"__","Reduce font size",options)))+"\"\n                                               class=\"icon-smaller\"></button>\n                                            <button data-action=\"enlarge\" aria-label=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Enlarge font size",options):helperMissing.call(depth0,"__","Enlarge font size",options)))+"\"\n                                               class=\"icon-larger\"></button>\n                                        </span>\n\n                                <span id=\"item-editor-font-size-manual-input\" class=\"item-editor-unit-input-box\">\n                                            <input type=\"text\" class=\"item-editor-font-size-text has-icon\"\n                                                   placeholder=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"e.g. 13",options):helperMissing.call(depth0,"__","e.g. 13",options)))+"\">\n                                                <span class=\"unit-indicator\">px</span>\n                                        </span>\n                                <button class=\"icon-eraser reset-button\" data-role=\"font-size-reset\"\n                                      aria-label=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Remove custom font size",options):helperMissing.call(depth0,"__","Remove custom font size",options)))+"\"></button>\n                            </div>\n\n                        </div>\n\n                    </section>\n                    <section class=\"tool-group clearfix\" id=\"sidebar-right-text-block-properties\">\n                        <h2>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Text Block Properties",options):helperMissing.call(depth0,"__","Text Block Properties",options)))+"</h2>\n\n                        <div class=\"panel\"></div>\n                    </section>\n                </div>\n                <div class=\"item-editor-body-element-related sidebar-right-section-box\" id=\"item-editor-body-element-property-bar\">\n                    <section class=\"tool-group clearfix\" id=\"sidebar-right-body-element-properties\">\n                        <h2><?= __('Element Properties') ?></h2>\n\n                        <div class=\"panel\"></div>\n                    </section>\n                </div>\n            </div>\n        </div>\n        <!-- /properties panel -->\n\n\n    </div>\n\n    <div id=\"mediaManager\"></div>\n    <div id=\"modal-container\"></div>\n</div>",buffer})}),define("taoMediaManager/qtiCreator/component/sharedStimulusAuthoring",["lodash","ui/component","core/pluginLoader","taoMediaManager/qtiCreator/sharedStimulusCreator","taoQtiItem/qtiCreator/editor/areaBroker","tpl!taoMediaManager/qtiCreator/component/tpl/sharedStimulusAuthoring","context","css!taoQtiItemCss/qti-runner.css","css!taoQtiItemCss/themes/default.css","css!taoQtiItemCss/item-creator.css"],function(_,componentFactory,pluginLoaderFactory,sharedStimulusCreatorFactory,areaBrokerFactory,componentTpl,context){"use strict";function sharedStimulusAuthoringFactory(container){var areaBroker,sharedStimulusCreator,config=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},plugins=Array.isArray(config.plugins)?config.plugins:[];config.plugins=[].concat(defaultPlugins,_toConsumableArray(plugins));var pluginLoader=pluginLoaderFactory(),api={getAreaBroker:function getAreaBroker(){return areaBroker}},sharedStimulusAuthoring=componentFactory(api).setTemplate(componentTpl).on("init",function(){var _this4=this;_.forEach(this.getConfig().plugins,function(plugin){plugin&&plugin.module&&(plugin.exclude?pluginLoader.remove(plugin.module):pluginLoader.add(plugin))}),pluginLoader.load(!!context.bundle).then(function(){return _this4.render(container)}).catch(function(err){return _this4.trigger("error",err)})}).on("render",function(){var $container=this.getElement();areaBroker=areaBrokerFactory($container,{menu:$container.find(".menu"),menuLeft:$container.find(".menu-left"),menuRight:$container.find(".menu-right"),contentCreatorPanel:$container.find("#item-editor-panel"),editorBar:$container.find("#item-editor-panel .item-editor-bar"),title:$container.find("#item-editor-panel .item-editor-bar h1"),toolbar:$container.find("#item-editor-panel .item-editor-bar #toolbar-top"),interactionPanel:$container.find("#item-editor-interaction-bar"),propertyPanel:$container.find("#item-editor-item-widget-bar"),itemPanel:$container.find("#item-editor-scroll-inner"),itemPropertyPanel:$container.find("#sidebar-right-item-properties"),itemStylePanel:$container.find("#item-style-editor-bar"),modalContainer:$container.find("#modal-container"),elementPropertyPanel:$container.find("#item-editor-body-element-property-bar .panel")}),sharedStimulusCreator=sharedStimulusCreatorFactory(this.getConfig(),areaBroker,pluginLoader.getPlugins()).spread(this,"error success ready").on("init",function(){this.render()}).on("destroy",function(){sharedStimulusCreator=null,sharedStimulusAuthoring.destroy()}).init()}).on("destroy",function(){sharedStimulusCreator&&sharedStimulusCreator.destroy(),sharedStimulusCreator=null,areaBroker=null});return _.defer(function(){return sharedStimulusAuthoring.init(config)}),sharedStimulusAuthoring}var defaultPlugins=[{module:"taoQtiItem/qtiCreator/plugins/content/title",bundle:"taoQtiItem/loader/taoQtiItem.min",category:"content"},{module:"taoMediaManager/qtiCreator/plugins/navigation/back",bundle:"taoMediaManager/loader/taoMediaManager.min",category:"menu"},{module:"taoMediaManager/qtiCreator/plugins/menu/save",bundle:"taoMediaManager/loader/taoMediaManager.min",category:"menu"},{module:"taoMediaManager/qtiCreator/plugins/menu/preview",bundle:"taoMediaManager/loader/taoMediaManager.min",category:"menu"},{module:"taoQtiItem/qtiCreator/plugins/content/changeTracker",bundle:"taoQtiItem/loader/taoQtiItem.min",category:"content"},{module:"taoMediaManager/qtiCreator/plugins/content/blockAdder",bundle:"taoMediaManager/loader/taoMediaManager.min",category:"content"}];return sharedStimulusAuthoringFactory}),define("taoMediaManager/controller/authoring",["i18n","lodash","jquery","uri","taoMediaManager/qtiCreator/component/sharedStimulusAuthoring","ui/feedback","util/url","core/dataProvider/request","core/logger"],function(__,_,$,uri,sharedStimulusAuthoringFactory,feedback,urlUtil,request,loggerFactory){"use strict";var logger=loggerFactory("taoMediaManager/authoring"),manageMediaController={start:function start(){var $panel=$("#panel-authoring"),assetDataUrl=urlUtil.route("get","SharedStimulus","taoMediaManager"),assetId=uri.decode($panel.attr("data-id")),previewEnabled=!1;request(assetDataUrl,{id:assetId}).then(function(response){response.permissions.includes("READ")&&(previewEnabled=!0)}).then(function(){sharedStimulusAuthoringFactory($panel,{properties:{uri:$panel.attr("data-uri"),id:assetId,assetDataUrl:assetDataUrl,fileUploadUrl:urlUtil.route("upload","ItemContent","taoItems"),fileDeleteUrl:urlUtil.route("delete","ItemContent","taoItems"),fileDownloadUrl:urlUtil.route("download","ItemContent","taoItems"),fileExistsUrl:urlUtil.route("fileExists","ItemContent","taoItems"),getFilesUrl:urlUtil.route("files","ItemContent","taoItems"),baseUrl:urlUtil.route("getFile","MediaManager","taoMediaManager",{uri:""}),path:"taomedia://mediamanager/",root:"mediamanager",lang:"en-US",previewEnabled:previewEnabled,loadCssUrl:urlUtil.route("load","SharedStimulusStyling","taoMediaManager"),saveCssUrl:urlUtil.route("save","SharedStimulusStyling","taoMediaManager")}}).on("success",function(){feedback().success(__("Your passage is saved"))}).on("error",function(err){_.isUndefined(err.message)||feedback().error(err.message),logger.error(err)})})}};return manageMediaController}),define("taoMediaManager/previewer/component/qtiSharedStimulusItem",["context","taoQtiTestPreviewer/previewer/runner","css!taoQtiTestPreviewer/previewer/provider/item/css/item"],function(context,previewerFactory){"use strict";return function qtiItemPreviewerFactory(container){var config=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},template=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,testRunnerConfig={testDefinition:"test-container",serviceCallId:"previewer",providers:{runner:{id:"qtiItemPreviewer",module:"taoQtiTestPreviewer/previewer/provider/item/item",bundle:"taoQtiTestPreviewer/loader/qtiPreviewer.min",category:"runner"},proxy:{id:"qtiSharedStimulusItemProxy",module:"taoMediaManager/previewer/proxy/qtiSharedStimulusItem",bundle:"taoMediaManager/loader/taoMediaManager.min",category:"proxy"},communicator:{id:"request",module:"core/communicator/request",bundle:"loader/vendor.min",category:"communicator"},plugins:config.plugins||[]},options:{view:config.view,readOnly:config.readOnly,fullPage:config.fullPage,plugins:config.pluginsOptions,hideActionBars:config.hideActionBars},proxyProvider:"qtiSharedStimulusItemProxy"};return testRunnerConfig.loadFromBundle=!!context.bundle,previewerFactory(container,testRunnerConfig,template).on("ready",function(runner){var _this5=this;if(runner.on("renderitem",function(){config.itemState&&runner.itemRunner.setState(config.itemState),_this5.trigger("preview-loaded")}),config.itemUri)return runner.loadItem(config.itemUri)})}}),define("taoMediaManager/controller/editInstance",["jquery","lodash","layout/actions/binder","ui/previewer","util/url","taoMediaManager/previewer/component/qtiSharedStimulusItem","core/logger","ui/feedback","layout/loading-bar"],function($,_,binder,previewer,urlUtil,qtiItemPreviewerFactory,loggerFactory,feedback,loadingBar){"use strict";var logger=loggerFactory("taoMediaManager/editInstance"),manageMediaController={start:function start(){var $previewer=$(".previewer"),file={};file.url=$previewer.data("url"),file.mime=$previewer.data("type");var isPreviewEnabled=$previewer.data("enabled"),isPassage="application/qti+xml"===file.mime;isPreviewEnabled&&(isPassage?(loadingBar.start(),qtiItemPreviewerFactory($previewer,{itemUri:$("#edit-media").data("uri")}).on("error",function(err){_.isUndefined(err.message)||feedback().error(err.message),logger.error(err)}).on("preview-loaded",loadingBar.stop)):(file.containerClass="no-background",$previewer.previewer(file))),isPassage?$("#media-authoring").show():$("#media-authoring").hide(),$("#edit-media").off().on("click",function(){var action={binding:"load",url:urlUtil.route("editMedia","MediaImport","taoMediaManager")};binder.exec(action,{classUri:this.dataset.classuri,id:this.dataset.uri}||this._resourceContext)})}};return manageMediaController}),define("taoMediaManager/controller/routes",[],function(){"use strict";return{MediaManager:{deps:"controller/actions",actions:{editInstance:"controller/editInstance",authoring:"controller/authoring"}}}}),function(c){var d=document,a="appendChild",i="styleSheet",s=d.createElement("style");s.type="text/css",d.getElementsByTagName("head")[0].appendChild(s),s.styleSheet?s.styleSheet.cssText=c:s.appendChild(d.createTextNode(c))}(".previewer{position:relative}.previewer iframe{min-height:400px;width:100%}.previewer .previewer-component{background-color:white;text-align:initial}.previewer .previewer-component .item-previewer-scope{height:calc(100vh - 250px)}.previewer .previewer-component .item-previewer-scope .action-bar,.previewer .previewer-component .item-previewer-scope .test-sidebar{display:none}.previewer.no-background{background:none}#item-editor-scope .left-bar .tool-group ._accordion{display:none}#item-editor-scope .focus-border{box-shadow:1px 1px 3px 2px #3e7da7}#item-editor-scope .qti-itemBody.item-editor-drop-area{margin-top:0}#item-editor-scope .qti-item{padding:20px}#item-editor-scope .item-editor-sidebar #item-editor-font-size-changer .icon-smaller,#item-editor-scope .item-editor-sidebar #item-editor-font-size-changer .icon-larger{background:none;color:black;height:21px;width:20px}#item-editor-scope .item-editor-sidebar #item-editor-font-size-changer .icon-smaller{margin-left:30px}#item-editor-scope .item-editor-sidebar #item-editor-font-size-changer .icon-smaller:before{font-size:1.2rem}#item-editor-scope .item-editor-sidebar #item-editor-font-size-changer .icon-larger:before{font-size:1.8rem}#item-editor-scope .item-editor-sidebar .item-editor-color-picker .color-trigger{background:none}#item-editor-scope .item-editor-sidebar .item-editor-color-picker .reset-button{top:0}#item-editor-scope .item-editor-sidebar .reset-group .reset-button{background:none;color:black}div.item-editor-item{border-color:transparent}\n\n/*# sourceMappingURL=../../../taoMediaManager/views/css/media.css.map */"),define("taoMediaManager/loader/taoMediaManager.bundle",function(){}),define("taoMediaManager/loader/taoMediaManager.min",["taoItems/loader/taoItemsRunner.min","taoTests/loader/taoTestsRunner.min","taoQtiItem/loader/taoQtiItemRunner.min","taoQtiItem/loader/taoQtiItem.min","taoQtiTestPreviewer/loader/qtiPreviewer.min"],function(){});
//# sourceMappingURL=taoMediaManager.min.js.map